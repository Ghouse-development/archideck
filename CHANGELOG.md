# ArchiDeck 開発履歴

## v4.99.7 (2026-01-10)

### ログイン時の自動タブ選択

- ログイン時に自分の担当タブを自動選択するように変更
- ALLや他の担当者への切り替えは引き続き可能
- kintone同期で進捗データ（progress）は上書きされない仕様を維持

---

## v4.99.6 (2026-01-10)

### ウェルカムツアー機能を削除

- 初回訪問時の「ArchiDeckへようこそ」ポップアップを削除
- インタラクティブツアー（AppTour）全体を削除
- 関連するCSS・JavaScriptを削除

---

## v4.99.5 (2026-01-10)

### Service Workerキャッシュ更新

- CACHE_NAMEを`archideck-v2`から`archideck-v3`に更新
- 古いキャッシュをクリアして新しいコードを強制適用

---

## v4.99.4 (2026-01-10)

### デモモード機能を削除

- ログイン画面の「パスワード無しで入る」ボタンを削除
- 設定画面の「デモモードを有効にする」トグルを削除
- 関連するJavaScript関数を削除（enterDemoMode, saveDemoModeSetting, loadDemoModeSetting）
- ログインにはメールアドレスとパスワードが必須に

---

## v4.99.3 (2026-01-10)

### パスワード設定メールのリンク修正

#### 問題
- 担当者追加時に送信されるパスワード設定メールのリンクをクリックすると、パスワード設定画面ではなくログイン画面に遷移してしまう
- パスワード設定時に「パスワード設定に失敗しました」エラーが発生

#### 修正内容
1. **リダイレクトURLを修正**
   - 変更前: `window.location.origin + '/#password-reset'`（パスが不正）
   - 変更後: `window.location.origin + '/archideck/index.html#set-password'`

2. **PASSWORD_RECOVERYイベント処理を追加**
   - Supabaseの`onAuthStateChange`で`PASSWORD_RECOVERY`イベントを検出
   - パスワード設定画面を自動表示

3. **パスワード設定画面を追加**
   - 新しいパスワード入力（2回入力で確認）
   - バリデーション: 英字と数字を含む8文字以上
   - 設定完了後、ログイン画面へ遷移

4. **checkAuth()でリカバリーフローを検出・セッション待機**
   - URLハッシュに`type=recovery`または`type=signup`が含まれる場合を検出
   - Supabaseがトークンを処理してセッションを確立するまで待機（最大10秒）
   - セッション確立後にパスワード設定画面を表示

5. **saveNewPassword()でセッション確認を追加**
   - パスワード設定前にセッション状態を確認
   - セッションが無い場合はエラーメッセージを表示

6. **リンク期限切れエラーの表示を追加**
   - `otp_expired`エラーを検出してユーザーにわかりやすいメッセージを表示
   - 「パスワードを忘れた方」から再送信を促す

7. **リダイレクトURLをルートURLに統一**
   - Supabaseダッシュボードの許可リストと一致させるため`window.location.origin`に変更

#### 新規関数
- `showSetPasswordModal()`: パスワード設定画面を表示
- `saveNewPassword()`: 新しいパスワードを保存

---

## v4.99.2 (2026-01-10)

### 部署選択の初期化順序修正

- 部署マスタが読み込まれる前にドロップダウンが更新される問題を修正
- updateDepartmentDropdowns()で部署マスタが空の場合は自動的に読み込むよう改善

---

## v4.99.1 (2026-01-10)

### 設定画面の修正

- 担当管理画面で部署選択肢が表示されないバグを修正
- 各設定画面に固有のURLを設定（#settings/staff, #settings/icTasks等）
- URLからの直接アクセスに対応（全設定パネル）

---

## v4.99.0 (2026-01-10)

### パスワード管理機能の改善

- 担当管理画面から🔑パスワード管理ボタンを削除（パスワードは個人管理に）
- ログイン画面の「パスワードを忘れた」機能に確認ダイアログを追加
- パスワード要件を「英字と数字を含む8文字以上」に統一
- 部署マスタの強制リセット機能を追加（バージョン管理による初期化）

---

## v4.98.2 (2026-01-10)

### 部署マスタの初期化バグ修正

- localStorageに空の配列が保存されている場合、デフォルト部署が設定されないバグを修正
- 空の配列または旧デフォルト値の場合、新デフォルト値（注文住宅事業部、不動産事業部、外構事業部、AX戦略部）を自動設定

---

## v4.98.1 (2026-01-10)

### メール件名フォーマット修正

- 件名に「依頼」を追加
  - 変更前: 【設備PB見積】〇〇様邸　期日：〇月〇日希望
  - 変更後: 【設備PB見積依頼】〇〇様邸　期日：〇月〇日希望

---

## v4.98.0 (2026-01-10)

### 用語の統一

- 「スタッフ」→「担当」に統一
  - スタッフ管理 → 担当管理
  - スタッフ名 → 担当名
  - スタッフを追加 → 担当を追加
  - その他UIテキスト・メッセージ・コメントを全て統一
- 「プロジェクト」→「案件」に統一
  - エラーメッセージ、CSSコメント、コード内コメントを全て統一
- ※kintoneテーブル名（API連携用）は変更なし

---

## v4.97.3 (2026-01-10)

### 部署マスタのデフォルト値変更

- デフォルト部署を変更:
  - 注文住宅事業部
  - 不動産事業部
  - 外構事業部
  - AX戦略部
- 旧デフォルト値からの自動マイグレーション対応

---

## v4.97.2 (2026-01-10)

### サイドバー部署タイトルのタスク数表示を削除

- 「設計担当 3538/3570」のような表示を削除
- 全部署共通でシンプルな表示に変更

---

## v4.97.1 (2026-01-10)

### メール提出期限の日付フォーマット修正

- 「1月17日日」→「2026年1月17日」に修正
- 年を含む正しい日付形式に変更

---

## v4.97.0 (2026-01-10)

### スタッフ管理の機能拡張

#### 電話番号入力
- スタッフ追加・編集フォームに携帯電話番号フィールドを追加
- 11桁の数字のみ入力可能（ハイフンなし）
- バリデーション実装

#### 部署マスタ機能
- 部署マスタをlocalStorageで管理
- デフォルト部署: 経営企画部、システム開発部、設計部、営業部、工事部、IC部
- 部署の追加・削除が可能
- チップ形式で視覚的に表示

#### 部署選択UI改善
- スタッフ追加・編集フォームで部署をプルダウン選択に変更
- 部署マスタと連動

---

## v4.96.4 (2026-01-10)

### スタッフ管理カテゴリ修正

- インラインスタッフ追加フォームに「営業担当」「管理者」カテゴリを追加
- 編集モーダルと同じカテゴリ選択肢に統一

---

## v4.96.3 (2026-01-10)

### メール添付警告の改善

- 本文に「添付」が含まれる場合のみ警告ポップアップを表示
- Gmail/Outlook両方に対応
- トースト通知も添付がある場合のみ警告メッセージを表示

---

## v4.96.2 (2026-01-10)

### バッジ色の統一

- タスク・メモ・議事録・引継書のカウントバッジをプライマリカラー（青）に統一
- 業務内容セクションのカウントバッジ（biz-task-count）をバッジスタイルに変更
  - 未完了あり: オレンジ背景
  - 全完了: 緑背景
- システム全体で一貫したバッジデザインを適用

---

## v4.96.0 (2026-01-10)

### kintone複数年度アプリ対応

#### 機能概要
- 同じドメインから複数のkintoneアプリ（年度別）を設定可能
- 昨年度・今年度・来年度をまたいでデータ管理が可能

#### UI変更
- kintone設定画面に「年度別アプリ設定」セクションを追加
- 年度とアプリIDのペアを複数登録可能
- インポート時に対象年度を選択するチェックボックスを追加

#### データ保存
- 年度別アプリ設定はlocalStorageに保存（kintone_apps）
- 後方互換性を維持（既存のapp_id設定も引き続き動作）

---

## v4.95.1 (2026-01-10)

### メールテンプレート修正

- 業者テンプレートではなく常にデフォルトテンプレートを使用するよう修正

---

## v4.95.0 (2026-01-10)

### スタッフ追加時の自動パスワード設定メール送信

#### 機能概要
- スタッフ追加時にメールアドレスを必須入力に変更
- 追加と同時にパスワード設定メールを自動送信
- 担当者は自分でパスワードを設定（管理者はパスワードを管理しない）

#### 処理フロー
1. 管理者がスタッフ名・メールアドレスを入力して追加
2. designersテーブルにレコード追加
3. Supabase Authにユーザーを作成
4. パスワード設定メールを自動送信
5. 担当者がメールのリンクからパスワードを設定

#### UI変更
- スタッフ追加フォームにメールアドレス入力欄を追加
- 「追加後、担当者にパスワード設定メールが送信されます」の説明を追加

---

## v4.94.2 (2026-01-10)

### カレンダー表示改善

#### イベント表示にタスク名を追加
- **変更前**: 顧客名のみ表示（例：`江坂`）
- **変更後**: 顧客名 + タスク名を表示（例：`江坂 構造依`）
- ホバー時に詳細表示（例：`江坂様邸: 構造依頼(期限)`）

#### 表示されるイベント
- 設計タスク（期限・依頼日）
- ICタスク（期限・依頼日）
- 外構タスク（依頼日）
- 工事タスク（依頼日）
- 間取確定予定日
- 変更契約前会議予定日
- 着工許可予定日

---

## v4.94.1 (2026-01-10)

### メールテンプレート修正・スタッフ部署追加

#### 1. メール署名をログインユーザー情報に変更
- **修正前**: 案件の設計担当者の情報を使用
- **修正後**: 現在ログインしているユーザーの情報を使用
- IC・外構担当者がメール送信時も正しく自分の署名が入る

#### 2. メール本文を修正
- 「をお願いいたします」→「の御見積作成をお願いいたします」に変更

#### 3. スタッフ管理に部署フィールド追加
- スタッフ編集モーダルに「部署」入力欄を追加
- スタッフ一覧テーブルに「部署」列を追加
- メール署名に部署を自動挿入（例：経営企画部・システム開発部）

#### 新しいプレースホルダー追加
- `{staffDepartment}`: スタッフの部署

---

## v4.94.0 (2026-01-10)

### メールテンプレート改善・スタッフ電話番号追加

#### 1. メール件名テンプレート変更
- 新フォーマット: `【タスク名】〇〇様邸　期日：〇月〇日希望`
- 例: `【構造依頼】江坂　巧様邸　期日：1月17日希望`

#### 2. メール本文テンプレート変更
- ビジネスメール形式に統一
- 業者名・担当者名への挨拶
- 案件情報（案件名・内容・提出期限）を明記
- スタッフ署名（名前・電話番号・メールアドレス）を追加

#### 3. スタッフ管理に電話番号フィールド追加
- スタッフ編集モーダルに「電話番号」入力欄を追加
- スタッフ一覧テーブルに「電話番号」列を追加
- メール署名に電話番号を自動挿入

#### 4. 資料添付警告ポップアップ
- Gmail/Outlook起動時に確認ダイアログを表示
- 「本文に添付と記載されている場合は、メールソフト側で資料を添付してください」
- 送信完了トーストでも「資料の添付を忘れずに！」と注意喚起

#### 新しいプレースホルダー
- `{taskName}`: タスク名
- `{staffEmail}`: スタッフのメールアドレス
- `{staffPhone}`: スタッフの電話番号

---

## v4.93.5 (2026-01-10)

### コンテキストメニューバグ修正

#### 問題
- 案件の右クリックメニューで「完了済みに移動」が2つ表示される

#### 原因
- `ContextMenu.show()`のセレクタ `nth-child(5)` が誤り
- 5番目の子要素（削除ボタン）のテキストを「完了済みに移動」に変更していた
- 結果：4番目（本来のアーカイブ）と5番目（誤変更された削除）両方が同じテキストに

#### 修正
- セレクタを `nth-child(4)` に修正
- 正しく4番目の子要素（アーカイブ項目）のみを更新するように変更

---

## v4.93.4 (2026-01-10)

### コード品質改善（nullチェック追加）

#### 重要フォーム関数にnullチェック追加
- **signIn()**: ログインフォームの入力取得
- **saveProject()**: 案件保存フォームの入力取得
- **saveVendorV2()**: 業者保存フォームの入力取得
- **addDesigner()**: 担当者追加フォームの入力取得
- **saveTask()**: タスク保存フォームの入力取得

#### 修正方法
- `document.getElementById('xxx').value` → `document.getElementById('xxx')?.value || ''`
- optional chaining (`?.`) を使用してTypeError防止

---

## v4.93.3 (2026-01-10)

### カレンダー担当者連動・コード品質改善

#### 1. カレンダー担当者連動の修正
- **問題**: カレンダータブで担当者を変更しても表示が変わらない
- **修正**: `selectDesigner`で常に`renderCalendar()`を呼び出すよう修正
- **デバッグ**: console.logでフィルタリング状況を追跡可能に

#### 2. コード品質改善
- **silent fail修正**: `.catch(() => {})` を `.catch(e => console.warn(...))` に変更
- **対象**: ストレージ削除エラー、通知送信エラー（4箇所）
- **効果**: エラーが発生した場合にコンソールで確認可能

#### 変更ファイル
- `archideck/index.html`: カレンダー連動修正、エラーログ追加

---

## v4.93.2 (2026-01-10)

### 設計タスクUI改善

#### 1. メールボタン常時表示
- **変更内容**: 設計タスクのメールボタンをステータスに関係なく常に表示
- **理由**: 依頼前の段階（ステータス「-」）でもメール作成できるようにするため
- **影響範囲**: 設計タスクのみ（IC/外構等は従来通り）

#### 2. ステータスカード折り返し対応
- **問題**: 構造依頼など選択肢が多いタスクで表示が切れる
- **修正**: `flex-wrap: wrap` に変更して自動折り返し
- **効果**: モバイル表示も改善

#### 変更ファイル
- `archideck/index.html`: メールボタン表示条件、CSS修正

---

## v4.93.1 (2026-01-10)

### バグ修正: タスク状態更新エラー

#### 問題
- タスクのステータスを変更するとコンソールエラーが発生
- `Uncaught ReferenceError: updateTaskProgress is not defined`

#### 原因
- `selectStatusCard`関数内で存在しない`updateTaskProgress`を呼び出していた

#### 修正
- 正しい関数名`updateTaskState`に修正
- 引数の形式も`updateTaskState(projectId, taskKey, state)`に修正

---

## v4.93.0 (2026-01-10)

### スタッフ管理拡充・認証機能強化・カレンダー改善

#### 1. スタッフ管理に「管理者」カテゴリ追加
- **新規カテゴリ**: 設計・IC・外構・不動産・工事・営業に加え「管理者」を追加
- **モーダル対応**: スタッフ追加・編集モーダルで管理者を選択可能
- **一覧表示**: スタッフ管理画面に管理者セクションを追加
- **担当案件数**: 管理者は案件に紐づかないため「-」と表示

#### 2. 認証機能強化
- **アカウント設定画面追加**: 設定 > アカウント設定
- **パスワード変更機能**: ログイン後に自分でパスワードを変更可能
- **パスワード再発行**: パスワードを忘れた場合は再設定メールを送信（既存機能）
- **アカウント情報表示**: メールアドレス・ユーザー名を確認可能

#### 3. カレンダー表示改善
- **サイドバー連動**: サイドバーで選択した担当者の案件のみカレンダーに表示
- **全案件表示**: 「全案件」選択時は全案件を表示
- **完了済み対応**: 「完了済」選択時は完了済み案件のイベントを表示
- **担当判定**: 設計・IC・外構・不動産・工事・営業の全担当フィールドをチェック

#### 変更ファイル
- `archideck/index.html`: スタッフ管理UI、認証機能、カレンダーフィルタリング

---

## v4.92.0 (2026-01-09)

### 申請GO条件修正・設計タスクメールボタン条件緩和

#### 変更内容
- **申請GO条件の太陽光依頼**: 設計ドキュメントに合わせて「保存済」→「営業共有済」に修正
- **フォールバックロジック修正**: タスク未定義時の旧ロジックも「営業共有済」で判定
- **tooltip文言修正**: 申請GO無効時のツールチップを正しい条件表示に修正
- **設計タスクメールボタン条件緩和**: `has_email_button === true` → `has_email_button !== false` に変更し、他カテゴリと同様の挙動に統一

#### 修正箇所
| 箇所 | 修正内容 |
|------|----------|
| renderProjectCard | tooltip文言、メールボタン条件 |
| updateTaskState | tooltip文言 |
| canPressApplicationGo | フォールバックロジック |
| confirmApplicationGo | モーダル条件表示 |

---

## v4.91.0 (2026-01-08)

### kintone外構担当フィールド追加・商品フィールドコード変更

#### 変更内容
- **外構担当フィールド追加**: `文字列_基本情報_外構施工担当`をkintoneから取得
- **商品フィールドコード変更**: `ドロップダウン_営業_契約後_商品`に対応
- **インポート・同期対応**: importFromKintoneDirect、autoSyncKintoneで外構担当を処理
- **名前マッチング**: 外構担当も他の担当者と同様に名前の揺らぎを吸収

---

## v4.90.0 (2026-01-08)

### kintoneから商品フィールドをインポート

#### 変更内容
- **商品フィールドマッピング**: kintone設定に「⑨商品」入力欄を追加
- **インポート時**: kintoneの商品フィールド値を案件のspecificationsに反映
- **自動同期時**: 商品フィールドの変更を検出して更新
- **デフォルト値**: 商品が空の場合は「LIFE」を使用

---

## v4.89.0 (2026-01-08)

### IC案件は間取確定後のみ表示 & 言葉の揺らぎ統一

#### 変更内容
- **IC担当フィルター**: 設計の「間取確定日」が入力されていない案件はIC担当に表示されない
- **適用箇所**: サイドバーのIC担当カウント、案件一覧表示、タスク一覧、週報・月報
- **言葉の揺らぎ統一**: タイルプレゼン作成のステータス「無」→「無し」に統一

---

## v4.88.0 (2026-01-08)

### 完了チェックボックスに確認ダイアログを追加

#### 変更内容
- **確認ダイアログ**: 完了チェックボックスをクリック時に`confirm()`で確認
- **誤操作防止**: 「〇〇」を完了済みに移動しますか？と表示

---

## v4.87.0 (2026-01-08)

### カレンダーラベル修正

#### 変更内容
- **ラベル修正**: カレンダーの「建築確認」→「着工許可」に修正

---

## v4.86.0 (2026-01-08)

### ICタスクのステータス色調整

#### 変更内容
- **カーテン紹介**: 「無し」を追加、青色表示
- **造作業者紹介・家具見積依頼**: 「無し」は青色表示
- **アイアン依頼・その他見積依頼**: 「無し」「保存済」は青色、「依頼済」は黄色

---

## v4.85.0 (2026-01-08)

### 案件カードUI改善

#### 変更内容
- **期限設定削除**: 案件カードから「期限設定」を削除
- **日付順序変更**: 間取確定 → 変更契約前会議 → 着工許可 の順に表示
- **完了チェックボックス**: チェックで案件を完了済みに移動

---

## v4.84.0 (2026-01-08)

### UI統一・バグ修正・完了済み機能改善

#### 変更内容
- **タスク・ステータスカードのデザイン統一**: CSS統一、右寄せ、コンパクト化
- **バッジ色統一**: サイドバーのバッジ色を統一
- **コンテキストメニューバグ修正**: archiveパラメータの修正

---

## v4.83.0 (2026-01-08)

### autoSyncKintoneの日付フィールド名を修正

#### 変更内容
- **フィールド名修正**: `layout_date` → `layout_confirmed_date`
- **フィールド名修正**: `permit_date` → `construction_permit_date`
- **フィールド名修正**: `meeting_date` → `pre_contract_meeting_date`

---

## v4.82.0 (2026-01-08)

### 設定画面カード式UI・kintone名前マッチング強化

#### 1. 設定画面のカード式UI
- カード形式のナビゲーションに変更
- 各設定項目をカードで表示

#### 2. kintone名前マッチング強化
- **normalizeName()関数**: 全角半角変換、スペース除去、小文字化
- **matchDesignerName()関数**: 5段階マッチング（完全一致→trim後→正規化後→部分一致→姓マッチ）
- **全インポート関数に適用**: importFromKintoneDirect、autoSyncKintone、CSVインポート

---

## v4.72.0 (2026-01-08)

### kintone連携の完全強化・エラー耐性向上

#### 1. インポート機能の堅牢化
- **kintone_record_id抽出の強化**: 複数のフィールド名に対応（`$id`, `レコード番号`, `Record_number`, `record_id`）
- **高速インデックス検索**: Mapを使用した既存プロジェクトの高速マッチング
- **重複処理防止**: 同一kintone_record_idの複数回処理を防止
- **日付フォーマット対応**: YYYY-MM-DD, ISO 8601, YYYY/MM/DD, 日本語形式に対応

#### 2. インポート前バリデーション追加
- **設定チェック**: kintone設定が保存されているか事前確認
- **接続テスト**: インポート前にkintone接続をテスト
- **フィールドマッピング確認**: 必須フィールドが設定されているか確認
- **デモデータ警告**: 既存デモデータがある場合に警告を表示

#### 3. デモデータ管理機能
- **データ状況表示**: 総案件数、kintone連携数、デモ/手動数、完了済数を表示
- **デモデータ一括削除**: kintone連携前にデモデータを安全に削除可能
- **関連データ自動削除**: タスク、議事録、引継書も同時に削除

#### 4. Edge Functionの強化
- **リトライ機能**: ネットワークエラー時に最大3回リトライ
- **詳細エラー情報**: エラー発生時のページ数、オフセット、取得済み件数を記録
- **ページカウント追加**: 何ページ取得したかをレスポンスに含める

#### 5. エラーハンドリング強化
- **詳細エラーログ**: 各レコードのエラーをコンソールに表形式で出力
- **スキップ理由の細分化**: 顧客名なし、レコードIDなしを区別
- **例外キャッチ強化**: 個別レコード処理での例外を記録

#### 変更ファイル
- `archideck/index.html`: インポート機能全面改修、バリデーション追加
- `supabase/functions/kintone-proxy/index.ts`: リトライ機能、詳細エラー情報追加

---

## v4.71.0 (2026-01-08)

### kintoneインポート完全対応

#### 改善内容
- **ページネーション安定化**: `order by $id asc`を追加して一貫した取得を保証
- **10,000件制限対応**: 制限到達時の警告表示を追加
- **詳細なインポート結果**: 新規/更新/スキップ件数とスキップ理由を表示
- **コンソールログ強化**: デバッグ用の詳細情報を出力

## v4.70.0 (2026-01-08)

### バグ修正（コードレビュー対応）

#### 修正内容
- **saveProject**: 未定義の`memo`変数参照を削除
- **IC完了判定**: icProgressがnullの場合のロジック修正
- **calculateProgress**: projectがnullの場合のガード追加
- **syncToKintone**: エラーハンドリングを適切に追加（silent catchを修正）

## v4.69.0 (2026-01-08)

### kintone全件取得・ソースフィルター・IC完了判定修正

#### 1. kintone 500件制限を回避
- `getAllRecords`アクションを追加（ページネーション対応）
- 500件以上のレコードも全件取得可能に

#### 2. ソースフィルター追加
- 「kintone連携」「手動追加/デモ」でフィルタリング可能
- kintone_record_idの有無で判定

#### 3. IC完了済み判定の修正
- `is_archived`に加えて`status === 'completed'`もチェック
- IC担当者がいない場合の判定を修正

## v4.68.0 (2026-01-08)

### kintone日付インポート・デモモード設定

#### 1. kintone日付フィールドのインポート
- 間取確定日（layout_confirmed_date）
- 着工許可日（construction_permit_date）
- 変更契約前会議日（pre_contract_meeting_date）
- kintoneからインポート時に各案件に日付を反映

#### 2. プロジェクトカードに日付表示
- 担当者の下に日付情報を表示
- 設定されている日付のみ表示（間取確定/着工許可/変更契約前会議）

#### 3. デモモード設定機能
- 設定 > カスタマイズタブに「デモモードを有効にする」トグル追加
- デフォルトは有効（パスワードなしログイン可能）
- 無効にするとパスワード必須

#### 4. kintoneインポートのエラー修正
- uid NOT NULL制約違反を修正（insertDataからuid削除）
- 日付フィールドのYYYY-MM-DD形式バリデーション追加

## v4.67.0 (2026-01-08)

### kintone API連携（Edge Function）

#### 1. Supabase Edge Function追加
- `kintone-proxy`: kintone APIへのプロキシ関数
- CORS制限を回避してブラウザから直接kintone連携可能

#### 2. 対応機能
- 接続テスト（実際にkintone APIを呼び出して確認）
- レコード取得（getRecords, getRecord）
- レコード追加/更新（addRecord, updateRecord）

#### 3. フロントエンド更新
- `callKintoneProxy()`: Edge Function呼び出し
- `fetchKintoneRecords()`: レコード一覧取得
- `addKintoneRecord()`: レコード追加
- `updateKintoneRecord()`: レコード更新

## v4.66.0 (2026-01-08)

### kintone連携強化・マルチテナント対応

#### 1. kintone設定をDBに保存
- `kintone_settings`テーブルに接続情報と担当者フィールドマッピングを保存
- 複数組織での利用に対応

#### 2. フィールドマッピングUI改善
- kintoneフィールドコードのプレースホルダーを実際の形式に更新
- フィールド番号（①〜⑧）をラベルに追加
- 基本情報フィールド：邸名、プラン確定日、着工許可日、変更契約前会議日
- 担当者フィールド：営業、設計、IC、工事

#### 3. エラー防止
- DOM要素のnullチェックを追加（モーダル非表示時のエラー防止）
- 既存レコードの更新/新規作成を正しく判定

## v4.65.1 (2026-01-08)

### ICメーカータスク色分け修正
- **「依頼済」→ 黄色（進行中）**
- **「保存済」→ 青色（完了）**
- 建具プレゼン依頼などのICメーカータスクに適用

## v4.65.0 (2026-01-08)

### UI整理・タスク完了チェック

#### 1. ヘッダーボタン削除
- 使い方ガイド（❓）ボタンを削除
- ダークモード切替（🌙）ボタンを削除

#### 2. 完了済み制限機能
- **未完了タスクがある案件は完了済みにできない**
- タスク残件数を警告メッセージで表示
- `openArchiveConfirmModal()`を非同期化し、タスクチェックを追加

## v4.64.0 (2026-01-08)

### 議事録機能強化

#### 1. ファイル名から打合せ日を自動予測
- **対応パターン**:
  - YYYYMMDD形式: 20260108, 2026_01_08, 2026-01-08
  - YYMMDD形式: 260108
  - MM月DD日形式: 1月8日
  - 令和形式: R6.1.8
- **関数追加**: `predictMeetingDateFromFilename()`

#### 2. 議事録の日付・回数編集機能
- **グループ編集**: 同じ日付の議事録を一括で日付変更
- **個別編集**: 各議事録の日付を個別に変更可能
- **関数追加**: `editMinuteDate()`, `editSingleMinuteDate()`
- **DB**: `meeting_date`カラムを使用（要追加）

#### 3. 表示改善
- 日付に年を表示（2026年1月8日形式）
- 編集ボタン（✏️）を各グループに追加
- 個別日付変更ボタン（📅）を各ファイルに追加

## v4.63.0 (2026-01-08)

### 完了済み確認モーダル追加

#### 1. 完了済み確認モーダル
- **モーダルUI**: `confirm()`ダイアログからモーダルに変更
- **関数追加**: `openArchiveConfirmModal()`, `closeArchiveConfirmModal()`, `executeArchive()`
- **UX改善**: プロジェクト名を表示し、完了済フィルターの説明を追加

## v4.62.0 (2026-01-08)

### カレンダー・kintone連携・UI改善

#### 1. カレンダー表示改善
- **余白削減**: padding/marginを大幅に縮小
- **フルスクリーン対応**: `height: calc(100vh - 120px)` で画面いっぱいに表示
- **ホバーエフェクト追加**: 日付セルにホバー時背景色変更
- **イベント表示改善**: 左ボーダーでカテゴリを明示

#### 2. kintone連携強化
- **担当者フィールドマッピング追加**:
  - 営業担当 (sales_assignee)
  - 設計担当 (design_assignee)
  - IC担当 (ic_assignee)
  - 工事担当 (construction_assignee)
- **CSVインポート**: 担当者カラムを自動認識してインポート
- **CSVエクスポート**: 営業担当・工事担当を追加

#### 3. バッジ表示統一
- メモ・引継書バッジを「①」→「1」に統一
- section-badge に badge-success/badge-info スタイル追加

## v4.61.0 (2026-01-08)

### お気に入り機能削除

#### 削除した機能
- **★（お気に入り）機能を完全削除**
  - CSS: お気に入りカード/ボタンのスタイル削除
  - HTML: フィルタードロップダウンの★オプション削除
  - HTML: コンテキストメニューの「⭐ お気に入り」削除
  - JS: FavoritesManagerオブジェクト削除
  - JS: キーボードショートカット(F)削除
  - JS: スワイプジェスチャー(右スワイプ)削除
  - JS: フィルター/ソートロジックから削除
  - JS: カード表示から★ボタン削除

## v4.59.0 (2025-12-22)

### フィードバック対応アップデート

#### 1. タスク状態選択肢の編集UI刷新
- **JSON形式廃止**: 設定画面でタスク編集時、リスト形式で状態オプションを編集可能に
- **動的追加/削除**: 「+ オプション追加」ボタンと「削除」ボタンで簡単操作
- **自動処理**: 先頭の「-」(空欄)は自動付与
- **関連関数**: `renderStateOptions()`, `addStateOption()`, `removeStateOption()`, `collectStateOptions()`

#### 2. evoltzメール送信ボタン有効化
- **SQL対応**: `has_email_button = true` に更新
- **マイグレーション**: `v9_feedback_updates.sql`

#### 3. 営業担当機能
- **UIフィールド**: プロジェクトモーダルに営業担当選択欄を追加
- **サイドバー**: 営業担当セクション表示
- **DB対応**: `sales_assignee` カラム追加

#### 4. タイルプレゼン「無」オプション
- **選択肢**: `["-", "無", "作成済"]` に更新
- **色分け**: 「無」選択時も青色（完了）表示

#### 5. クラウドURL添付機能
- **対象タスク**: 太陽光(`solar`)、地盤調査(`ground_survey`)
- **機能**: URL入力欄、リンクアイコン、保存処理

#### 6. 打合せ記録グループ化
- **表示形式**: 「第N回打合せ（日付）」でグループ化表示
- **ソート**: 日付順に回数を自動割り当て

#### 7. 引継書5部署別入力
- **入力欄**: 設計/IC/外構/不動産/工事の5つのテキストエリア
- **保存**: 部署ごとに個別保存

#### 8. カレンダー機能
- **月間表示**: タスク期限を月間カレンダーで表示
- **イベント収集**: 全プロジェクトのタスク期限を自動収集

#### 9. その他の修正
- **業者カテゴリ必須化**: 業者追加時にカテゴリ未選択でエラー表示
- **一括完了・削除ボタン削除**: バッチツールバーから削除
- **案件追加時メモ欄削除**: 新規案件フォームからメモ欄を削除
- **確定図チェックリスト期限リセット問題**: `JSON.parse(JSON.stringify())` でディープコピー対応

### 変更ファイル
- `archideck/index.html`: 全機能実装
- `archideck/sql/migrations/v9_feedback_updates.sql`: DB変更

---

## v4.53.0 (2025-12-20)

### 完全版リリース - 5部署フル対応 + FC本番対応

#### 工事担当機能の完全実装
- **案件モーダル**: 工事担当者の選択フィールドを追加
- **ドロップダウン生成**: `populateConstructionAssigneeDropdown()` 関数追加
- **保存処理**: `construction_assignee` をプロジェクトデータに含める
- **レイアウト改善**: 5部署対応のレスポンシブグリッド (`repeat(auto-fit, minmax(150px, 1fr))`)

#### 不動産・工事デフォルトタスク追加
- **不動産タスク (8項目)**: ヒアリング、物件検索、物件内見、提案、交渉、契約、ローン手続き、決済・引渡
- **工事タスク (10項目)**: ヒアリング、現地調査、見積作成、工事契約、届出・許可、資材発注、着工、施工、完了検査、引渡し
- **localStorage**: 初回起動時からデフォルトタスクが利用可能
- **統合関数**: `getTasksForCategory()` でSupabase/localStorage両方からタスク取得

#### FC URL本番対応
- **vercel.json作成**: `/fc/{slug}/` 形式のURLを `?fc={slug}` にリライト
- **セキュリティヘッダー**: X-Content-Type-Options, X-Frame-Options, X-XSS-Protection

#### RLS修正
- **project_minutes**: 議事録保存エラー (42501) を解決
- **project_handovers**: 引継書保存エラーを解決
- **SQL追加**: `fix_project_minutes_rls.sql`

#### 修正・改善
- **変数参照統一**: プロジェクトカードでのタスクリスト変数名を `xxxTasksList` に統一
- **進捗計算**: 全5部署の進捗率を正確に計算
- **自動アーカイブ**: 全5部署のタスク完了を判定

### 変更ファイル
- `archideck/index.html`: 工事担当フィールド、デフォルトタスク、統合関数
- `archideck/vercel.json`: 新規作成 (FC URLリライト)
- `archideck/sql/production/fix_project_minutes_rls.sql`: 新規作成

---

## 技術仕様

### アーキテクチャ
- **フロントエンド**: 単一HTMLファイル（CSS/JS埋め込み）
- **バックエンド**: Supabase（PostgreSQL + RLS + Storage + Auth）
- **ホスティング**: Vercel
- **認証**: Supabase Auth（メール/パスワード）

### データベーステーブル
| テーブル名 | 用途 |
|-----------|------|
| projects | 案件情報 |
| designers | 設計士・IC・外構担当 |
| tasks | タスクマスタ |
| project_tasks | カスタムタスク |
| project_minutes | 議事録 |
| project_handovers | 引継書 |
| products | 商品マスタ |
| vendors | 業者情報 |
| organizations | 組織（マルチテナント） |
| subscriptions | サブスクリプション |
| plans | 料金プラン |
| audit_logs | 監査ログ |

### セキュリティ
- RLS（Row Level Security）による組織単位のデータ分離
- JWT認証
- XSS対策ヘッダー（vercel.json）

### 本番URL
- メインアプリ: https://nandemo-nu.vercel.app/ （ドメイン変更予定）
- 管理者画面: https://nandemo-nu.vercel.app/admin

---

## v4.52.0 (2025-12-17)

### 工事職種追加とサイドバー折りたたみ・全タスク完了自動アーカイブ

#### 1. 工事職種を追加
- **工事タスク**: 8項目（着工準備、地盤調査、基礎工事、上棟、中間検査、完了検査、引渡し前確認、引渡し完了）
- **工事担当者**: カードヘッダーに工事担当者の表示と変更機能
- **工事進捗率**: 工事担当者用の進捗率表示
- **マイグレーションSQL**: v8_construction_tasks.sql追加

#### 2. サイドバー部署別折りたたみ機能
- 設計・IC・外構・不動産・工事の各セクションをクリックで折りたたみ/展開
- ログインユーザーの職種は初期状態で開く
- 折りたたみ状態はlocalStorageに保存

#### 3. 全タスク完了で自動アーカイブ
- ステータスが最終状態（青色）になったら自動でcompleted=true
- 設定されている担当者のタスクがすべて完了したら確認ダイアログを表示
- 確認後、案件を自動的に完了済みに移動

### 変更されたファイル
- `archideck/index.html`: 工事職種対応、サイドバー折りたたみ、自動アーカイブ
- `archideck/sql/migrations/v8_construction_tasks.sql`: 新規追加

---

## v4.51.0 (2025-12-17)

### 職種別業務内容・進捗表示の完全対応
- **外構タスク追加**: 6項目のデフォルトタスク（現地確認、プラン作成依頼、見積依頼、契約、着工打合せ、工事完了確認）
- **不動産タスク追加**: 6項目のデフォルトタスク（物件調査、重要事項説明書作成、契約書作成、決済準備、金融機関連絡、引渡し）
- **進捗率計算**: 外構・不動産担当者にも進捗率を表示
- **管理者表示強化**: 管理者は設計・IC・外構・不動産すべての進捗と業務内容を確認可能
- **マイグレーションSQL**: v7_exterior_realestate_tasks.sql追加

### 変更されたファイル
- `archideck/index.html`: 外構・不動産タスク表示と進捗計算追加
- `archideck/sql/migrations/v7_exterior_realestate_tasks.sql`: 新規追加

---

## v4.50.0 (2025-12-17)

### キーボードナビゲーション強化 (120点達成リリース)

#### 1. カードナビゲーション
- J/K キーで次/前のカードへ移動
- Enter キーで選択カードを編集
- X キーでカード選択トグル
- 視覚的フォーカス表示（アウトライン+グロー）

#### 2. ショートカットヘルプ更新
- カードナビゲーションセクション追加
- 全ショートカット一覧の拡充

---

## v4.49.0 (2025-12-17)

### ローディングUX改善

#### 1. ローディングオーバーレイ
- モダンなローディングスピナー
- プログレス表示付きローディング
- 中央配置のローディングカード

#### 2. スケルトンローディング
- コンテンツ読み込み中のスケルトン表示
- スムーズなアニメーション効果
- カード・テキスト用スケルトンスタイル

---

## v4.48.0 (2025-12-17)

### UI/UXポリッシュアップデート

#### 1. フローティングアクションボタン（FAB）
- 画面右下に常時表示されるクイックアクションメニュー
- ワンクリックで主要機能にアクセス
  - 新規案件作成
  - データ再読み込み
  - CSV出力
  - レポート印刷
  - ショートカットヘルプ
- アニメーション付きメニュー展開

#### 2. 強化ツールチップ
- CSS純正の洗練されたツールチップ
- 上向き/下向き対応
- ダークモード連動

---

## v4.47.0 (2025-12-17)

### プレミアムUX機能追加

#### 1. ダークモード
- 完全なダークテーマサポート
- Ctrl+Shift+D でトグル
- ヘッダーにトグルボタン追加
- 設定はlocalStorageに保存

#### 2. カード展開状態の自動保存
- 各カードのセクション開閉状態を記憶
- ページ再読み込み後も状態を復元
- 案件ごと・セクションごとに個別保存

#### 3. ドラッグ&ドロップ並べ替え
- 案件カードをドラッグして任意の順序に並べ替え
- カスタム順序をlocalStorageに保存
- ソートオプションに「カスタム順」追加
- 視覚的フィードバック（ドラッグ中のスタイル）

#### 4. キーボードショートカット拡張
- Ctrl+Shift+D: ダークモード切り替え
- ショートカットヘルプに新機能追加

---

## v4.46.0 (2025-12-17)

### UI/UX向上アップデート

#### 1. プログレスバー色分け
- 進捗率に応じた4段階カラー表示
  - 80%以上: 緑（成功）
  - 50-79%: 青（進行中）
  - 25-49%: オレンジ（注意）
  - 25%未満: 赤（要対応）
- 進捗値の文字色も連動

#### 2. クイックメール機能
- カードヘッダーにメールボタン追加
- ワンクリックでタスク選択→メール作成
- メール送信可能なタスクをリスト表示

---

## v4.45.0 (2025-12-17)

### 大規模機能強化リリース

#### 1. 高度なフィルター・ソート機能
- **担当者別フィルター**: IC担当者、外構担当者、不動産担当者でフィルタリング可能に
- **ソート機能追加**: 更新日（新/古）、進捗率（高/低）、顧客名（A-Z/Z-A）、作成日でソート
- **フィルターリセット**: Rキーで全フィルターを一括リセット

#### 2. 統計ダッシュボード
- リアルタイム統計表示（アクティブ案件数、平均設計進捗、平均IC進捗、今月完了数）
- 期限超過案件の警告表示
- Dキーでダッシュボード表示/非表示切り替え

#### 3. キーボードショートカット拡張
- 1/2/3キー: タブ切り替え（案件/分析/設定）
- Rキー: フィルターリセット
- Dキー: 統計ダッシュボード切り替え
- Fキー: お気に入りフィルター切り替え
- Shift+?: ショートカットヘルプ表示

#### 4. 期限切れタスクハイライト
- 期限超過案件: 赤色ボーダー + グローアニメーション
- 期限3日以内: オレンジボーダー
- 視覚的に緊急度を即座に把握可能

#### 5. 一括操作機能強化
- **一括期限設定**: 複数案件に同じ期限を設定
- **一括削除**: 複数案件を一度に削除（二重確認あり）
- 既存: 一括完了、担当変更、IC一括更新

---

## v4.44.0 (2025-12-17)

### 部署別業務内容表示機能

#### 部署別表示の最適化
- 各部署は自分の業務内容のみ表示されるように変更
  - 設計担当: 設計業務内容と設計進捗のみ表示
  - IC担当: IC業務内容とIC進捗のみ表示
  - 外構担当: 外構業務内容のみ表示（タスク追加予定）
  - 不動産担当: 不動産業務内容のみ表示（タスク追加予定）
  - 管理者: すべての業務内容と進捗を表示
- 不要な情報が非表示になり、画面がシンプルに
- 各部署が自分の業務に集中できる環境を実現

---

## v4.43.0 (2025-12-17)

### 業務効率化機能の大幅強化

#### 1. ICタスク自動マイグレーション
- アプリ起動時にICタスクが21項目未満なら自動的に更新
- 手動操作やSQL実行が完全に不要に
- 既存データを維持しながら新タスクを追加

#### 2. IC進捗フィルター
- ツールバーに「IC進捗」フィルターを追加
- IC未着手 (0%)、IC進行中 (1-99%)、IC完了 (100%)、IC担当なしで絞り込み
- IC担当者の作業状況を一目で把握可能

#### 3. ICタスク一括更新
- 複数案件を選択して「🎨 IC一括更新」ボタンをクリック
- タスクとステータスを選んで一括変更
- 例: 選択した10件すべての「キッチン」を「Panasonic」に変更

#### 効果
| 機能 | 効果 |
|------|------|
| 自動マイグレーション | セットアップ時間ゼロ |
| IC進捗フィルター | 週次確認が1分で完了 |
| 一括更新 | 10件の更新が10秒で完了（従来2分） |

---

## v4.41.0 (2025-12-17)

### ICタスクマイグレーション機能

#### 新機能
- 「🔄 21項目に更新」ボタンを設定 > ICタスク管理に追加
- ボタンクリックでICタスクを自動的に21項目に更新
- SQLを手動で実行する必要がなくなりました

#### 21項目のICタスク
1. 資金計画・引継書確認
2. キッチン・カップボード（メーカー選択・メール機能）
3. お風呂（メーカー選択・メール機能）
4. 洗面（メーカー選択・メール機能）
5. トイレ（メーカー選択・メール機能）
6. 照明プラン（メーカー選択・メール機能）
7. 仕様書作成
8. 長期資料送付
9. 実施図
10. 外装プレゼン作成
11. 内装プレゼン作成
12. 建具プレゼン依頼（メール機能）
13. タイルプレゼン作成
14. 外構への打合せ依頼
15. カーテン紹介（メール機能）
16. 造作業者紹介（メール機能）
17. 家具見積依頼（メール機能）
18. 確定図チェックリスト
19. OP見積チェック
20. 会議後確認事項送付
21. 確定図承認

---

## v4.40.0 (2025-12-16)

### UX改善: 未更新警告バッジ

#### 新機能
- 7日以上更新のない案件に「⚠️ X日」警告バッジを表示
- 一目で停滞している案件を識別可能に
- 完了済み案件には表示されない

#### 効果
- 放置案件の早期発見により対応漏れを防止
- 管理者の進捗確認が効率化

---

## v4.39.0 (2025-12-16)

### 品質向上

#### 担当者未設定時のQuickAdd
- プロジェクトカードでIC/外構/不動産担当が未設定の場合、「+IC」「+外構」「+不動産」ボタンを表示
- クリックで即座に担当者を割り当て可能
- 担当者設定の漏れを防止し、ワンクリックでの追加を実現

#### データ整合性チェック強化
- cleanupProjectAssignees関数を拡張
- exterior_assigneeとrealestate_assigneeも自動クリーンアップ対象に
- 不正な"null"文字列や空白の自動修正

### 人時生産性への累積寄与

v4.35.0〜v4.39.0の改善により:
- **IC担当者**: 週1〜2時間の効率化
- **設計担当者**: 担当者変更が即座に可能で会議時間短縮
- **管理者**: 週報・月報で全担当者の状況を一括確認
- **全体**: QuickEditによる操作数削減、ミス防止

---

## v4.38.0 (2025-12-16)

### 機能強化

#### 週報・月報の全担当者対応
- 週報・月報に外構担当者別セクションを追加（🌳アイコン）
- 週報・月報に不動産担当者別セクションを追加（🏠アイコン）
- 各担当者の案件進捗が一覧で確認可能に

#### CSVエクスポート強化
- 分析CSVにIC/外構/不動産担当者カラムを追加
- kintoneエクスポートにIC/外構/不動産担当者カラムを追加

#### QuickEdit全担当者対応
- プロジェクトカードのIC担当者をクリックで即変更可能に
- プロジェクトカードの外構担当者をクリックで即変更可能に
- プロジェクトカードの不動産担当者をクリックで即変更可能に
- ドロップダウンに（未設定）オプションを追加

---

## v4.37.0 (2025-12-16)

### 不動産担当カテゴリ追加

#### 新機能
- **不動産担当者カテゴリ**: 設計・IC・外構に加え、不動産担当者を追加
- **案件への不動産担当割り当て**: 案件編集画面で不動産担当者を選択可能
- **サイドバー表示**: 不動産担当者ごとの案件数を表示
- **フィルタリング**: 不動産担当者で案件をフィルタリング可能
- **カテゴリ切り替え**: 不動産担当画面への切り替えボタン追加

#### 表示
- プロジェクトカードに「不動産：担当者名」を表示
- サイドバーに🏠アイコン付きの不動産担当セクション追加
- スタッフ管理画面に不動産担当テーブル追加

#### マイグレーション
- `archideck/sql/migrations/v6_add_realestate_assignee.sql` を追加
- Supabaseで実行することで不動産担当機能が有効化

---

## v4.36.0 (2025-12-16)

### UI/UX改善

#### IC担当者専用の進捗バー追加
- プロジェクトカードに設計進捗とIC進捗を分けて表示
- 設計進捗（緑）: 設計タスクの完了率
- IC進捗（青）: ICタスクの完了率
- IC担当者が未設定の案件ではIC進捗バーは表示されない

#### オリジナル/GRAFTECT選択時のメールボタン制御
- キッチン・カップボードで「オリジナル」「GRAFTECT」を選択した場合、メールボタンを非表示
- 社内で対応するため外部メール不要な選択肢を適切に処理

#### メーカー選択時のツールチップ
- IC業務のメーカー選択ドロップダウンにホバーツールチップを追加
- メーカーを選択すると「📧 〇〇にメール送信可能」と表示
- 対象タスク: キッチン、お風呂、洗面、トイレ、照明、建具、カーテン、造作、家具

#### ステータス変更時の動的UI更新
- メーカーを変更した際にメールボタンの表示/非表示がリアルタイムで切り替わる
- ツールチップもステータス変更時に動的に更新

#### コード品質改善
- IC関連定数（IC_MAKER_TASKS, INTERNAL_STATUSES）をグローバル化
- 3箇所で重複していた定義を1箇所に集約し保守性向上

### 人時生産性への寄与評価

| 機能 | 効果 | 寄与度 |
|------|------|--------|
| **IC進捗バー** | IC担当者が自分のタスク進捗を一目で確認可能。設計/IC間の業務分担が可視化され、進捗会議の時間短縮 | ⭐⭐⭐ 時短・業務配分最適化 |
| **21項目のICタスク** | IC業務フローの標準化により、漏れ・抜けを防止。新人でもチェックリスト形式で業務遂行可能 | ⭐⭐⭐⭐ ミスロス軽減・標準化 |
| **メーカー連動メール** | メーカー選択→メール送信が1クリック。手動で宛先を探す手間を削減（1案件あたり約5-10分短縮） | ⭐⭐⭐⭐ 時短 |
| **社内対応ステータス** | オリジナル/GRAFTECT選択時はメールボタン非表示で誤送信防止 | ⭐⭐ ミスロス軽減 |
| **ツールチップ** | 操作前に送信先を確認でき、誤送信リスクを低減 | ⭐⭐ ミスロス軽減 |
| **色分け表示** | 進行中（黄）/完了（青）が一目で分かり、状況把握が即時に | ⭐⭐⭐ 時短 |

**総合評価**: v4.35.0〜v4.36.0の改善により、IC担当者1人あたり **週1〜2時間の業務効率化** が見込まれる。
特にメーカー連動メールとタスク標準化の効果が大きく、ミス防止による手戻り削減も期待できる。

---

## v4.35.0 (2025-12-16)

### IC業務内容の刷新

#### 新しいIC業務内容（21項目）
既存の8項目から21項目に拡張し、IC担当者の業務フローを完全にカバー:

1. **資金計画・引継書確認** - ステータス: -/確認済
2. **キッチン・カップボード** - メーカー選択（GRAFTECT/オリジナル/Lixil/Panasonic/Takarastandard）、メール機能
3. **お風呂** - メーカー選択（Lixil/Panasonic/Takarastandard）、メール機能
4. **洗面** - メーカー選択（TOTO/AICA/Lixil/Panasonic/Takarastandard）、メール機能
5. **トイレ** - メーカー選択（TOTO/Lixil/Panasonic）、メール機能
6. **照明プラン** - メーカー選択（ODELIC/DAIKO/KOIZUMI/Panasonic）、メール機能
7. **仕様書作成** - ステータス: -/作成済
8. **長期資料送付** - ステータス: -/送付済
9. **実施図** - ステータス: -/修正依頼済/図面チェック済
10. **外装プレゼン作成** - ステータス: -/作成済
11. **内装プレゼン作成** - ステータス: -/作成済
12. **建具プレゼン依頼** - ステータス: -/依頼済/保存済、メール機能
13. **タイルプレゼン作成** - ステータス: -/作成済
14. **外構への打合せ依頼** - ステータス: -/依頼済
15. **カーテン紹介** - ステータス: -/依頼済、メール機能
16. **造作業者紹介** - ステータス: -/無し/依頼済、メール機能
17. **家具見積依頼** - ステータス: -/無し/依頼済、メール機能
18. **確定図チェックリスト** - ステータス: -/実施済
19. **OP見積チェック** - ステータス: -/依頼済/保存済
20. **会議後確認事項送付** - ステータス: -/送付済
21. **確定図承認** - ステータス: -/依頼中/ダンドリワーク保存済

#### 色付けロジック
- 完了状態（最終ステータス）: 青色
- 進行中状態: 黄色
- 未着手（-）: 白色
- 特別処理: 造作業者紹介・家具見積依頼は「無し」も青色（該当なしの場合も完了扱い）

#### 新規業者カテゴリ追加
メーカー別メール送信に対応するための業者カテゴリを追加:
- キッチン、お風呂、洗面、トイレ、照明、建具、カーテン、造作、家具

#### メーカー選択に連動したメール送信
- キッチン、お風呂、洗面、トイレ、照明タスクで選択したメーカーに応じて、対応する業者へのメールが自動選択される
- 例: 照明プランで「Panasonic」を選択した状態でメールボタンを押すと、Panasonic照明の業者が優先的に選択される

#### タスク-業者紐づけ
- 各ICタスクに対応する業者カテゴリの業者を自動紐づけ
- 設定画面から個別にカスタマイズ可能

#### マイグレーションSQL
- `archideck/sql/migrations/v5_ic_tasks_update.sql` を追加
- Supabaseで実行することで新しいICタスクが有効になる
- 業者カテゴリ、業者、タスク-業者紐づけが自動設定される

#### 週報・月報のIC担当者対応
- 週報・月報にIC担当者別の案件状況セクションを追加
- ICタスクの主要ステータス（キッチン、お風呂、洗面、トイレ、照明、仕様書、実施図、確定図）を表示
- 設計担当者とIC担当者を別々のセクションで表示

#### 運用手順
1. Supabaseダッシュボードで `v5_ic_tasks_update.sql` を実行
2. 設定 > 🏢 業者・メール管理 から各メーカーのメールアドレスを設定
3. IC担当者が新しい21項目のタスクを利用開始

---

## v4.33.0 (2025-12-14)

### バグ修正

#### 申請GOリアルタイム更新
- タスク状態を変更した際、申請GOボタンの状態がリアルタイムで更新されるように修正
- 以前はページをリロードしないと申請GOの状態が反映されなかった
- パフォーマンス最適化：該当の案件カードのみを更新（全体再描画を回避）

#### デバッグログ追加
- 申請GO条件判定のログを追加（コンソールで条件チェック結果を確認可能）
- 各タスクの現在状態と必要状態を表示

---

## v4.32.0 (2025-12-14)

### 機能改善

#### 申請Go自動解除機能
- タスク状態を変更した際、申請Go条件から外れたら自動的にフラグを解除
- 完了済み状態（is_archived）も同時に解除
- ユーザーに警告トーストで通知

---

## v4.31.0 (2025-12-14)

### バグ修正

#### 申請Goロジック改善
- タスクキーを動的に検索するように変更（ハードコード依存を解消）
- データベースのタスク定義に基づいて条件をチェック
- 各タスクの「最終状態」を自動判定（state_optionsの最後の値）
- ツールチップも動的に生成

#### SRIハッシュ修正
- Supabase CDNの正しいSRIハッシュに修正

#### isDemoMode初期化順序修正
- 変数宣言を関数の前に移動（TDZエラー解消）

#### レポート機能改善
- 週報・月報のタスクステータス表示を動的に生成
- データベースのタスク定義に基づいて表示

---

## v4.30.0 (2025-12-14)

### 生産性向上（Phase 2）

#### 検索オートコンプリート
- 検索ボックスで過去の検索履歴と顧客名を候補表示
- 最大20件の検索履歴を自動保存
- 入力時にドロップダウンで候補選択可能

#### 右クリックメニュー対応
- 案件カード上で右クリックするとコンテキストメニューを表示
- 操作: 編集、お気に入り、選択、完了済み移動、削除
- マウス操作の効率化

---

## v4.29.0 (2025-12-14)

### 生産性向上（Phase 1）

#### キーボードショートカット拡張
- `Ctrl+E`: CSV出力
- `Ctrl+A`: 全案件選択（テキスト入力中以外）
- ヘルプ画面（Shift+?）に新ショートカットを追加

#### 保存フィードバック改善
- ステータス表示を3秒後に自動クリア
- 連続保存時のステータス表示が見やすく

#### デフォルト担当者機能
- 「全案件」タブでも最後に使用した担当者を自動選択
- 担当者選択の手間を削減

---

## v4.28.0 (2025-12-14)

### コード品質改善

#### 未使用コード削除
- `memoize`関数を削除（定義のみで未使用）

#### コードリファクタリング
- デザイナーフィルタリングを共通関数化
  - `getDesignersByCategory(category)` - 汎用ヘルパー関数
  - `getSekkeiDesigners()`, `getIcDesigners()`, `getExteriorDesigners()` - カテゴリ別ヘルパー
- 重複コードを削減し保守性向上

### セキュリティ強化

#### CDN SRI対応
- Supabase JSライブラリにSRI（Subresource Integrity）属性を追加
  - バージョンを2.87.1に固定
  - `integrity="sha256-..."` でファイル改ざん検知

---

## v4.27.0 (2025-12-14)

### UI改善

#### サイドバーデザイン統一
- 外構担当セクションのデザインを設計担当・IC担当と統一
  - 特別な左ボーダー（緑色）を削除
  - `sidebar-section-exterior` クラスを廃止

---

## v4.26.0 (2025-12-14)

### UI改善

#### 月報の視認性・モバイル対応
- ハードコードされた白色をCSS変数に変更（背景と文字が同化する問題を修正）
  - `.report-designer-section`: #FFFFFF → var(--bg-primary)
  - `.report-project-detail`: #F8FAFC → var(--bg-secondary)
  - `.report-status-tag`: ハードコード色 → CSS変数
- 左ボーダー色をプライマリカラーに統一
- スマホ表示の文字重なり修正
  - ヘッダー・担当者セクション・タイトルを縦並びに
  - ステータスタグのフォントサイズ縮小
  - 統計グリッドを2列に調整

### 機能削除（実用性のない機能を整理）

#### ガントチャート削除
- 進捗率の横棒グラフに過ぎず、実際のスケジュール管理には使えなかった

#### AI予測分析削除
- 実際にはAIではなく単純なif文ロジックだった

#### カレンダービュー削除
- 期限設定された案件のみ表示され、使用頻度が低かった

#### KPIカード削除
- 総案件数、完了済み、要注意案件、平均進捗率の表示
- 実務で活用されていなかった

#### 担当者別パフォーマンス表削除
- 担当案件数、完了率などの統計表
- 実務で活用されていなかった

#### タスク-テンプレート紐づけ削除
- 「旧システムです」と表示されるだけのデッドコード

### コード品質改善

#### 古い業者管理関数を削除
- V2版と重複していた旧関数を削除（約190行）
  - `renderVendors()` → `renderVendorsV2()`
  - `openVendorModal()` → `openVendorModalV2()`
  - `closeVendorModal()` → `closeVendorModalV2()`
  - `saveVendor()` → `saveVendorV2()`
  - `editVendor()` → `editVendorV2()`
  - `deleteVendor()` → `deleteVendorV2()`

### バグ修正

#### クラッシュ防止
- `openProjectModal`: 削除された案件を開こうとした時のnullチェック追加
- `formatDateTime`: 無効な日付でNaN表示される問題を修正

---

## v4.25.0 (2025-12-14)

### コード品質改善

#### 不要コードの削除
- 本番用console.log削除（申請GO条件チェック用デバッグログ、SaveGuardデバッグログ）
- 未使用スケルトンローディング関数削除（`showSkeletonLoading`, `hideSkeletonLoading`）

#### ModalManager統一
- 全モーダルをModalManagerで統一管理（Escapeキー・フォーカス管理の一貫性）
  - `openVendorModalV2` / `closeVendorModalV2`
  - `openCategoryModal` / `closeCategoryModal`
  - `openTaskModal` / `closeTaskModal`
  - `openFcModal` / `closeFcModal`

#### イベントリスナー蓄積防止
- `openFcModal`: カラーピッカー同期をHTML側のoninputに移動

#### 二重実行防止（SaveGuard）追加
- `saveCategory`: カテゴリ保存の連打防止
- `saveTask`: タスク保存の連打防止
- `saveTemplate`: テンプレート保存の連打防止
- `deleteFc`: FC削除の連打防止

---

## v4.24.0 (2025-12-14)

### セキュリティ修正

#### カスタマイズプレビューの安全性向上
- ロゴURL: http/httpsのみ許可、DOM操作でXSS防止
- カラー値: #RRGGBB形式のみ許可（CSS注入防止）
- null参照エラー防止のためのチェック追加
- 画像読み込みエラー時のフォールバック

#### ModalManager改善
- Escapeハンドラの蓄積を防止
- open()時に既存ハンドラを先に解除

---

## v4.23.0 (2025-12-14)

### 新機能

#### インタラクティブツアー（初めての方へ）
- 初回訪問時に自動でウェルカム画面を表示
- 5ステップのガイドツアー:
  1. サイドバー（担当者切り替え）
  2. 案件カード（詳細・進捗管理）
  3. 新規案件追加ボタン
  4. 検索・フィルター
  5. 設定画面
- ヘッダーに「❓」ボタン追加（いつでもツアー再開可能）
- ステップインジケーター（進捗表示）
- localStorageで完了状態を記憶

---

## v4.22.0 (2025-12-14)

### 安定性向上

#### 削除操作の二重実行防止
- 主要な削除関数にSaveGuard追加（連打対策）
  - `deleteVendorV2`, `deleteCategory`, `deleteProject`
  - `deleteDesigner`, `deleteTask`

#### Service Worker処理の順序制御
- キャッシュクリア → SW更新 → 再登録の順に実行
- Promise.allで並列処理しつつ各ステップを順次実行
- エラー時はlogErrorで記録

---

## v4.21.0 (2025-12-14)

### 堅牢性向上

#### UndoManager エラーハンドリング追加
- `revert()` / `apply()` の全DB操作にエラーチェック追加
- 失敗時は即座にエラーをthrowし、ユーザーに通知

#### saveTaskVendorMappings 修正
- 既存紐づけ削除時のエラーチェック追加
- 削除失敗時は新規挿入を中止

#### CSV読み込み検証追加
- 空ファイル/ヘッダーのみのファイルをチェック
- エラー時にユーザーへ通知

#### バックアップ復元のエラー通知
- 失敗件数をカウントして表示
- 部分的な失敗も警告として通知

#### 印刷機能のポップアップブロック対応
- `window.open` 失敗時にエラーメッセージ表示

---

## v4.20.0 (2025-12-14)

### UI改善

#### 月報の視認性向上
- 担当者セクション：白背景+境界線+影でカード化
- ステータスタグ：背景色とテキスト色のコントラスト改善
- プロジェクト詳細：左境界線を濃く、背景を薄いグレーに
- 全体的に読みやすさが大幅に向上

---

## v4.19.0 (2025-12-14)

### コード品質改善

#### エラーハンドリングの統一
- `loadTasksV2()` - エラー時に適切なログ出力と配列初期化を追加
- `loadVendorCategories()` - 同上
- `loadTaskVendorMappings()` - 冗長なデバッグログを削除、エラーハンドリングを統一

すべてのデータ読み込み関数で以下のパターンを統一:
1. エラー時は `logError()` でエラー出力
2. 変数を空配列で初期化（不整合防止）
3. `return` で早期終了

---

## v4.18.0 (2025-12-14)

### セキュリティ・品質改善

#### XSS対策
- `error.message`のinnerHTML使用箇所を修正（3箇所）
- CSVプレビューにエスケープ処理追加

#### 重複コード修正
- `toggleProjectTask`関数の重複を解消（2引数版を削除、3引数版に統一）
- タスク完了時にスタッフ別タスク一覧も更新するよう改善

#### 関数名の競合解消
- ドラッグ&ドロップ関数を用途別にリネーム:
  - `handleDesignerDrag*` - スタッフ並び替え用
  - `handleProjectDrag*` - 案件カード並び替え用
  - `handleMinutesDrag*` - 議事録アップロード用

---

## v4.17.0 (2025-12-14)

### コード品質改善

#### 重複コード削除
- `openEmailFromTask`関数の重複定義を削除（旧システム2つを削除、新システム1つに統一）
- 関連する未使用ヘルパー関数を削除（`updateVendorInfo`, `generateEmail`, `copyText`等）
- 約340行のデッドコードを削除

#### XSS対策追加（セレクトボックス）
- 商品選択ドロップダウン
- 業者カテゴリドロップダウン
- 設計担当者・IC担当者・外構担当者選択
- メールテンプレート選択（3箇所）
- 業者選択ドロップダウン（2箇所）
- 一括担当者変更モーダル

#### パフォーマンス改善
- N+1問題を解決：案件表示時の大量並列リクエストをバッチ処理化
- 同時リクエストを5件ずつに制限してAPIレート制限を回避

---

## v4.16.0 (2025-12-14)

### FC（フランチャイズ）管理機能

#### データベース
- `fc_organizations`テーブル追加（FC組織管理）
- `fc_staff`テーブル追加（FC所属スタッフ管理）
- SQLマイグレーションファイル: `archideck/sql/production/fc_management.sql`

#### 管理画面
- 設定 > 🏪 FC管理タブを追加
- FC一覧表示（名前、スラッグ、専用URL、ステータス）
- FC追加/編集モーダル
- ワンクリックでFC専用URLをコピー
- FC削除機能

#### FC専用URL発行
- `/fc/{slug}/` 形式のホワイトラベルURL
- FC組織ごとにカスタマイズ可能:
  - 組織名
  - ロゴURL
  - プライマリカラー
  - 連絡先情報

#### FC専用モード
- FC URLアクセス時に自動でFCモード適用
- FC組織のカスタム設定（ロゴ、色）を自動反映
- 管理者機能を非表示化
- 「Gハウス」ブランディングを自動削除

---

## v4.15.0 (2025-12-14)

### セキュリティ強化

#### XSS対策追加
- 業者一覧（会社名、担当者、TEL、Email）
- 商品一覧（商品名）
- タスク一覧（タスク名、業者名）
- カテゴリフィルター（カテゴリ名）
- メール作成画面（業者情報）
- プロジェクトタスク（タスク名、顧客名）

### コード品質改善

#### safeJsonParse関数追加
- localStorageからのJSON読み込み時のクラッシュ防止
- 適用箇所:
  - お気に入り（FavoritesManager）
  - フィルタープリセット（FilterPresets）
  - リマインダー（DeadlineManager）
  - テンプレート（TemplateManager）
  - バックアップ履歴
  - 外構タスク設定

#### 暗黙的event変数の修正
- `setCategoryFilter()`関数で暗黙的なevent変数使用を修正
- イベント引数を明示的に渡すよう変更

#### alert()をshowToast()に統一
- 業者読み込みエラーメッセージをtoast表示に変更

---

## v4.14.0 (2025-12-14)

### 機能削除

#### ダークモード削除
- ダークモード機能を完全削除（使用不可のため）
  - ヘッダーのトグルボタン削除
  - キーボードショートカット（Ctrl+D）削除
  - ヘルプメニューから削除
  - 全ダークモードCSS（約300行）削除
  - 関連JavaScript関数削除

### 二重クリック防止

#### SaveGuardユーティリティ追加
- 保存処理の二重実行を防止する`SaveGuard`ヘルパーを追加
- 適用箇所:
  - `saveProject()` - 案件保存
  - `saveVendorV2()` - 業者保存
  - `executeApplicationGo()` - 申請GO実行

### デバッグ機能

#### 申請GO条件ログ
- `canPressApplicationGo()`にコンソールログを追加
  - 各条件（太陽光、給排水、換気、サッシ）の状態を表示
  - 問題診断を容易に

---

## v4.13.0 (2025-12-14)

### セキュリティ改善

#### XSS対策
- `escapeHtml()`関数を以下の箇所に適用:
  - プロジェクトカード（顧客名、担当者、IC担当、外構担当、メモ）
  - カレンダービュー（顧客名、担当者）
  - 期限設定モーダル（顧客名）
  - ガントチャート（顧客名）
  - 週報・月報（顧客名、担当者名）

### UI/UX改善

#### モーダルのキーボードナビゲーション
- `ModalManager`ユーティリティを追加
  - Escapeキーでモーダルを閉じる
  - モーダル表示時に最初の入力欄にフォーカス
  - モーダルを閉じた時に元の位置にフォーカス復帰
- 対応モーダル: プロジェクト編集、メール作成、スタッフ管理、業者、テンプレート、タスク一覧、申請GO

#### 週報・月報のダークモード対応
- 以下の要素にダークモードスタイルを追加:
  - `.report-card` - 背景色を暗い青に
  - `.report-header h2` - 文字色を明るく
  - `.report-period` - 背景と文字色を調整
  - `.report-stat-item` - 背景色を暗く
  - `.report-section-title` - 文字色を明るく
  - `.report-list-item` - 背景色を暗く
  - `.report-project-name` - 文字色を明るく
  - `.report-designer-count` - 背景と文字色を調整

### バグ修正

#### 申請GOの条件チェック
- `executeApplicationGo()`で実行前に`canPressApplicationGo()`を再チェック
- 条件が満たされていない場合はエラーメッセージを表示して処理を中断
- 問題: 一度条件を満たすとその後条件を外しても進められていた

#### 完了済みセクションの表示
- オーバーライドされた`renderSidebar`関数に完了済みセクションが欠けていた問題を修正
- 「全案件」の直下に「✓ 完了済」セクションを追加

#### 議事録アップロードエラー
- 問題: ファイル名に日本語・スペースが含まれているとSupabase Storageが400エラーを返していた
- 修正: ストレージパスをASCII文字のみに変更（`{timestamp}_{日付}.{拡張子}`）
- DBには元の日本語ファイル名（`日付_案件名_担当者.pdf`）を保存

### パフォーマンス改善

#### メモリリーク修正
- `URL.revokeObjectURL()`を以下の関数に追加:
  - `downloadLocalBackup()` - バックアップダウンロード後
  - `createBackup()` - 自動バックアップ後
  - CSVエクスポート機能 - ダウンロード後

#### DOM描画タイミング調整
- カード描画後のタスク読み込み遅延を50ms→100msに調整
- DOM描画の完了を確実に待つように改善

---

## v4.12.0 (2025-12-14)

### UI/UX改善

#### 業務内容の改善
- タスクの期限入力を削除（シンプル化）
- 0回目打合せにステータス追加（-・実施済）
- ステータス変更時に画面がリセットされる問題を修正
  - カード単位で再描画（セクションの開閉状態を保持）

#### 要対応案件機能の削除
- alertSummary（🚨 要対応案件）セクションを削除
- 不要なアラート機能を整理

#### スタッフ管理の改善
- スタッフ追加時にサイドバーが即座に更新されるように修正
- スタッフ管理画面に外構担当を表示
- スタッフ編集機能を追加（名前変更・メールアドレス変更・カテゴリ変更）
- 名前変更時に関連案件の担当者名も自動更新

#### ダークモードの改善
- 全コンポーネントでCSS変数を使用するように修正
- ハードコードされた背景色を変数化
- サイドバー、フォーム入力、テーブルのコントラスト改善
- 分析画面（KPIカード、パフォーマンステーブル、レポート）のダークモード対応
- data-tableスタイルを追加

#### 自動レポート機能の改善
- 週報・月報をHTMLカード形式に刷新
- 統計グリッドで主要KPIを視覚的に表示
- 進捗バッジでプロジェクト状況を色分け表示
- ダークモード対応のレポートスタイル追加
- 担当者ごとにグループ化表示
  - 各案件のタスクステータス（太陽光、給排水、換気、サッシ等）を表示
  - 更新のあった案件にバッジ表示（週報: 📝 今週更新 / 月報: 今月更新）
  - 担当者名と案件数をヘッダーに表示

#### 申請Go機能の刷新
- 条件達成時のみクリック可能なボタンに変更
  - 条件: 太陽光(営業共有済)、給排水(保存済)、換気(保存済)、サッシ(保存済)
- フルワイドの目立つデザインに変更（🚀アイコン、矢印アニメーション）
- 確認モーダルで条件チェック状況を表示
- クリックで案件を「完了済」に移動

#### 完了済BOX機能
- サイドバーに「✓ 完了済」セクションを追加
- 完了済案件の一覧表示
- チェックボックスを外すと担当者に復元
- 復元時は自動で担当者タブに切り替え

### パフォーマンス・品質改善

#### コンソール出力の制御
- DEBUG_MODEフラグによる出力制御を導入
- console.log/warn/error を全て制御関数に置換（171+箇所）
- 本番環境ではコンソール出力を完全に抑制

#### エラーハンドリングの統一
- 詳細なエラーメッセージ表示
- PostgreSQLエラーコード別のユーザーフレンドリーなメッセージ

### データベース修正
- project_tasks テーブルのRLS無効化SQL追加
  - タスク追加時の権限エラー（42501）を解決

### コード品質改善

#### ハードコード色のCSS変数化
- インラインスタイルの色指定をCSS変数に統一
- 完了済セクション、外構担当などの色を変数化

#### カード警告表示の削除
- 「間取確定が未完了」「申請GOが未完了」などの警告バッジを削除
- カード表示をシンプル化

#### キーボードショートカット改善
- Escキーでモーダルを閉じる処理を修正（.showクラス対応）

---

## v4.11.0 (2025-12-14)

### 大型機能追加

#### クイック編集 (QuickEdit)
- 担当者名をクリックで直接変更可能
- ドロップダウンメニューから担当者を選択
- モーダルを開かずに素早く変更

#### 期限・リマインダー (DeadlineManager)
- 案件ごとに期限を設定可能
- 期限バッジをカードに表示（色で状態を識別）
- 期限3日前から自動でリマインダー通知
- 期限超過時は警告表示

#### カレンダービュー (CalendarView)
- 新しい「📅 カレンダー」タブ
- 月間カレンダー形式で案件を表示
- 期限が設定された案件を日付にマッピング
- 日付クリックで案件一覧をポップアップ表示

#### プロジェクトテンプレート (TemplateManager)
- 案件の設定をテンプレートとして保存
- 新規/既存案件にテンプレートを適用
- テンプレート管理画面で一覧・削除
- 商品仕様と進捗設定をテンプレート化

#### モバイルスワイプ操作 (MobileGestures)
- 右スワイプ: お気に入り登録/解除
- 左スワイプ: 完了済みに変更（進捗100%時のみ）
- スワイプ中の視覚的フィードバック

---

## v4.10.0 (2025-12-14)

### フィルタープリセット機能

#### FilterPresets
- 現在のフィルター条件を名前付きで保存
- ワンクリックで保存済みプリセットを適用
- 保存される条件:
  - 担当者タブ
  - ステータスフィルター（アクティブ/完了済み/お気に入り）
  - 検索キーワード
  - 商品仕様フィルター
- プリセット削除機能
- localStorage保存（ブラウザ間で永続化）

#### UI
- ツールバーに「📋 プリセット」ドロップダウン追加
- プリセット一覧にフィルター内容の概要を表示
- 「+ 保存」ボタンで現在の条件を保存

---

## v4.9.0 (2025-12-14)

### お気に入り＆バッチ操作

#### FavoritesManager
- 案件をお気に入りに登録/解除
- ★マークで視覚的に識別
- お気に入りは常にリスト先頭に表示
- 「★ お気に入り」フィルターで絞り込み
- localStorage保存（ブラウザ間で永続化）

#### BatchOperations
- 複数案件の一括選択
- 「☑ 全選択」ボタン
- 選択ツールバー（画面下部に固定表示）
- 一括完了（アーカイブ）
- 一括担当者変更

#### UI/UX
- お気に入りカードは黄色ボーダーでハイライト
- 選択カードは青枠でハイライト
- 各カードにチェックボックスと★ボタン追加

---

## v4.8.0 (2025-12-14)

### データインポート＆セッション管理

#### DataImporter
- CSV/JSONファイルからの案件インポート
- ファイル選択時のプレビュー表示
- 重複チェック（スキップオプション）
- エクスポートしたファイルの再取り込み対応

#### SessionManager
- 60分間操作なしでタイムアウト
- 残り5分で警告表示
- 「セッションを延長」ボタン
- 自動ログアウト

#### UI改善
- ツールバーに「📥 取込」ボタン追加
- 「📤 出力」ボタンでエクスポート

---

## v4.7.0 (2025-12-14)

### Undo/Redo機能追加

#### UndoManager実装
- 操作履歴スタック（最大50操作）
- タスク完了/未完了の取り消し
- 期限設定の取り消し
- 状態変更の取り消し
- Redo（やり直し）対応

#### キーボードショートカット
- `Ctrl/Cmd + Z`: 元に戻す
- `Ctrl/Cmd + Shift + Z`: やり直す
- `Ctrl/Cmd + Y`: やり直す（Windows標準）

#### UI
- ヘッダーにUndo/Redoボタン追加（↩️/↪️）
- 操作がない時は無効化表示
- ツールチップで最後の操作を表示
- トースト通知で操作内容を表示

---

## v4.6.0 (2025-12-14)

### 大幅UX/アクセシビリティ改善

#### ダークモード
- システムテーマ自動検出
- ヘッダーにトグルボタン追加（🌙/☀️）
- localStorage永続化
- 全CSS変数のダークテーマ対応
- 滑らかな切り替えトランジション

#### キーボードショートカット
- `Ctrl/Cmd + N`: 新規案件作成
- `Ctrl/Cmd + S`: データ同期
- `Ctrl/Cmd + D`: ダークモード切替
- `Ctrl/Cmd + K`: 検索フォーカス
- `Escape`: モーダル/サイドバーを閉じる
- `Shift + ?`: ショートカットヘルプ表示

#### アクセシビリティ（WCAG準拠）
- スキップリンク追加（メインコンテンツへジャンプ）
- ARIA属性追加（role, aria-label）
- スクリーンリーダー用ライブリージョン
- フォーカス表示の強化（3pxアウトライン）
- 高コントラストモード対応（prefers-contrast: high）
- 動き軽減モード対応（prefers-reduced-motion）
- `announceToScreenReader()`関数追加

#### 印刷スタイル
- 印刷用CSS最適化
- 不要UI要素の非表示化
- 案件カードのpage-break対応
- A4サイズ最適化

#### パフォーマンス最適化
- `debounce()`関数追加（検索入力250ms遅延）
- `throttle()`関数追加
- `memoize()`関数追加（TTL付きキャッシュ）
- `requestIdleCallback`ポリフィル
- 検索入力にデバウンス適用

#### ブラウザ通知システム
- `NotificationSystem`オブジェクト追加
- 通知許可リクエスト機能
- 期限間近タスク通知
- 通知音（WebAudio API）
- 通知音ON/OFF設定

#### エクスポート機能強化
- `ExportManager`オブジェクト追加
- エクスポートモーダル追加
- CSV/JSON/印刷用レポートの3形式対応
- タスク詳細含む/含まないの選択
- アクティブ案件のみフィルタ
- 印刷用レポート（新ウィンドウで開く）

---

## v4.5.0 (2025-12-14)

### 包括的品質改善

#### メール送信機能強化
- Gmail、Outlook両対応
- メール内容コピー機能追加
- 送信履歴ログ機能（将来実装用準備）
- XSS対策適用（業者名・連絡先のエスケープ）

#### セキュリティ強化
- `escapeHtml()`を全ユーザー入力に適用
- メールモーダル内のXSS脆弱性修正
- `Validators`オブジェクト追加（メール、パスワード、電話番号、日付検証）

#### エラーハンドリング改善
- `ErrorHandler`オブジェクト追加
- Supabaseエラーコードの日本語変換
- ユーザーフレンドリーなエラーメッセージ表示
- 統一されたエラーログ機能

#### モバイル対応強化
- タッチターゲット44px以上に拡大
- iOS zoom防止（font-size: 16px）
- モーダル全画面化
- 超小画面（360px以下）対応
- タッチデバイスのホバー無効化
- スケルトンローディングCSS追加

#### データ検証
- 過去日付チェック（タスク期限設定時に警告）
- メールアドレス形式検証
- パスワード強度検証（8文字以上、英数字混在）
- 電話番号形式検証

#### FC管理API本実装
- Supabaseで組織作成
- サブスクリプション自動作成
- 管理者ユーザー作成
- organization_members登録

#### スケルトンローディング
- `showSkeletonLoading()`関数追加
- カード、リスト、テーブル3種類のスケルトン
- シマーアニメーション

---

## v4.4.0 (2025-12-14)

### FC（フランチャイズ）管理機能

#### FC管理画面（本部専用）
- 管理者ダッシュボードに「FC管理」セクション追加
- FC一覧：全FCの一覧表示、検索、ステータス管理
- FC新規作成：FCの登録フォーム、専用URL自動生成
- FCデータ閲覧：FCごとのデータ閲覧（サマリー、案件、スタッフ、タスク進捗）

#### FC一覧機能
- KPIカード（FC総数、アクティブFC、FC総案件数、今月新規FC）
- FC検索（名前、スラッグ、メールで検索）
- 専用URLのコピー機能
- FCステータス切り替え（アクティブ/停止）

#### FC新規作成機能
- FC名、URLスラッグ、管理者メール、電話番号の入力
- 専用URLの自動生成・プレビュー
- 初期パスワードの自動生成
- プラン選択（スターター/プロフェッショナル/エンタープライズ）
- 作成完了時に情報サマリーを表示

#### FCデータ閲覧機能
- FC選択プルダウン
- データ種別切り替え（サマリー/案件一覧/スタッフ一覧/タスク進捗）
- FC情報詳細表示
- CSVエクスポート機能

#### FC展開方針
- パターンB（FC別URL）を採用
- 各FCに専用URLを発行（例：https://archideck.vercel.app/fc/sample-fc/）
- FCはGハウス本部がデータを閲覧できることを認識しない設計

#### FC向けホワイトラベル版
- `/fc/` ディレクトリにFC専用エントリーポイント作成
- URLパラメータ（`?fc=slug`）またはlocalStorageでFCモード検出
- FCモード時の自動UI調整:
  - 「Gハウス」ブランディング非表示
  - タイトルを「設計業務管理システム」に変更
  - 管理者ボタン・カテゴリ切り替えを非表示
  - ヘッダーロゴを「ArchiDeck」に統一
- `detectFCMode()`: FCモード自動検出
- `applyFCMode()`: FCモードUI適用
- `exitFCMode()`: FCモード解除

---

## v4.3.0 (2025-12-14)

### 安定性向上 & 機能整理

#### キャッシュ問題修正
- Service Workerキャッシュをv2に更新
- ページ読み込み時の自動キャッシュクリア機能追加
- ヘッダーにデバッグボタン追加（🔄リロード、🔍デバッグ情報）
- バージョン番号にタイムスタンプを付与してキャッシュ破棄

#### 設定画面の再構成
- 「タスク管理」を「業務管理」に変更
- 「設計業務管理」と「IC業務管理」を別タブに分離
- 「外構業務管理」タブを新規追加
- 外構タスクのカスタマイズ機能（ステータスオプション編集可能）

#### 自動バックアップ機能
- 5分ごとの自動ローカルバックアップ
- トグルスイッチでON/OFF切り替え可能
- LocalStorage使用（5MB制限内）
- 最終バックアップ日時表示

#### バグ修正
- デモモードのnullエラー修正（currentUser?.email対応）
- Service Worker/manifestの404エラー修正（絶対パスに変更）
- 案件・スタッフが表示されない問題を解消

#### サイドバー色分け機能完全実装
- 設計担当・IC担当・外構担当の全セクションで色分け対応
- 4件以下: 青色（通常）
- 5件以上: 黄色（注意）
- 7件以上: 名前が赤色 + カウント黄色（警告）

#### 分析ダッシュボード（完全実装確認済み）
- KPIカード（総案件数、完了済み、要注意案件、平均進捗率）
- AI予測分析（遅延リスク予測、推奨アクション）
- ガントチャート（月表示、前月/次月ナビゲーション）
- 担当者別パフォーマンス表
- 自動レポート生成（週報/月報）
- CSVエクスポート
- 分析画面の縦スクロール改善

#### タスク期限・遅延通知機能（新機能）
- 各タスクに期限日を設定可能
- 遅延タスクは赤色背景で強調表示
- 期限間近（3日以内）は黄色で警告
- 遅延日数をバッジで表示（「○日遅延」「本日期限」「あと○日」）
- アラートサマリーに遅延タスク数を表示

#### パスワード機能強化
- ログイン画面に「パスワードを忘れた方」リンク追加
- Supabase resetPasswordForEmail APIでメール再設定対応
- スタッフ自身でパスワード再発行可能

#### 物件名の視認性向上
- 案件カードの物件名に淡いブルー背景を追加
- ホバー時に背景色が変化

#### 用語の統一
- システム全体で「設計士」→「スタッフ」に統一
- コンソールログ、エラーメッセージも統一

---

## v4.2.0 (2025-12-13)

### プレミアムUI & FC展開対応

#### UIデザイン全面刷新
- プレミアムカラーパレット（Deep Ocean Blue + Emerald Green）
- 洗練されたシャドウとトランジション効果
- グローバルスクロールバースタイリング
- アニメーションユーティリティクラス追加
- プロジェクトカードのホバーエフェクト改善

#### FC向けノーコードカスタマイズ
- 設定画面に「カスタマイズ」タブ追加
- 会社名・ロゴURL設定
- メインカラー/アクセントカラー設定（カラーピッカー）
- リアルタイムプレビュー機能
- 組織別ホワイトラベル適用

#### 議事録機能強化
- 複数ファイル保存対応
- ファイル一覧表示
- 個別削除機能
- ファイルサイズ表示

#### kintone連携
- CSVインポート機能
- CSVエクスポート機能
- フィールドマッピング設定

#### バックアップ機能
- 全データJSONエクスポート
- JSONからの復元機能
- 復元前の注意事項表示

#### 品質向上
- 案件カード初期状態：全セクション閉じた状態
- 不要ページ削除（landing.html, signup.html）
- CSSの整理・最適化

---

## v4.1.0 (2025-12-13)

### UX改善 - 販売レベルへの品質向上

#### 案件カード改善
- 5部構成の順番を変更（タスク→メモ→議事録→引継書→業務内容）
- 業務内容は初期表示で開いた状態、他は閉じた状態
- ドラッグ&ドロップで議事録ファイルをアップロード可能に

#### モバイル対応強化
- スマートフォン・タブレットでの操作性向上
- タッチ操作に最適化されたボタンサイズ
- 横スクロール可能なタブナビゲーション
- レスポンシブなフォーム入力

#### ログイン機能
- 開発中のためパスワード無しログイン機能追加
- デモモードでの動作確認が可能

#### 管理者ダッシュボード
- デモモード追加（アカウントなしで画面確認可能）
- 全ボタン・機能の動作を実装
- 組織の追加・編集・削除機能
- プランの追加・編集機能
- サブスクリプション詳細表示
- 監査ログのCSVエクスポート
- ユーザードロップダウンメニュー

#### 外構依頼
- ステータス名を簡略化（「ヒアリングシート＋3DSデータ：UP済」→「UP済」）

---

## v4.0.0 (2025-12-13)

### SaaS版マルチテナント対応 - 100社販売に向けて

#### 新規ページ
- **ランディングページ** (`landing.html`): 新規顧客向けの営業ページ
- **会社登録ページ** (`signup.html`): 3ステップのサインアップフロー
- **管理者ダッシュボード** (`admin/index.html`): スーパーアドミン用管理画面

#### マルチテナント対応
- 組織（会社）テーブル追加
- サブスクリプション管理テーブル追加
- 組織メンバー管理
- RLSポリシーによるデータ分離
- 招待トークンによるユーザー招待機能

#### 料金プラン
| プラン | 月額 | ユーザー | 案件 |
|-------|------|---------|------|
| スターター | ¥9,800 | 5名 | 100件 |
| プロフェッショナル | ¥19,800 | 15名 | 500件 |
| エンタープライズ | ¥49,800 | 50名 | 無制限 |

#### ホワイトラベル対応
- 会社ロゴのカスタマイズ
- プライマリカラー・セカンダリカラーの変更
- タイトル・ファビコンのカスタマイズ
- カスタムドメイン対応（エンタープライズプラン）

#### 管理者ダッシュボード機能
- KPIダッシュボード（総組織数、アクティブユーザー、月間売上）
- 組織管理（追加・編集・検索）
- サブスクリプション管理
- プラン設定
- 監査ログ

#### SQLマイグレーション
```sql
-- 新規テーブル
organizations          -- 組織情報
subscriptions          -- サブスクリプション
plans                  -- プランマスタ
organization_members   -- 組織メンバー
invitations            -- 招待トークン
audit_logs             -- 監査ログ
super_admins           -- スーパーアドミン
usage_stats            -- 使用量統計
```

---

## v3.0.0 (2025-12-13)

### 大規模リニューアル - ArchiDeckへリブランディング

#### システム名変更
- 旧名称: 設計・IC業務管理システム / nandemo
- 新名称: **ArchiDeck** (Gハウス 設計業務管理システム)

#### フォルダ・URL変更
- フォルダ: `sekkei` → `archideck`
- GitHub: `nandemo` → `archideck`
- Vercel: `nandemo` → `archideck`
- 本番URL: `https://archiceck.vercel.app/archideck/index.html`

#### 商品マスタ名称変更
- `LIFEリミ` → `LIFE Limited`
- `LIFE+リミ` → `LIFE+ Limited`

#### タスク定義変更

**削除したタスク:**
- 1回目打合せ、2回目打合せ、3回目打合せ
- 見積、契約、構造図書類、確認済証、図面等納品

**追加したタスク:**
1. 契約書・引継書チェック
2. 現地調査
3. 間取確定
4. 面積チェック
5. チェックリスト
6. 引継書入力
7. 外構依頼
8. 実施図依頼
9. 地盤調査

**名称変更:**
- エボルツ依頼 → evoltz依頼
- サッシプレゼン → サッシ依頼
- 確認申請 → 申請GO
- 換気図面 → 換気図依頼
- 給排水設備図面 → 給排水依頼

**ステータスオプション更新:**
- 構造依頼: ラフチェック / 構造GO / 1回目CB / 2回目CB / 変更契約前会議UP / 確定図をダンドリワークUP
- evoltz依頼: 候補図依頼 / 候補図保存済 / 確定図依頼 / 確定図保存済
- 太陽光依頼: 依頼済 / 保存済 / 営業共有済

#### 新機能

**5部構成カードUI:**
1. 業務内容（タスクチェックボックス）
2. タスク（カスタムタスク追加）
3. メモ欄（IC・外構共有）
4. 議事録（ファイルアップロード）
5. 引継書（内容保存）

**外構担当機能:**
- アカウント選択画面に外構担当追加
- スタッフ管理に外構担当カテゴリ追加
- サイドバーに外構担当セクション追加（緑色アクセント）
- 案件モーダルに外構担当フィールド追加

**サイドバー色分け表示:**
- 4件以下: 青色
- 5件以上: 黄色
- 7件以上: 名前が赤色

**申請GO条件チェック:**
以下の条件を満たさないと押せない:
- 太陽光依頼が「営業共有済」
- 給排水依頼が「保存済」
- 換気図依頼が「保存済」
- サッシ依頼が「保存済」

**担当者タスク一覧:**
- サイドバーの各担当者名横に📋ボタン
- クリックでタスク一覧モーダル表示
- 期限順/邸名順の切り替え可能

**kintone連携設定:**
- ドメイン設定
- アプリID設定
- APIトークン設定
- 接続テスト機能

**議事録アップロード:**
- Supabase Storageへのファイルアップロード
- PDF, Word, Excel対応

**共有メモ・引継書:**
- IC・外構も見られる共有メモ欄
- 引継書の入力・保存機能

#### 新規テーブル（SQL）
1. `project_tasks` - 案件タスク管理
2. `project_minutes` - 議事録管理
3. `notifications` - 通知管理
4. `project_handovers` - 引継書管理
5. `kintone_settings` - kintone連携設定

#### projectsテーブル新カラム
- `exterior_assignee` - 外構担当
- `shared_memo` - 共有メモ
- `kintone_record_id` - kintone連携用
- `layout_confirmed_date` - 間取確定日
- `construction_permit_date` - 着工許可日
- `pre_contract_meeting_date` - 変更契約前会議日

---

## v2.0.0 (2025-11)

### カスタマイズ可能システム

- 業者管理機能
- タスク-業者紐づけ
- メールテンプレート管理
- IC担当機能追加
- アーカイブ機能

---

## v1.0.0 (2025-10)

### 初期リリース

- 案件管理（CRUD）
- 16種類のタスク進捗管理
- 設計士管理
- Supabase認証
