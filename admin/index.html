<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ArchiDeck</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>âš™ï¸</text></svg>">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@300;400;500;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary: #6366F1;
  --primary-dark: #4F46E5;
  --secondary: #10B981;
  --danger: #EF4444;
  --warning: #F59E0B;
  --text: #1F2937;
  --text-light: #6B7280;
  --bg: #F3F4F6;
  --bg-dark: #111827;
  --card: #FFFFFF;
  --border: #E5E7EB;
}

body {
  font-family: 'Inter', 'Noto Sans JP', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
.sidebar {
  position: fixed;
  left: 0;
  top: 0;
  bottom: 0;
  width: 260px;
  background: var(--bg-dark);
  color: white;
  padding: 24px 16px;
  overflow-y: auto;
}

.sidebar-logo {
  font-size: 22px;
  font-weight: 800;
  padding: 0 12px 24px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 24px;
}

.sidebar-logo span {
  color: var(--primary);
}

.sidebar-section {
  margin-bottom: 24px;
}

.sidebar-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.4);
  padding: 0 12px;
  margin-bottom: 8px;
}

.sidebar-nav {
  list-style: none;
}

.sidebar-nav a {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  color: rgba(255,255,255,0.7);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.2s;
}

.sidebar-nav a:hover {
  background: rgba(255,255,255,0.05);
  color: white;
}

.sidebar-nav a.active {
  background: var(--primary);
  color: white;
}

.sidebar-nav .icon {
  font-size: 18px;
  width: 24px;
  text-align: center;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.main {
  margin-left: 260px;
  min-height: 100vh;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header {
  background: var(--card);
  border-bottom: 1px solid var(--border);
  padding: 16px 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-title {
  font-size: 24px;
  font-weight: 700;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 16px;
  background: var(--bg);
  border-radius: 8px;
  cursor: pointer;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--primary);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}

/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.content {
  padding: 32px;
}

/* KPIã‚«ãƒ¼ãƒ‰ */
.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.kpi-card {
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  border: 1px solid var(--border);
}

.kpi-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 16px;
}

.kpi-label {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-light);
}

.kpi-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.kpi-icon.blue { background: rgba(99, 102, 241, 0.1); }
.kpi-icon.green { background: rgba(16, 185, 129, 0.1); }
.kpi-icon.yellow { background: rgba(245, 158, 11, 0.1); }
.kpi-icon.red { background: rgba(239, 68, 68, 0.1); }

.kpi-value {
  font-size: 36px;
  font-weight: 800;
  line-height: 1;
  margin-bottom: 8px;
}

.kpi-change {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 13px;
  font-weight: 600;
}

.kpi-change.positive { color: var(--secondary); }
.kpi-change.negative { color: var(--danger); }

/* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ãƒ‰ */
.table-card {
  background: var(--card);
  border-radius: 16px;
  border: 1px solid var(--border);
  overflow: hidden;
  margin-bottom: 32px;
}

.table-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.table-title {
  font-size: 18px;
  font-weight: 700;
}

.table-actions {
  display: flex;
  gap: 12px;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th {
  padding: 14px 24px;
  text-align: left;
  font-size: 12px;
  font-weight: 700;
  color: var(--text-light);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
}

.table td {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

.table tbody tr:hover {
  background: var(--bg);
}

.table tbody tr:last-child td {
  border-bottom: none;
}

/* ãƒãƒƒã‚¸ */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: 50px;
  font-size: 12px;
  font-weight: 600;
}

.badge-active {
  background: rgba(16, 185, 129, 0.1);
  color: var(--secondary);
}

.badge-trial {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
}

.badge-cancelled {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
}

.badge-suspended {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning);
}

/* ãƒœã‚¿ãƒ³ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
  text-decoration: none;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
}

.btn-secondary {
  background: var(--bg);
  color: var(--text);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: var(--border);
}

.btn-small {
  padding: 6px 12px;
  font-size: 13px;
}

.btn-icon {
  width: 36px;
  height: 36px;
  padding: 0;
  border-radius: 8px;
}

/* æ¤œç´¢ */
.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  width: 280px;
}

.search-box input {
  border: none;
  background: none;
  font-size: 14px;
  width: 100%;
  outline: none;
  font-family: inherit;
}

/* ãƒãƒ£ãƒ¼ãƒˆã‚¨ãƒªã‚¢ */
.chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.chart-card {
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  border: 1px solid var(--border);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.chart-title {
  font-size: 16px;
  font-weight: 700;
}

.chart-placeholder {
  height: 200px;
  background: var(--bg);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-light);
  font-size: 14px;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(4px);
}

.modal.show {
  display: flex;
}

.modal-content {
  background: var(--card);
  border-radius: 16px;
  width: min(600px, 90vw);
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
}

.modal-close {
  width: 32px;
  height: 32px;
  border: none;
  background: var(--bg);
  border-radius: 8px;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-body {
  padding: 24px;
}

.modal-footer {
  padding: 20px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text);
}

.form-input,
.form-select {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  transition: border-color 0.2s;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--primary);
}

/* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */
.login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-dark);
}

.login-card {
  background: var(--card);
  border-radius: 16px;
  padding: 48px;
  width: min(420px, 90vw);
  text-align: center;
}

.login-card h1 {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 8px;
}

.login-card .subtitle {
  color: var(--text-light);
  margin-bottom: 32px;
  font-size: 14px;
}

/* ã‚¿ãƒ–ãƒ‘ãƒãƒ« */
.tab-panel {
  display: none;
}

.tab-panel.active {
  display: block;
}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  padding: 16px 24px;
  background: var(--text);
  color: white;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 1000;
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

.toast.error { background: var(--danger); }
.toast.success { background: var(--secondary); }

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 768px) {
  .sidebar {
    display: none;
  }
  .main {
    margin-left: 0;
  }
  .kpi-grid {
    grid-template-columns: 1fr;
  }
  .chart-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div id="loginContainer" class="login-container">
  <div class="login-card">
    <h1>ArchiDeck Admin</h1>
    <p class="subtitle">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>

    <div class="form-group">
      <input type="email" class="form-input" id="loginEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
    </div>
    <div class="form-group">
      <input type="password" class="form-input" id="loginPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    </div>
    <button class="btn btn-primary" style="width: 100%;" onclick="signIn()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  </div>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
<div id="mainContainer" style="display: none;">
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <div class="sidebar-logo">Archi<span>Deck</span> Admin</div>

    <div class="sidebar-section">
      <div class="sidebar-label">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
      <ul class="sidebar-nav">
        <li><a href="#dashboard" class="active" onclick="showTab('dashboard')"><span class="icon">ğŸ“Š</span>æ¦‚è¦</a></li>
        <li><a href="#organizations" onclick="showTab('organizations')"><span class="icon">ğŸ¢</span>çµ„ç¹”ç®¡ç†</a></li>
        <li><a href="#subscriptions" onclick="showTab('subscriptions')"><span class="icon">ğŸ’³</span>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</a></li>
        <li><a href="#users" onclick="showTab('users')"><span class="icon">ğŸ‘¥</span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</a></li>
      </ul>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-label">è¨­å®š</div>
      <ul class="sidebar-nav">
        <li><a href="#plans" onclick="showTab('plans')"><span class="icon">ğŸ“‹</span>ãƒ—ãƒ©ãƒ³ç®¡ç†</a></li>
        <li><a href="#settings" onclick="showTab('settings')"><span class="icon">âš™ï¸</span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</a></li>
        <li><a href="#logs" onclick="showTab('logs')"><span class="icon">ğŸ“</span>ç›£æŸ»ãƒ­ã‚°</a></li>
      </ul>
    </div>
  </aside>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main">
    <header class="header">
      <h1 class="header-title" id="pageTitle">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div class="header-actions">
        <div class="search-box">
          <span>ğŸ”</span>
          <input type="text" placeholder="æ¤œç´¢...">
        </div>
        <div class="user-menu" onclick="signOut()">
          <div class="user-avatar">A</div>
          <span id="adminName">Admin</span>
        </div>
      </div>
    </header>

    <div class="content">
      <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
      <div class="tab-panel active" id="dashboardPanel">
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-label">ç·çµ„ç¹”æ•°</div>
              <div class="kpi-icon blue">ğŸ¢</div>
            </div>
            <div class="kpi-value" id="totalOrgs">0</div>
            <span class="kpi-change positive">+12% å…ˆæœˆæ¯”</span>
          </div>

          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
              <div class="kpi-icon green">ğŸ‘¥</div>
            </div>
            <div class="kpi-value" id="totalUsers">0</div>
            <span class="kpi-change positive">+8% å…ˆæœˆæ¯”</span>
          </div>

          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-label">æœˆé–“å£²ä¸Š</div>
              <div class="kpi-icon yellow">ğŸ’°</div>
            </div>
            <div class="kpi-value" id="monthlyRevenue">Â¥0</div>
            <span class="kpi-change positive">+15% å…ˆæœˆæ¯”</span>
          </div>

          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-label">ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ä¸­</div>
              <div class="kpi-icon red">â±ï¸</div>
            </div>
            <div class="kpi-value" id="trialOrgs">0</div>
            <span class="kpi-change">14æ—¥ä»¥å†…ã«çµ‚äº†</span>
          </div>
        </div>

        <div class="chart-grid">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">æ–°è¦ç™»éŒ²æ¨ç§»</h3>
              <select class="form-select" style="width: auto;">
                <option>éå»30æ—¥</option>
                <option>éå»90æ—¥</option>
                <option>éå»1å¹´</option>
              </select>
            </div>
            <div class="chart-placeholder">ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ï¼ˆChart.jsé€£æºäºˆå®šï¼‰</div>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title">ãƒ—ãƒ©ãƒ³åˆ¥åˆ†å¸ƒ</h3>
            </div>
            <div class="chart-placeholder">ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ï¼ˆChart.jsé€£æºäºˆå®šï¼‰</div>
          </div>
        </div>

        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">æœ€è¿‘ã®ç™»éŒ²</h3>
            <a href="#organizations" class="btn btn-secondary btn-small" onclick="showTab('organizations')">ã™ã¹ã¦è¡¨ç¤º</a>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>çµ„ç¹”å</th>
                <th>ãƒ—ãƒ©ãƒ³</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>ç™»éŒ²æ—¥</th>
              </tr>
            </thead>
            <tbody id="recentOrgsTable">
              <tr>
                <td colspan="4" style="text-align: center; color: var(--text-light);">èª­ã¿è¾¼ã¿ä¸­...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- çµ„ç¹”ç®¡ç† -->
      <div class="tab-panel" id="organizationsPanel">
        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">çµ„ç¹”ä¸€è¦§</h3>
            <div class="table-actions">
              <div class="search-box">
                <span>ğŸ”</span>
                <input type="text" placeholder="çµ„ç¹”ã‚’æ¤œç´¢..." id="orgSearch" oninput="filterOrgs()">
              </div>
              <button class="btn btn-primary" onclick="openOrgModal()">+ çµ„ç¹”è¿½åŠ </button>
            </div>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>çµ„ç¹”å</th>
                <th>ã‚¹ãƒ©ãƒƒã‚°</th>
                <th>ãƒ¡ãƒ¼ãƒ«</th>
                <th>ãƒ—ãƒ©ãƒ³</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>ä½œæˆæ—¥</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="orgsTable">
              <tr>
                <td colspan="7" style="text-align: center; color: var(--text-light);">èª­ã¿è¾¼ã¿ä¸­...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ -->
      <div class="tab-panel" id="subscriptionsPanel">
        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§</h3>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>çµ„ç¹”</th>
                <th>ãƒ—ãƒ©ãƒ³</th>
                <th>æœˆé¡</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>æ¬¡å›è«‹æ±‚æ—¥</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="subsTable">
              <tr>
                <td colspan="6" style="text-align: center; color: var(--text-light);">èª­ã¿è¾¼ã¿ä¸­...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† -->
      <div class="tab-panel" id="usersPanel">
        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h3>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>åå‰</th>
                <th>ãƒ¡ãƒ¼ãƒ«</th>
                <th>çµ„ç¹”</th>
                <th>å½¹å‰²</th>
                <th>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</th>
              </tr>
            </thead>
            <tbody id="usersTable">
              <tr>
                <td colspan="5" style="text-align: center; color: var(--text-light);">èª­ã¿è¾¼ã¿ä¸­...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ãƒ—ãƒ©ãƒ³ç®¡ç† -->
      <div class="tab-panel" id="plansPanel">
        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">ãƒ—ãƒ©ãƒ³è¨­å®š</h3>
            <button class="btn btn-primary" onclick="openPlanModal()">+ ãƒ—ãƒ©ãƒ³è¿½åŠ </button>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>ãƒ—ãƒ©ãƒ³å</th>
                <th>æœˆé¡</th>
                <th>å¹´é¡</th>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸Šé™</th>
                <th>æ¡ˆä»¶ä¸Šé™</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="plansTable">
              <tr>
                <td colspan="6" style="text-align: center; color: var(--text-light);">èª­ã¿è¾¼ã¿ä¸­...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ã‚·ã‚¹ãƒ†ãƒ è¨­å®š -->
      <div class="tab-panel" id="settingsPanel">
        <div class="chart-card">
          <h3 class="chart-title" style="margin-bottom: 24px;">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3>
          <div class="form-group">
            <label class="form-label">ã‚µã‚¤ãƒˆå</label>
            <input type="text" class="form-input" value="ArchiDeck">
          </div>
          <div class="form-group">
            <label class="form-label">ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«</label>
            <input type="email" class="form-input" value="support@archideck.jp">
          </div>
          <div class="form-group">
            <label class="form-label">ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“ï¼ˆæ—¥ï¼‰</label>
            <input type="number" class="form-input" value="14">
          </div>
          <button class="btn btn-primary">ä¿å­˜</button>
        </div>
      </div>

      <!-- ç›£æŸ»ãƒ­ã‚° -->
      <div class="tab-panel" id="logsPanel">
        <div class="table-card">
          <div class="table-header">
            <h3 class="table-title">ç›£æŸ»ãƒ­ã‚°</h3>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>æ—¥æ™‚</th>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                <th>è©³ç´°</th>
              </tr>
            </thead>
            <tbody id="logsTable">
              <tr>
                <td colspan="4" style="text-align: center; color: var(--text-light);">ãƒ­ã‚°ãªã—</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- çµ„ç¹”è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="orgModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">çµ„ç¹”è¿½åŠ </h3>
      <button class="modal-close" onclick="closeOrgModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">çµ„ç¹”å *</label>
        <input type="text" class="form-input" id="newOrgName" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«ä½å®…">
      </div>
      <div class="form-group">
        <label class="form-label">ã‚¹ãƒ©ãƒƒã‚° *</label>
        <input type="text" class="form-input" id="newOrgSlug" placeholder="ä¾‹ï¼šsample-jutaku">
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
        <input type="email" class="form-input" id="newOrgEmail" placeholder="admin@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ—ãƒ©ãƒ³</label>
        <select class="form-select" id="newOrgPlan">
          <option value="starter">ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼</option>
          <option value="professional">ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«</option>
          <option value="enterprise">ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeOrgModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="createOrg()">ä½œæˆ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// Supabaseè¨­å®š
const SUPABASE_URL = 'https://twzsirpfudqwboeyakta.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3enNpcnBmdWRxd2JvZXlha3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MzM4NjgsImV4cCI6MjA3NzAwOTg2OH0.E_8GxfsO6Scjc0dDoEoyxq3i4lfvNxYZvnSL1OlSDSM';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser = null;
let organizations = [];
let subscriptions = [];
let plans = [];

// èªè¨¼
async function signIn() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value.trim();

  if (!email || !password) {
    showToast('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
    return;
  }

  try {
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) throw error;

    // ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ãƒã‚§ãƒƒã‚¯
    const { data: adminData } = await supabase
      .from('super_admins')
      .select('*')
      .eq('user_id', data.user.id)
      .single();

    if (!adminData) {
      showToast('ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
      await supabase.auth.signOut();
      return;
    }

    currentUser = data.user;
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('mainContainer').style.display = 'block';
    document.getElementById('adminName').textContent = email.split('@')[0];

    await loadData();
  } catch (error) {
    console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
    showToast(error.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
  }
}

async function signOut() {
  await supabase.auth.signOut();
  location.reload();
}

// ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
async function loadData() {
  try {
    // çµ„ç¹”ä¸€è¦§
    const { data: orgsData } = await supabase.from('organizations').select('*').order('created_at', { ascending: false });
    organizations = orgsData || [];

    // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§
    const { data: subsData } = await supabase.from('subscriptions').select('*, organizations(name)').order('created_at', { ascending: false });
    subscriptions = subsData || [];

    // ãƒ—ãƒ©ãƒ³ä¸€è¦§
    const { data: plansData } = await supabase.from('plans').select('*').order('display_order');
    plans = plansData || [];

    // ç”»é¢æ›´æ–°
    updateDashboard();
    renderOrgsTable();
    renderSubsTable();
    renderPlansTable();
  } catch (error) {
    console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    // ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„å ´åˆã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
    updateDashboardWithDemo();
  }
}

// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
function updateDashboard() {
  document.getElementById('totalOrgs').textContent = organizations.length;

  const activeOrgs = subscriptions.filter(s => s.status === 'active').length;
  const trialOrgs = subscriptions.filter(s => s.status === 'trial').length;

  document.getElementById('trialOrgs').textContent = trialOrgs;

  // æœˆé–“å£²ä¸Šè¨ˆç®—
  const monthlyRevenue = subscriptions
    .filter(s => s.status === 'active')
    .reduce((sum, s) => sum + (s.price_monthly || 0), 0);
  document.getElementById('monthlyRevenue').textContent = 'Â¥' + monthlyRevenue.toLocaleString();

  // æœ€è¿‘ã®ç™»éŒ²
  const recentOrgs = organizations.slice(0, 5);
  const tbody = document.getElementById('recentOrgsTable');
  tbody.innerHTML = recentOrgs.map(org => {
    const sub = subscriptions.find(s => s.organization_id === org.id);
    return `
      <tr>
        <td><strong>${org.name}</strong></td>
        <td>${sub?.plan_type || '-'}</td>
        <td><span class="badge badge-${org.status || 'active'}">${org.status || 'active'}</span></td>
        <td>${new Date(org.created_at).toLocaleDateString('ja-JP')}</td>
      </tr>
    `;
  }).join('') || '<tr><td colspan="4" style="text-align: center;">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>';
}

function updateDashboardWithDemo() {
  document.getElementById('totalOrgs').textContent = '12';
  document.getElementById('totalUsers').textContent = '87';
  document.getElementById('monthlyRevenue').textContent = 'Â¥198,000';
  document.getElementById('trialOrgs').textContent = '3';

  document.getElementById('recentOrgsTable').innerHTML = `
    <tr>
      <td><strong>æ ªå¼ä¼šç¤¾Gãƒã‚¦ã‚¹</strong></td>
      <td>ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«</td>
      <td><span class="badge badge-active">active</span></td>
      <td>2025/12/01</td>
    </tr>
    <tr>
      <td><strong>ã‚µãƒ³ãƒ—ãƒ«ä½å®…</strong></td>
      <td>ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼</td>
      <td><span class="badge badge-trial">trial</span></td>
      <td>2025/12/10</td>
    </tr>
  `;
}

// çµ„ç¹”ãƒ†ãƒ¼ãƒ–ãƒ«
function renderOrgsTable() {
  const tbody = document.getElementById('orgsTable');
  tbody.innerHTML = organizations.map(org => {
    const sub = subscriptions.find(s => s.organization_id === org.id);
    return `
      <tr>
        <td><strong>${org.name}</strong></td>
        <td>${org.slug}</td>
        <td>${org.email}</td>
        <td>${sub?.plan_type || '-'}</td>
        <td><span class="badge badge-${org.status || 'active'}">${org.status || 'active'}</span></td>
        <td>${new Date(org.created_at).toLocaleDateString('ja-JP')}</td>
        <td>
          <button class="btn btn-secondary btn-small" onclick="editOrg('${org.id}')">ç·¨é›†</button>
        </td>
      </tr>
    `;
  }).join('') || '<tr><td colspan="7" style="text-align: center;">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>';
}

// ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
function renderSubsTable() {
  const tbody = document.getElementById('subsTable');
  tbody.innerHTML = subscriptions.map(sub => `
    <tr>
      <td>${sub.organizations?.name || '-'}</td>
      <td>${sub.plan_type}</td>
      <td>Â¥${(sub.price_monthly || 0).toLocaleString()}</td>
      <td><span class="badge badge-${sub.status}">${sub.status}</span></td>
      <td>${sub.current_period_end ? new Date(sub.current_period_end).toLocaleDateString('ja-JP') : '-'}</td>
      <td>
        <button class="btn btn-secondary btn-small">è©³ç´°</button>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="6" style="text-align: center;">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>';
}

// ãƒ—ãƒ©ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
function renderPlansTable() {
  const tbody = document.getElementById('plansTable');
  tbody.innerHTML = plans.map(plan => `
    <tr>
      <td><strong>${plan.name}</strong></td>
      <td>Â¥${plan.price_monthly.toLocaleString()}</td>
      <td>Â¥${plan.price_yearly.toLocaleString()}</td>
      <td>${plan.max_users}</td>
      <td>${plan.max_projects === -1 ? 'ç„¡åˆ¶é™' : plan.max_projects}</td>
      <td>
        <button class="btn btn-secondary btn-small">ç·¨é›†</button>
      </td>
    </tr>
  `).join('') || '<tr><td colspan="6" style="text-align: center;">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>';
}

// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
function showTab(tabName) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));

  document.getElementById(tabName + 'Panel').classList.add('active');
  document.querySelector(`.sidebar-nav a[href="#${tabName}"]`).classList.add('active');

  const titles = {
    dashboard: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
    organizations: 'çµ„ç¹”ç®¡ç†',
    subscriptions: 'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³',
    users: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
    plans: 'ãƒ—ãƒ©ãƒ³ç®¡ç†',
    settings: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š',
    logs: 'ç›£æŸ»ãƒ­ã‚°'
  };
  document.getElementById('pageTitle').textContent = titles[tabName] || tabName;
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«
function openOrgModal() {
  document.getElementById('orgModal').classList.add('show');
}

function closeOrgModal() {
  document.getElementById('orgModal').classList.remove('show');
}

async function createOrg() {
  const name = document.getElementById('newOrgName').value.trim();
  const slug = document.getElementById('newOrgSlug').value.trim();
  const email = document.getElementById('newOrgEmail').value.trim();
  const plan = document.getElementById('newOrgPlan').value;

  if (!name || !slug || !email) {
    showToast('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
    return;
  }

  try {
    const { data, error } = await supabase.from('organizations').insert({
      name, slug, email
    }).select().single();

    if (error) throw error;

    // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆ
    await supabase.from('subscriptions').insert({
      organization_id: data.id,
      plan_type: plan,
      status: 'trial'
    });

    showToast('çµ„ç¹”ã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');
    closeOrgModal();
    await loadData();
  } catch (error) {
    console.error('çµ„ç¹”ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
    showToast(error.message || 'ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
  }
}

function filterOrgs() {
  const query = document.getElementById('orgSearch').value.toLowerCase();
  const filtered = organizations.filter(org =>
    org.name.toLowerCase().includes(query) ||
    org.slug.toLowerCase().includes(query) ||
    org.email.toLowerCase().includes(query)
  );
  // ãƒ•ã‚£ãƒ«ã‚¿çµæœã‚’è¡¨ç¤º
}

// ãƒˆãƒ¼ã‚¹ãƒˆ
function showToast(message, type = '') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = 'toast show ' + type;
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// åˆæœŸåŒ–
async function init() {
  const { data: { session } } = await supabase.auth.getSession();

  if (session) {
    // ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ãƒã‚§ãƒƒã‚¯
    const { data: adminData } = await supabase
      .from('super_admins')
      .select('*')
      .eq('user_id', session.user.id)
      .single();

    if (adminData) {
      currentUser = session.user;
      document.getElementById('loginContainer').style.display = 'none';
      document.getElementById('mainContainer').style.display = 'block';
      document.getElementById('adminName').textContent = session.user.email.split('@')[0];
      await loadData();
    }
  }
}

init();
</script>
</body>
</html>
