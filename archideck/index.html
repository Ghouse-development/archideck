<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2563EB">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ArchiDeck">
<meta name="description" content="住宅設計業務を革新的に効率化するタスク管理システム">
<link rel="manifest" href="/archideck/manifest.json">
<title>ArchiDeck | Gハウス 設計業務管理システム</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🏠</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%232563EB' width='100' height='100' rx='20'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>A</text></svg>">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.87.1/dist/umd/supabase.min.js" integrity="sha256-mgB0KFXEH7op01hbCXulq3TZjSqvaCMD35XeKkoTqL8=" crossorigin="anonymous"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/archideck/styles.css">
</head>
<body>

<!-- スキップリンク（アクセシビリティ） -->
<a href="#mainContent" class="skip-link">メインコンテンツへスキップ</a>

<!-- ライブリージョン（スクリーンリーダー用） -->
<div id="liveRegion" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- ログイン画面 -->
<div id="loginContainer" class="login-container">
  <div class="login-card">
    <h1>ArchiDeck</h1>
    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">Gハウス 設計業務管理システム</p>
    <p>メールアドレスとパスワードでログインしてください</p>
    <form onsubmit="signIn(); return false;" style="margin-bottom: 20px;">
      <input type="email" class="form-input" id="loginEmail" placeholder="メールアドレス" style="width: 100%; margin-bottom: 12px;" inputmode="email">
      <input type="password" class="form-input" id="loginPassword" placeholder="パスワード" style="width: 100%; margin-bottom: 12px;" autocomplete="current-password">
      <div style="text-align: right; margin-bottom: 16px;">
        <a href="#" onclick="showForgotPassword(); return false;" style="font-size: 13px; color: var(--primary-color);">パスワードを忘れた方</a>
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%;">ログイン</button>
    </form>
    <div id="forgotPasswordSection" style="display: none; margin-bottom: 20px; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md);">
      <p style="font-size: 13px; margin-bottom: 12px;">登録済みのメールアドレスを入力してください。パスワード再設定用のリンクを送信します。</p>
      <input type="email" class="form-input" id="forgotEmail" placeholder="メールアドレス" style="width: 100%; margin-bottom: 12px;">
      <button class="btn btn-primary" style="width: 100%; margin-bottom: 8px;" onclick="sendPasswordReset()">再設定メールを送信</button>
      <button class="btn btn-ghost" style="width: 100%;" onclick="hideForgotPassword()">キャンセル</button>
    </div>
  </div>
</div>

<!-- パスワード設定画面（初回ログイン用） -->
<div id="setPasswordContainer" class="login-container" style="display: none;">
  <div class="login-card">
    <h1>パスワード設定</h1>
    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">ArchiDeck</p>
    <p>新しいパスワードを設定してください</p>
    <form onsubmit="saveNewPassword(); return false;" style="margin-bottom: 20px;">
      <div class="form-group" style="margin-bottom: 16px;">
        <label class="form-label">新しいパスワード</label>
        <input type="password" class="form-input" id="setNewPassword" placeholder="英数字混合8文字以上" style="width: 100%;" autocomplete="new-password">
      </div>
      <div class="form-group" style="margin-bottom: 16px;">
        <label class="form-label">新しいパスワード（確認）</label>
        <input type="password" class="form-input" id="setConfirmPassword" placeholder="もう一度入力" style="width: 100%;" autocomplete="new-password">
      </div>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">
        ※ パスワードは英字と数字を含む8文字以上で設定してください
      </p>
      <button type="submit" class="btn btn-primary" style="width: 100%;">パスワードを設定</button>
    </form>
  </div>
</div>

<!-- メインアプリケーション -->
<div id="mainContainer" class="main-container">
  <!-- ヘッダー -->
  <header class="header" role="banner" aria-label="サイトヘッダー">
    <div class="header-left">
      <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
      <div class="logo">ArchiDeck</div>
      <!-- ヘッダー内ナビゲーション -->
      <nav class="header-nav">
        <button class="header-nav-btn active" onclick="switchMainTab('projects', this)">📋 案件管理</button>
        <button class="header-nav-btn" onclick="switchMainTab('calendar', this)">📅 カレンダー</button>
        <button class="header-nav-btn" onclick="switchMainTab('analytics', this)">📊 分析</button>
        <button class="header-nav-btn" onclick="switchMainTab('settings', this)">⚙️ 設定</button>
      </nav>
    </div>
    <div class="header-right">
      <div class="status-indicator status-saved" id="statusIndicator">
        <span class="status-dot"></span>
        <span id="statusText">保存済み</span>
      </div>
      <div class="user-info">
        <img id="userAvatar" class="user-avatar" src="" alt="">
        <span id="userName" class="user-name"></span>
      </div>
      <div style="position: relative;">
        <button class="btn btn-ghost btn-small" onclick="toggleCategorySwitcher()" id="categorySwitchBtn" style="display: none;">
          <span id="currentCategoryLabel">📐 設計</span> ▼
        </button>
        <div id="categorySwitchMenu" class="category-switch-menu" style="display: none;">
          <button onclick="switchCategory('設計')">📐 設計担当</button>
          <button onclick="switchCategory('IC')">🎨 IC担当</button>
          <button onclick="switchCategory('外構')">🌳 外構担当</button>
          <button onclick="switchCategory('不動産')">🏠 不動産担当</button>
          <button onclick="switchCategory('admin')">👑 管理者</button>
        </div>
      </div>
      <button class="btn btn-ghost btn-small" onclick="UndoManager.undo()" title="元に戻す (Ctrl+Z)" id="undoBtn" disabled>↩️</button>
      <button class="btn btn-ghost btn-small" onclick="UndoManager.redo()" title="やり直す (Ctrl+Y)" id="redoBtn" disabled>↪️</button>
      <button class="btn btn-ghost btn-small" onclick="forceReloadData()" title="データを再読み込み">🔄</button>
      <button class="btn btn-ghost btn-small" onclick="showDebugInfo()" title="デバッグ情報">🔍</button>
      <button class="btn btn-ghost btn-small" onclick="signOut()">ログアウト</button>
    </div>
  </header>

  <!-- アプリレイアウト -->
  <div class="app-layout">
    <!-- サイドバーオーバーレイ（モバイル用） -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <!-- サイドバー -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="サイドバーナビゲーション">
      <div id="sidebarContent"></div>
    </aside>

    <!-- メインコンテンツ -->
    <main class="main-content" id="mainContent" role="main" aria-label="メインコンテンツ">
      <!-- 案件管理タブ -->
      <div id="projectsTab" class="tab-panel active">
        <div class="toolbar compact-toolbar">
          <div class="toolbar-main">
            <input type="text" class="input" id="searchQuery" placeholder="検索... (Ctrl+K)" oninput="debouncedRenderProjects()" onfocus="updateSearchSuggestions()" list="searchSuggestions" aria-label="案件を検索" autocomplete="off" style="flex:1;max-width:280px;">
            <datalist id="searchSuggestions"></datalist>
            <select class="select select-compact" id="archiveFilter" onchange="renderProjects()">
              <option value="active">アクティブ</option>
              <option value="all">すべて</option>
              <option value="archived">完了済</option>
            </select>
            <button class="btn btn-ghost btn-small" onclick="toggleFilterPanel()" id="filterToggleBtn" title="フィルター展開">🔽 絞込</button>
            <button class="btn btn-ghost btn-small" onclick="resetAllFilters()" title="リセット">🔄</button>
            <div class="toolbar-spacer"></div>
            <button class="btn btn-ghost btn-small" onclick="manualKintoneSync()" title="kintone同期" id="kintoneRefreshBtn">🔄 kintone</button>
            <button class="btn btn-ghost btn-small" onclick="DataImporter.showModal()" title="取込">📥</button>
            <button class="btn btn-ghost btn-small" onclick="exportCSV()" title="出力">📤</button>
            <button class="btn btn-primary btn-small" onclick="openProjectModal()">+ 追加</button>
          </div>
          <div class="filter-panel" id="filterPanel" style="display:none;">
            <div class="filter-row">
              <select class="select select-compact" id="specFilter" onchange="renderProjects()">
                <option value="">商品: すべて</option>
                <option>LIFE</option>
                <option>LIFE+</option>
                <option>HOURS</option>
                <option>LACIE</option>
                <option>LIFE Limited</option>
                <option>LIFE+ Limited</option>
              </select>
              <select class="select select-compact" id="icProgressFilter" onchange="renderProjects()">
                <option value="">IC進捗: すべて</option>
                <option value="not_started">IC未着手</option>
                <option value="in_progress">IC進行中</option>
                <option value="completed">IC完了</option>
                <option value="no_ic">IC担当なし</option>
              </select>
              <select class="select select-compact" id="sourceFilter" onchange="renderProjects()">
                <option value="">ソース: すべて</option>
                <option value="kintone">kintone連携</option>
                <option value="demo">手動追加/デモ</option>
              </select>
              <select class="select select-compact" id="icAssigneeFilter" onchange="renderProjects()">
                <option value="">IC担当: すべて</option>
              </select>
              <select class="select select-compact" id="exteriorAssigneeFilter" onchange="renderProjects()">
                <option value="">外構: すべて</option>
              </select>
              <select class="select select-compact" id="realestateAssigneeFilter" onchange="renderProjects()">
                <option value="">不動産: すべて</option>
              </select>
              <select class="select select-compact" id="sortOrder" onchange="renderProjects()">
                <option value="custom">カスタム順</option>
                <option value="updated_desc">更新日↓</option>
                <option value="updated_asc">更新日↑</option>
                <option value="progress_desc">進捗↓</option>
                <option value="progress_asc">進捗↑</option>
                <option value="customer_asc">顧客名A-Z</option>
                <option value="created_desc">作成日↓</option>
              </select>
              <div style="position: relative;">
                <button class="btn btn-ghost btn-small" onclick="FilterPresets.toggleMenu()" title="プリセット">📋</button>
                <div id="presetMenu" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 4px; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 280px; z-index: 100;">
                  <div style="padding: 12px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 600; font-size: 14px;">フィルタープリセット</span>
                    <button class="btn btn-primary btn-small" onclick="FilterPresets.showSaveModal(); document.getElementById('presetMenu').style.display='none';">+ 保存</button>
                  </div>
                  <div id="presetDropdown" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
              </div>
              <button class="btn btn-ghost btn-small" onclick="BatchOperations.selectAll()" title="全選択">☑</button>
            </div>
          </div>
        </div>
    <div class="cards-container">
      <div class="cards-grid" id="projectsGrid"></div>
      <div class="empty-state" id="emptyProjects" style="display: none;">
        <div class="empty-icon">📋</div>
        <div class="empty-title">案件がありません</div>
        <div class="empty-description">「案件追加」ボタンから新しい案件を登録してください</div>
        <button class="btn btn-primary" onclick="openProjectModal()">+ 案件追加</button>
      </div>
    </div>
  </div>

      <!-- カレンダータブ -->
      <div id="calendarTab" class="tab-panel">
        <div class="calendar-container">
          <div class="calendar-header">
            <button class="btn btn-ghost" onclick="navigateCalendar(-1)">◀ 前月</button>
            <h2 id="calendarTitle" class="calendar-title"></h2>
            <button class="btn btn-ghost" onclick="navigateCalendar(1)">次月 ▶</button>
          </div>
          <div class="calendar-legend">
            <span class="legend-item"><span class="legend-dot legend-design"></span>設計</span>
            <span class="legend-item"><span class="legend-dot legend-ic"></span>IC</span>
            <span class="legend-item"><span class="legend-dot legend-exterior"></span>外構</span>
            <span class="legend-item"><span class="legend-dot legend-construction"></span>工事</span>
            <span class="legend-item"><span class="legend-dot legend-task"></span>タスク</span>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>

      <!-- 分析タブ -->
      <div id="analyticsTab" class="tab-panel">
        <div class="analytics-container">
          <!-- 自動レポート生成 -->
          <div class="analytics-section">
            <h3 class="section-title">📝 自動レポート生成</h3>
            <div class="report-buttons">
              <button class="btn btn-primary" onclick="generateWeeklyReport()">📊 週報を生成</button>
              <button class="btn btn-ghost" onclick="generateMonthlyReport()">📈 月報を生成</button>
              <button class="btn btn-ghost" onclick="exportAnalyticsCSV()">📁 CSV出力</button>
            </div>
            <div id="reportPreview" class="report-preview" style="display: none;"></div>
          </div>
        </div>
      </div>

      <!-- 設定タブ -->
      <div id="settingsTab" class="tab-panel">
        <!-- 設定カードグリッド（メイン画面） -->
        <div id="settingsCardsView" class="settings-cards-grid">
          <div class="settings-card" onclick="openSettingsPanel('staff')">
            <div class="settings-card-icon">👥</div>
            <div class="settings-card-title">担当管理</div>
            <div class="settings-card-description">設計・IC・外構・不動産・工事の担当者を管理</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('taskManagement')">
            <div class="settings-card-icon">📋</div>
            <div class="settings-card-title">業務管理</div>
            <div class="settings-card-description">各部署のタスクを管理</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('products')">
            <div class="settings-card-icon">📦</div>
            <div class="settings-card-title">商品管理</div>
            <div class="settings-card-description">案件で選択できる商品を管理</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('customize')">
            <div class="settings-card-icon">🎨</div>
            <div class="settings-card-title">カスタマイズ</div>
            <div class="settings-card-description">システムの外観をカスタマイズ</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('kintone')">
            <div class="settings-card-icon">🔗</div>
            <div class="settings-card-title">kintone連携</div>
            <div class="settings-card-description">kintoneとのデータ連携を設定</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('backup')">
            <div class="settings-card-icon">💾</div>
            <div class="settings-card-title">バックアップ</div>
            <div class="settings-card-description">データのバックアップと復元</div>
          </div>
          <div class="settings-card" onclick="openSettingsPanel('fcManagement')">
            <div class="settings-card-icon">🏪</div>
            <div class="settings-card-title">FC管理</div>
            <div class="settings-card-description">フランチャイズ組織を管理</div>
          </div>
        </div>

        <!-- 担当管理 -->
        <div id="staffPanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 1000px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">👥 担当管理</h2>
            <div class="form-group">
              <label class="form-label">新しい担当を追加</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr 150px 150px; gap: 12px; align-items: center;">
                <input type="text" class="form-input" id="newDesignerNameInline" placeholder="担当名 *">
                <input type="email" class="form-input" id="newDesignerEmailInline" placeholder="メールアドレス *">
                <input type="tel" class="form-input" id="newDesignerPhoneInline" placeholder="携帯番号(11桁)" maxlength="11" pattern="[0-9]{11}" style="width: 150px;">
                <select class="form-select" id="newDesignerDepartmentInline" style="width: 150px;">
                  <option value="">部署を選択</option>
                </select>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: center; margin-top: 12px;">
                <select class="form-select" id="newDesignerCategoryInline" style="width: 150px;">
                  <option value="設計">設計担当</option>
                  <option value="IC">IC担当</option>
                  <option value="外構">外構担当</option>
                  <option value="不動産">不動産担当</option>
                  <option value="工事">工事担当</option>
                  <option value="営業">営業担当</option>
                  <option value="管理者">管理者</option>
                </select>
                <div></div>
                <button class="btn btn-primary" onclick="addDesignerInline()">追加</button>
              </div>
              <p style="color: var(--text-secondary); font-size: 12px; margin-top: 8px;">※ 追加後、担当者のメールアドレス宛にパスワード設定メールが自動送信されます</p>
            </div>

            <!-- 部署マスタ管理 -->
            <div style="margin-top: 24px; padding: 16px; background: var(--bg-secondary); border-radius: 8px;">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">部署マスタ</h3>
              <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px;" id="departmentChips"></div>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" class="form-input" id="newDepartmentName" placeholder="新しい部署名" style="width: 200px;">
                <button class="btn btn-ghost" onclick="addDepartment()">+ 追加</button>
              </div>
            </div>
            <div id="designerListInline" style="margin-top: 24px;"></div>
          </div>
        </div>

        <!-- 統合業務管理 -->
        <div id="taskManagementPanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 1400px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">📋 業務管理</h2>
            <p style="margin-bottom: 24px; color: var(--text-secondary);">各部署のタスクと業者・メール設定を管理します。</p>

            <!-- 部署タブ -->
            <div class="department-tabs" style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">
              <button class="dept-tab active" onclick="switchDeptTab('設計')" data-dept="設計">📐 設計</button>
              <button class="dept-tab" onclick="switchDeptTab('IC')" data-dept="IC">🎨 IC</button>
              <button class="dept-tab" onclick="switchDeptTab('外構')" data-dept="外構">🌳 外構</button>
              <button class="dept-tab" onclick="switchDeptTab('不動産')" data-dept="不動産">🏢 不動産</button>
              <button class="dept-tab" onclick="switchDeptTab('工事')" data-dept="工事">🔨 工事</button>
            </div>

            <!-- 設計タブ内容 -->
            <div id="deptContent_設計" class="dept-content active">
              <div class="toolbar" style="padding-bottom: 16px; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">📝 タスク一覧</h3>
                <div class="toolbar-right">
                  <button class="btn btn-primary btn-small" onclick="openTaskModal('設計')">+ タスク追加</button>
                </div>
              </div>
              <div id="tasksGrid"></div>
            </div>

            <!-- ICタブ内容 -->
            <div id="deptContent_IC" class="dept-content" style="display: none;">
              <div class="toolbar" style="padding-bottom: 16px; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">📝 タスク一覧</h3>
                <div class="toolbar-right">
                  <button class="btn btn-warning btn-small" onclick="runICTasksMigration()" title="26項目のICタスクに更新（メールボタン設定含む）">🔄 ICタスク更新</button>
                  <button class="btn btn-primary btn-small" onclick="openTaskModal('IC')">+ タスク追加</button>
                </div>
              </div>
              <div id="icMigrationNotice" style="display: none; margin-bottom: 16px; padding: 12px; background: var(--warning-light); border-radius: var(--radius-md); border-left: 4px solid var(--warning-color);">
                <p style="margin: 0; font-size: 13px; color: var(--warning-color);">
                  ⚠️ <strong>ICタスクが古い形式です</strong>: 「ICタスク更新」ボタンで更新してください。
                </p>
              </div>
              <div id="icTasksGrid"></div>
            </div>

            <!-- 外構タブ内容 -->
            <div id="deptContent_外構" class="dept-content" style="display: none;">
              <div class="toolbar" style="padding-bottom: 16px; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">📝 タスク一覧</h3>
                <div class="toolbar-right">
                  <button class="btn btn-primary btn-small" onclick="openExteriorTaskModal()">+ タスク追加</button>
                </div>
              </div>
              <div id="exteriorTasksGrid"></div>
            </div>

            <!-- 不動産タブ内容 -->
            <div id="deptContent_不動産" class="dept-content" style="display: none;">
              <div class="toolbar" style="padding-bottom: 16px; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">📝 タスク一覧</h3>
                <div class="toolbar-right">
                  <button class="btn btn-primary btn-small" onclick="openRealestateTaskModal()">+ タスク追加</button>
                </div>
              </div>
              <div id="realestateTasksGrid"></div>
            </div>

            <!-- 工事タブ内容 -->
            <div id="deptContent_工事" class="dept-content" style="display: none;">
              <div class="toolbar" style="padding-bottom: 16px; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600;">📝 タスク一覧</h3>
                <div class="toolbar-right">
                  <button class="btn btn-primary btn-small" onclick="openConstructionTaskModal()">+ タスク追加</button>
                </div>
              </div>
              <div id="constructionTasksGrid"></div>
            </div>
          </div>
        </div>

        <!-- 商品管理 -->
        <div id="productsPanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 800px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">📦 商品マスタ管理</h2>
            <p style="margin-bottom: 32px; color: var(--text-secondary);">案件で選択できる商品を管理します。</p>
            <div class="form-group">
              <label class="form-label">新しい商品を追加</label>
              <div style="display: flex; gap: 12px;">
                <input type="text" class="form-input" id="newProductNameInline" placeholder="商品名（例：LIFE、LIFE+、HOURS）" style="flex: 1;">
                <button class="btn btn-primary" onclick="addProductInline()">追加</button>
              </div>
            </div>
            <div id="productsGrid" style="margin-top: 32px;"></div>
          </div>
        </div>

        <!-- カスタマイズ -->
        <div id="customizePanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 800px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">🎨 外観カスタマイズ</h2>
            <p style="margin-bottom: 32px; color: var(--text-secondary);">会社のブランドに合わせてシステムの外観をカスタマイズできます。コーディング不要で簡単に変更できます。</p>

            <div style="display: grid; grid-template-columns: 1fr 300px; gap: 32px;">
              <div>
                <div class="form-group">
                  <label class="form-label">会社名</label>
                  <input type="text" class="form-input" id="customOrgName" placeholder="例：株式会社サンプル工務店" style="width: 100%;">
                  <div class="form-hint">ヘッダーのタイトルに表示されます</div>
                </div>

                <div class="form-group">
                  <label class="form-label">ロゴURL</label>
                  <input type="text" class="form-input" id="customLogoUrl" placeholder="https://example.com/logo.png" style="width: 100%;">
                  <div class="form-hint">推奨サイズ: 150x40px（PNG/SVG形式）</div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <div class="form-group">
                    <label class="form-label">メインカラー</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                      <input type="color" id="customPrimaryColor" value="#2563EB" style="width: 50px; height: 40px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); cursor: pointer;">
                      <input type="text" class="form-input" id="customPrimaryColorText" value="#2563EB" style="flex: 1;" oninput="document.getElementById('customPrimaryColor').value = this.value">
                    </div>
                    <div class="form-hint">ボタンやリンクの色</div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">アクセントカラー</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                      <input type="color" id="customSecondaryColor" value="#059669" style="width: 50px; height: 40px; border: 1px solid var(--border-color); border-radius: var(--radius-sm); cursor: pointer;">
                      <input type="text" class="form-input" id="customSecondaryColorText" value="#059669" style="flex: 1;" oninput="document.getElementById('customSecondaryColor').value = this.value">
                    </div>
                    <div class="form-hint">成功状態やサブボタンの色</div>
                  </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                  <button class="btn btn-primary" onclick="saveCustomization()">カスタマイズを保存</button>
                  <button class="btn btn-ghost" onclick="previewCustomization()">プレビュー</button>
                  <button class="btn btn-ghost" onclick="resetCustomization()">リセット</button>
                </div>

                <div id="customizeStatus" style="margin-top: 16px;"></div>
              </div>

              <div style="padding: 20px; background: var(--bg-secondary); border-radius: var(--radius-lg); height: fit-content;">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">プレビュー</h3>
                <div id="customizePreview" style="padding: 16px; background: var(--bg-primary); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                  <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                    <div id="previewLogo" style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">🏠</div>
                    <span id="previewTitle" style="font-weight: 600; font-size: 14px;">ArchiDeck</span>
                  </div>
                  <button class="btn btn-primary btn-small" style="margin-right: 8px;">メインボタン</button>
                  <button class="btn btn-secondary btn-small">サブボタン</button>
                </div>
              </div>
            </div>

            <div style="margin-top: 32px; padding: 16px; background: var(--primary-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
              <h4 style="font-size: 14px; font-weight: 600; color: var(--primary-color); margin-bottom: 8px;">ヒント</h4>
              <ul style="font-size: 13px; color: var(--text-secondary); margin: 0; padding-left: 20px;">
                <li>ロゴはURLを入力するか、画像をホスティングサービスにアップロードしてください</li>
                <li>カラーは会社のブランドカラーに合わせることをお勧めします</li>
                <li>変更は「プレビュー」で確認してから保存してください</li>
              </ul>
            </div>

          </div>
        </div>

        <!-- kintone連携 -->
        <div id="kintonePanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 800px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">🔗 kintone連携設定</h2>
            <p style="margin-bottom: 32px; color: var(--text-secondary);">kintoneと連携して、邸名・間取確定日・着工許可・変更契約前会議の情報を同期します。</p>

            <div class="form-group">
              <label class="form-label">kintone ドメイン</label>
              <input type="text" class="form-input" id="kintoneDomain" placeholder="例：your-company.cybozu.com" style="width: 100%;">
            </div>

            <div class="form-group">
              <label class="form-label">APIトークン</label>
              <input type="password" class="form-input" id="kintoneApiToken" placeholder="APIトークンを入力" style="width: 100%;" autocomplete="off">
              <div class="form-hint" style="font-size: 11px; margin-top: 4px;">kintoneアプリの設定からAPIトークンを発行してください（複数アプリで共通のトークンを使用）</div>
            </div>

            <div style="margin-top: 24px; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md);">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">年度別アプリ設定</h3>
              <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">年度ごとに異なるアプリIDを設定できます。複数年度をまたいでデータ管理が可能です。</p>
              <div id="kintoneAppsList" style="display: flex; flex-direction: column; gap: 8px;"></div>
              <button class="btn btn-ghost" onclick="addKintoneAppRow()" style="margin-top: 12px;">+ 年度を追加</button>
            </div>

            <!-- 後方互換性のための非表示フィールド -->
            <input type="hidden" id="kintoneAppId" value="">

            <div style="margin-top: 24px; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md);">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">フィールドマッピング（基本情報）</h3>
              <div class="form-hint" style="font-size: 11px; margin-bottom: 12px;">kintoneのフィールドコードを入力してください</div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">①邸名（お客様名）</label>
                  <input type="text" class="form-input" id="kintoneFieldCustomer" placeholder="文字_基本情報_お客様名_メイン" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑥プラン確定日</label>
                  <input type="text" class="form-input" id="kintoneFieldLayout" placeholder="日付_設計_プラン確定_予定手入力" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑧着工許可日</label>
                  <input type="text" class="form-input" id="kintoneFieldPermit" placeholder="日付_設計_着工許可_予定手入力" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑦変更契約前会議日</label>
                  <input type="text" class="form-input" id="kintoneFieldMeeting" placeholder="日付_IC_変更契約前会議_予定手入力" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑩会議図面渡し日</label>
                  <input type="text" class="form-input" id="kintoneFieldMeetingDrawing" placeholder="日付_IC_会議_図面_渡し日_予定手入力" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑨商品</label>
                  <input type="text" class="form-input" id="kintoneFieldProduct" placeholder="ドロップダウン_営業_契約後_商品" style="width: 100%;">
                </div>
              </div>
            </div>

            <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md);">
              <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">フィールドマッピング（担当者）</h3>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">②営業担当</label>
                  <input type="text" class="form-input" id="kintoneFieldSales" placeholder="ユーザー選択_基本情報_営業" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">③設計担当</label>
                  <input type="text" class="form-input" id="kintoneFieldDesign" placeholder="ユーザー選択_基本情報_設計" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">④IC担当</label>
                  <input type="text" class="form-input" id="kintoneFieldIC" placeholder="ユーザー選択_基本情報_IC" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑤工事担当</label>
                  <input type="text" class="form-input" id="kintoneFieldConstruction" placeholder="ユーザー選択_基本情報_工事" style="width: 100%;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                  <label class="form-label" style="font-size: 12px;">⑩外構担当</label>
                  <input type="text" class="form-input" id="kintoneFieldExterior" placeholder="文字列_基本情報_外構施工担当" style="width: 100%;">
                </div>
              </div>
            </div>

            <div style="display: flex; gap: 12px; margin-top: 24px;">
              <button class="btn btn-primary" onclick="saveKintoneSettings()">設定を保存</button>
              <button class="btn btn-ghost" onclick="testKintoneConnection()">接続テスト</button>
            </div>

            <div id="kintoneStatus" style="margin-top: 16px;"></div>

            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-color);">
              <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">データ連携</h3>
              <div style="margin-bottom: 16px;">
                <label class="form-label" style="font-size: 13px;">インポート対象年度</label>
                <div id="kintoneImportYearSelect" style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                  <!-- 動的に年度チェックボックスが追加される -->
                </div>
              </div>
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="importFromKintoneDirect()">📥 kintoneから直接インポート</button>
                <button class="btn btn-ghost" onclick="importFromKintone()">📥 CSVインポート</button>
                <button class="btn btn-ghost" onclick="exportToKintone()">📤 CSVエクスポート</button>
              </div>
              <p style="font-size: 12px; color: var(--text-muted); margin-top: 12px;">
                選択した年度のkintoneアプリからデータを取得してインポートします。
              </p>
              <div id="kintoneImportStatus" style="margin-top: 12px;"></div>

              <!-- データ整理 -->
              <div style="margin-top: 24px; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">データ整理</h4>
                <div id="dataStatsInfo" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;"></div>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                  <button class="btn btn-ghost btn-small" onclick="showDataStats()">📊 データ状況を確認</button>
                  <button class="btn btn-ghost btn-small" onclick="clearDemoDataConfirm()" style="color: var(--warning-color);">🗑️ デモデータを削除</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- バックアップ -->
        <div id="backupPanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">← 設定に戻る</button>
          <div style="max-width: 800px; margin: 0 auto;">
            <h2 style="margin-bottom: 20px; font-size: 24px; font-weight: 700;">💾 データバックアップ</h2>
            <p style="margin-bottom: 32px; color: var(--text-secondary);">システム全体のデータをバックアップ・復元できます。自動バックアップも利用可能です。</p>

            <!-- 自動バックアップ設定 -->
            <div style="margin-bottom: 24px; padding: 20px; background: linear-gradient(135deg, #e0f2fe, #dbeafe); border-radius: var(--radius-md);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                <div>
                  <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px;">🔄 自動バックアップ</h3>
                  <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">データ変更時に自動でローカルにバックアップを保存します</p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="autoBackupToggle" onchange="toggleAutoBackup()" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div style="display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px;">
                <div>最終バックアップ: <strong id="lastBackupTime">-</strong></div>
                <div>バックアップ件数: <strong id="localBackupCount">0</strong>件</div>
                <button class="btn btn-secondary btn-small" onclick="downloadLocalBackup()">ローカルバックアップをダウンロード</button>
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
              <div style="padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">📤</div>
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">バックアップ作成</h3>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">全データをJSONファイルとしてダウンロードします</p>
                <button class="btn btn-primary" onclick="createBackup()">バックアップを作成</button>
              </div>

              <div style="padding: 24px; background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">📥</div>
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">バックアップ復元</h3>
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">JSONファイルからデータを復元します</p>
                <button class="btn btn-ghost" onclick="restoreBackup()">復元ファイルを選択</button>
              </div>
            </div>

            <div style="margin-top: 32px; padding: 16px; background: rgba(245, 166, 35, 0.1); border-radius: var(--radius-md); border-left: 4px solid var(--warning-color);">
              <h4 style="font-size: 14px; font-weight: 600; color: var(--warning-color); margin-bottom: 8px;">⚠️ 注意事項</h4>
              <ul style="font-size: 13px; color: var(--text-secondary); margin: 0; padding-left: 20px;">
                <li>復元を行うと既存データが上書きされます</li>
                <li>復元前に必ず現在のバックアップを作成してください</li>
                <li>バックアップファイルは安全な場所に保管してください</li>
                <li>自動バックアップはブラウザのローカルストレージに保存されます（最大5MB）</li>
              </ul>
            </div>

            <div id="backupStatus" style="margin-top: 24px;"></div>
          </div>
        </div>

        <!-- FC管理 -->
        <div id="fcManagementPanel" class="sub-tab-panel">
          <button class="settings-back-btn" onclick="closeSettingsPanel()">
            ← 設定に戻る
          </button>
          <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <div>
                <h2 style="margin: 0; font-size: 24px; font-weight: 700;">🏪 FC（フランチャイズ）管理</h2>
                <p style="margin: 8px 0 0; color: var(--text-secondary);">FC先にホワイトラベル版を発行・管理できます。</p>
              </div>
              <button class="btn btn-primary" onclick="openFcModal()">+ FC追加</button>
            </div>

            <div class="card" style="margin-bottom: 24px; padding: 20px;">
              <h3 style="margin: 0 0 12px; font-size: 16px;">FC専用URLについて</h3>
              <p style="margin: 0; color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
                FC先には専用のURLが発行されます。<br>
                例: <code style="background: var(--bg-tertiary); padding: 2px 8px; border-radius: 4px;">https://nandemo-nu.vercel.app/fc/tokyo-fc/</code><br>
                FC専用URLでアクセスすると、Gハウスのブランディングが非表示になり、設定したカスタムロゴ・カラーが表示されます。
              </p>
            </div>

            <div id="fcListContainer">
              <div class="empty-state">
                <div class="empty-icon">🏪</div>
                <p>FCが登録されていません<br><small>「+ FC追加」ボタンから登録してください</small></p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
</div>

<!-- モーダル：業者追加・編集 -->
<div id="vendorFormModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2 class="modal-title" id="vendorFormModalTitle">業者追加</h2>
      <button class="close" onclick="closeVendorFormModal()">&times;</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="vendorFormTaskKey">
      <input type="hidden" id="vendorFormVendorId">

      <div class="form-group">
        <label class="form-label">会社名 *</label>
        <input type="text" class="form-input" id="vendorFormCompany" placeholder="例：株式会社〇〇">
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <div class="form-group">
          <label class="form-label">担当者名</label>
          <input type="text" class="form-input" id="vendorFormContact" placeholder="例：山田様">
        </div>
        <div class="form-group">
          <label class="form-label">電話番号</label>
          <input type="text" class="form-input" id="vendorFormTel" placeholder="例：090-1234-5678">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">メールアドレス（To）</label>
        <input type="email" class="form-input" id="vendorFormEmail" placeholder="例：sample@example.com">
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          メール送信が必要な場合に入力してください
        </p>
      </div>

      <div class="form-group">
        <label class="form-label">CC</label>
        <input type="text" class="form-input" id="vendorFormCcEmail" placeholder="例：cc1@example.com; cc2@example.com">
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          複数ある場合はセミコロン(;)で区切ってください
        </p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeVendorFormModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveVendorForm()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：業者メール設定 -->
<div id="vendorEmailSettingsModal" class="modal">
  <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
      <h2 class="modal-title" id="emailSettingsModalTitle">メール設定</h2>
      <button class="close" onclick="closeVendorEmailSettingsModal()">&times;</button>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
      <input type="hidden" id="emailSettingsTaskKey">
      <input type="hidden" id="emailSettingsVendorId">

      <!-- 宛先設定 -->
      <div class="card" style="padding: 16px; margin-bottom: 24px; background: var(--bg-secondary);">
        <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">📬 宛先設定</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <input type="email" class="form-input" id="emailSettingsTo" placeholder="例：sample@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">CC</label>
            <input type="text" class="form-input" id="emailSettingsCc" placeholder="例：cc1@example.com; cc2@example.com">
          </div>
        </div>
      </div>

      <!-- 件名 -->
      <div class="form-group" style="margin-bottom: 16px;">
        <label class="form-label">件名テンプレート</label>
        <input type="text" class="form-input" id="emailSettingsSubject" placeholder="例：【〇〇依頼】{customerName}様邸">
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          使用可能な変数: {customerName}=お客様名, {staffName}=担当者名, {dueDate}=期日
        </p>
      </div>

      <!-- 本文 -->
      <div class="form-group" style="margin-bottom: 16px;">
        <label class="form-label">本文テンプレート</label>
        <textarea class="form-input" id="emailSettingsBody" rows="12" style="font-family: monospace; font-size: 13px;" placeholder="メール本文を入力..."></textarea>
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          使用可能な変数: {company}=会社名, {contact}=担当者名, {customerName}=お客様名, {staffName}=スタッフ名, {dueDate}=期日
        </p>
      </div>

      <!-- 署名 -->
      <div class="form-group">
        <label class="form-label">署名</label>
        <textarea class="form-input" id="emailSettingsSignature" rows="6" style="font-family: monospace; font-size: 13px;" placeholder="──────────────────────────&#10;株式会社〇〇&#10;設計部　{staffName}&#10;TEL: {staffPhone}&#10;Email: {staffEmail}&#10;──────────────────────────"></textarea>
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          使用可能な変数: {staffName}=スタッフ名, {staffPhone}=電話番号, {staffEmail}=メールアドレス
        </p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeVendorEmailSettingsModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveVendorEmailSettings()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：依頼テンプレート編集（旧） -->
<div id="editRequestTemplateModal" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2 class="modal-title" id="editTemplateModalTitle">テンプレート編集</h2>
      <button class="close" onclick="closeEditTemplateModal()">&times;</button>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
      <input type="hidden" id="editTemplateId">

      <!-- 基本情報 -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
        <div class="form-group">
          <label class="form-label">テンプレート名 *</label>
          <input type="text" class="form-input" id="editTemplateDisplayName" placeholder="例：サッシプレゼン依頼">
        </div>
        <div class="form-group">
          <label class="form-label">カテゴリ</label>
          <select class="form-select" id="editTemplateCategory">
            <option value="設計">設計</option>
            <option value="IC">IC</option>
            <option value="外構">外構</option>
            <option value="工事">工事</option>
          </select>
        </div>
      </div>

      <!-- 宛先情報 -->
      <div class="card" style="padding: 16px; margin-bottom: 24px; background: var(--bg-secondary);">
        <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">📬 宛先情報</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">会社名</label>
            <input type="text" class="form-input" id="editTemplateCompany" placeholder="例：小倉サンダイン株式会社">
          </div>
          <div class="form-group">
            <label class="form-label">担当者名</label>
            <input type="text" class="form-input" id="editTemplateContact" placeholder="例：井上さま">
          </div>
          <div class="form-group">
            <label class="form-label">メールアドレス</label>
            <input type="email" class="form-input" id="editTemplateEmail" placeholder="例：sample@example.com">
          </div>
        </div>
        <p style="margin: 8px 0 0; font-size: 12px; color: var(--text-secondary);">
          ※複数の宛先がある場合は、担当者名・メールアドレスを改行またはセミコロン(;)で区切って入力してください
        </p>
      </div>

      <!-- 件名・本文 -->
      <div class="form-group" style="margin-bottom: 16px;">
        <label class="form-label">件名テンプレート</label>
        <input type="text" class="form-input" id="editTemplateSubject" placeholder="例：{customerName}様邸 〇〇依頼">
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          使用可能な変数: {customerName}=お客様名, {staffName}=担当者名, {dueDate}=期日
        </p>
      </div>

      <div class="form-group">
        <label class="form-label">本文テンプレート</label>
        <textarea class="form-input" id="editTemplateBody" rows="15" style="font-family: monospace; font-size: 13px;" placeholder="メール本文を入力..."></textarea>
        <p style="margin: 4px 0 0; font-size: 12px; color: var(--text-secondary);">
          使用可能な変数: {company}=会社名, {contact}=担当者名, {customerName}=お客様名, {staffName}=担当者名, {dueDate}=期日, {specialContent}=特記事項
        </p>
      </div>

      <!-- 複数業者選択（template_vendors） -->
      <div id="editTemplateVendorsSection" style="display: none; margin-top: 24px;">
        <div class="card" style="padding: 16px; background: var(--bg-secondary);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0; font-size: 16px; font-weight: 600;">🏢 業者一覧（選択式）</h3>
            <button class="btn btn-ghost btn-small" onclick="addTemplateVendorRow()">+ 業者追加</button>
          </div>
          <div id="templateVendorsList"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeEditTemplateModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveRequestTemplate()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：案件追加/編集 -->
<div id="projectModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="projectModalTitle">案件追加</h2>
      <button class="close" onclick="closeProjectModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">お客様名 *</label>
        <input type="text" class="form-input" id="projectCustomer" placeholder="例：田中太郎様">
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
        <div class="form-group">
          <label class="form-label">担当（設計） *</label>
          <select class="form-select" id="projectAssignedTo"></select>
        </div>
        <div class="form-group">
          <label class="form-label">担当（IC）</label>
          <select class="form-select" id="projectIcAssignee">
            <option value="">未定</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">担当（外構）</label>
          <select class="form-select" id="projectExteriorAssignee">
            <option value="">未定</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">担当（不動産）</label>
          <select class="form-select" id="projectRealestateAssignee">
            <option value="">未定</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">担当（工事）</label>
          <select class="form-select" id="projectConstructionAssignee">
            <option value="">未定</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">担当（営業）</label>
          <select class="form-select" id="projectSalesAssignee">
            <option value="">未定</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">商品</label>
        <select class="form-select" id="projectSpecifications"></select>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: flex-end;">
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closeProjectModal()">キャンセル</button>
        <button class="btn btn-primary" onclick="saveProject()">保存</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：メールテンプレート追加/編集 -->
<div id="templateModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="templateModalTitle">テンプレート追加</h2>
      <button class="close" onclick="closeTemplateModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">テンプレートID *</label>
        <input type="text" class="form-input" id="templateId" placeholder="例：new-template">
        <div class="form-hint">英数字とハイフンのみ使用可能</div>
      </div>
      <div class="form-group">
        <label class="form-label">表示名 *</label>
        <input type="text" class="form-input" id="templateDisplayName" placeholder="例：新会社名（作業内容）">
      </div>
      <div class="form-group">
        <label class="form-label">カテゴリ *</label>
        <select class="form-select" id="templateCategory">
          <option value="設計">設計</option>
          <option value="IC">IC</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">会社名 *</label>
        <input type="text" class="form-input" id="templateCompany" placeholder="例：株式会社〇〇">
      </div>
      <div class="form-group">
        <label class="form-label">宛先名</label>
        <input type="text" class="form-input" id="templateContact" placeholder="例：田中様">
      </div>
      <div class="form-group">
        <label class="form-label">メールアドレス</label>
        <input type="text" class="form-input" id="templateEmail" placeholder="例：tanaka@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">件名フォーマット *</label>
        <input type="text" class="form-input" id="templateSubjectFormat" placeholder="例：{customerName}様 新規〇〇作成依頼　期日{dueDate}">
        <div class="form-hint">使用可能：{customerName}, {dueDate}, {staffName}</div>
      </div>
      <div class="form-group">
        <label class="form-label">メール本文 *</label>
        <textarea class="form-textarea" id="templateText" rows="10" placeholder="例:&#10;{company}&#10;{contact}&#10;&#10;いつもお世話になっております。"></textarea>
        <div class="form-hint">使用可能：{company}, {contact}, {customerName}, {dueDate}, {staffName}, {specialContent}</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeTemplateModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveTemplate()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：担当管理 -->
<div id="designerModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">担当管理</h2>
      <button class="close" onclick="closeDesignerModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">新しい担当を追加</label>
        <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 12px;">
          <input type="text" class="form-input" id="newDesignerName" placeholder="担当名">
          <select class="form-select" id="newDesignerCategory" style="width: 150px;">
            <option value="設計">設計担当</option>
            <option value="IC">IC担当</option>
            <option value="外構">外構担当</option>
            <option value="不動産">不動産担当</option>
            <option value="工事">工事担当</option>
            <option value="営業">営業担当</option>
            <option value="管理者">管理者</option>
          </select>
          <button class="btn btn-primary" onclick="addDesigner()">追加</button>
        </div>
      </div>
      <div id="designerList"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="closeDesignerModal()">完了</button>
    </div>
  </div>
</div>

<!-- モーダル：メール作成 -->
<div id="emailModal" class="modal">
  <div class="modal-content" style="max-width: 1000px;">
    <div class="modal-header">
      <h2 class="modal-title">📧 メール作成</h2>
      <button class="close" onclick="closeEmailModal()">&times;</button>
    </div>
    <div class="modal-body" id="emailComposerContent"></div>
  </div>
</div>

<!-- モーダル：サッシプレゼン・開口部リスト作成依頼 -->
<div id="sashRequestModal" class="modal">
  <div class="modal-content" style="max-width: 1100px;">
    <div class="modal-header">
      <h2 class="modal-title">🪟 サッシプレゼン・開口部リスト作成依頼</h2>
      <button class="close" onclick="closeSashRequestModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <!-- 左カラム：入力フォーム -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📝 依頼内容</h3>

          <div class="form-group">
            <label class="form-label">物件名（お客様名） *</label>
            <input type="text" class="form-input" id="sashCustomerName" placeholder="例：山田" oninput="updateSashEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">担当者名 *</label>
            <input type="text" class="form-input" id="sashStaffName" placeholder="例：田中" oninput="updateSashEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">期日</label>
            <input type="date" class="form-input" id="sashDueDate" oninput="updateSashEmail()">
            <div class="form-hint">自動で次の金曜日が設定されます</div>
          </div>

          <div class="form-group">
            <label class="form-label">地域</label>
            <select class="form-select" id="sashRegion" onchange="updateSashEmail()">
              <!-- オプションはJSで動的生成 -->
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">玄関ドア</label>
            <input type="text" class="form-input" id="sashEntranceDoor" placeholder="例：C10 カームブラック" oninput="updateSashEmail()">
            <div class="form-hint">決まっていれば打合せ通りのものを入力</div>
          </div>

          <div class="form-group">
            <label class="form-label">サッシ色</label>
            <input type="text" class="form-input" id="sashColor" placeholder="例：内外ブラック" oninput="updateSashEmail()">
            <div class="form-hint">決まっていれば打合せ通りのものを入力</div>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning-color);">📎 添付必要図面</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
              <li>配置図</li>
              <li>平面図（サッシ記号が入っているもの）</li>
              <li>立面図</li>
            </ul>
            <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
              ※高所用すべり出し窓の場合は開閉仕様を記載すること
            </div>
          </div>
        </div>

        <!-- 右カラム：プレビュー -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📬 生成されたメール</h3>

          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <div id="sashEmailTo" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copySashText('sashEmailTo')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">CC</label>
            <div id="sashEmailCc" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copySashText('sashEmailCc')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">件名</label>
            <div id="sashEmailSubject" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;"></div>
            <button class="btn btn-ghost btn-small" onclick="copySashText('sashEmailSubject')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">本文</label>
            <div id="sashEmailBody" style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; white-space: pre-wrap; line-height: 1.7; font-size: 13px; max-height: 350px; overflow-y: auto;"></div>
            <button class="btn btn-ghost btn-small" onclick="copySashText('sashEmailBody')" style="margin-top: 6px;">📋 コピー</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 12px; color: var(--text-muted);">
        💡 メールアドレス・件名・本文をコピーしてメールソフトに貼り付けてください
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closeSashRequestModal()">閉じる</button>
        <button class="btn btn-primary" id="sashMarkRequestedBtn" onclick="markSashAsRequested()">依頼済みにする</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：ダンパー（evoltz）依頼 -->
<div id="damperRequestModal" class="modal">
  <div class="modal-content" style="max-width: 1100px;">
    <div class="modal-header">
      <h2 class="modal-title">🔧 ダンパー（evoltz）依頼</h2>
      <button class="close" onclick="closeDamperRequestModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <!-- 左カラム：入力フォーム -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📝 依頼内容</h3>

          <div class="form-group">
            <label class="form-label">物件名（お客様名） *</label>
            <input type="text" class="form-input" id="damperCustomerName" placeholder="例：山田" oninput="updateDamperEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">担当者名 *</label>
            <input type="text" class="form-input" id="damperStaffName" placeholder="例：田中" oninput="updateDamperEmail()">
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning-color);">📎 添付必要図面</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
              <li>平面図</li>
              <li>立面図</li>
              <li>配置図（PDF）</li>
              <li>基礎伏図</li>
              <li>耐力壁図</li>
              <li>金物図</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--danger-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--danger-color);">⚠️ 注意事項</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: var(--text-secondary);">
              <li>構造チェック2回目完了後に依頼すること</li>
              <li>筋交いがたすき掛けで入っている場所には施工不可<br>（断熱材の欠損や施工性が悪いため）</li>
              <li>外部で片筋交いの部分も同様<br>（やむを得ない場合はOK）</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--info-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--info-color);">📁 保存先</div>
            <div style="font-size: 11px; color: var(--text-secondary); word-break: break-all;">
              G:\共有ドライブ\０２-１｜お客様資料\02.請負契約済\各物件\06.見積・プレゼン・承認図\11 エボルツ
            </div>
            <div style="font-size: 12px; color: var(--text-muted); margin-top: 6px;">
              保存資料：見積・配置図・発注書 ※エアコンの資料がある場合は、そちらも
            </div>
          </div>
        </div>

        <!-- 右カラム：プレビュー -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📬 生成されたメール</h3>

          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <div id="damperEmailTo" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyDamperText('damperEmailTo')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">CC</label>
            <div id="damperEmailCc" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyDamperText('damperEmailCc')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">件名</label>
            <div id="damperEmailSubject" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyDamperText('damperEmailSubject')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">本文</label>
            <div id="damperEmailBody" style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; white-space: pre-wrap; line-height: 1.7; font-size: 13px; max-height: 400px; overflow-y: auto;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyDamperText('damperEmailBody')" style="margin-top: 6px;">📋 コピー</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 12px; color: var(--text-muted);">
        💡 メールアドレス・件名・本文をコピーしてメールソフトに貼り付けてください
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closeDamperRequestModal()">閉じる</button>
        <button class="btn btn-primary" id="damperMarkRequestedBtn" onclick="markDamperAsRequested()">依頼済みにする</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：換気システム依頼（標準パナソニック） -->
<div id="ventilationRequestModal" class="modal">
  <div class="modal-content" style="max-width: 1100px;">
    <div class="modal-header">
      <h2 class="modal-title">🌀 換気システム依頼（標準パナソニック）</h2>
      <button class="close" onclick="closeVentilationRequestModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <!-- 左カラム：入力フォーム -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📝 依頼内容</h3>

          <div class="form-group">
            <label class="form-label">物件名（お客様名） *</label>
            <input type="text" class="form-input" id="ventilationCustomerName" placeholder="例：山田" oninput="updateVentilationEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">担当者名 *</label>
            <input type="text" class="form-input" id="ventilationStaffName" placeholder="例：田中" oninput="updateVentilationEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">期日</label>
            <input type="date" class="form-input" id="ventilationDueDate" oninput="updateVentilationEmail()">
            <div class="form-hint">自動で翌週の金曜日が設定されます（5〜7営業日）</div>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning-color);">📎 添付必要図面</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
              <li>平面図</li>
              <li>立面図（ファサード確認用）</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--info-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--info-color);">💡 注意事項</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 12px; color: var(--text-secondary);">
              <li>ファサードにフードが出ないように指示</li>
              <li>外部フードはすべてFD付き</li>
              <li>DSDDの場合は別途マニュアル確認</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--danger-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--danger-color);">⚠️ DSDD（オプション）の場合</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 11px; color: var(--text-secondary);">
              <li>基礎の仕様が標準(400㎜)とは違い450㎜ → 構造図注意</li>
              <li>床断熱→基礎断熱になる</li>
              <li>DSが必須、床面に排気口設置が必要</li>
              <li>床下点検口が3〜4個入る → 事前にお客様にお伝え</li>
            </ul>
          </div>
        </div>

        <!-- 右カラム：プレビュー -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📬 生成されたメール</h3>

          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <div id="ventilationEmailTo" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyVentilationText('ventilationEmailTo')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">CC</label>
            <div id="ventilationEmailCc" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyVentilationText('ventilationEmailCc')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">件名</label>
            <div id="ventilationEmailSubject" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyVentilationText('ventilationEmailSubject')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">本文</label>
            <div id="ventilationEmailBody" style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; white-space: pre-wrap; line-height: 1.7; font-size: 13px; max-height: 350px; overflow-y: auto;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyVentilationText('ventilationEmailBody')" style="margin-top: 6px;">📋 コピー</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 12px; color: var(--text-muted);">
        💡 メールアドレス・件名・本文をコピーしてメールソフトに貼り付けてください
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closeVentilationRequestModal()">閉じる</button>
        <button class="btn btn-primary" id="ventilationMarkRequestedBtn" onclick="markVentilationAsRequested()">依頼済みにする</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：地盤調査依頼 -->
<div id="groundSurveyRequestModal" class="modal">
  <div class="modal-content" style="max-width: 1100px;">
    <div class="modal-header">
      <h2 class="modal-title">🔍 地盤調査依頼</h2>
      <button class="close" onclick="closeGroundSurveyRequestModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <!-- 左カラム：入力フォーム -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📝 依頼内容</h3>

          <div class="form-group">
            <label class="form-label">物件名（お客様名） *</label>
            <input type="text" class="form-input" id="groundSurveyCustomerName" placeholder="例：山田" oninput="updateGroundSurveyEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">担当者名 *</label>
            <input type="text" class="form-input" id="groundSurveyStaffName" placeholder="例：田中" oninput="updateGroundSurveyEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">期日</label>
            <input type="date" class="form-input" id="groundSurveyDueDate" oninput="updateGroundSurveyEmail()">
            <div class="form-hint">自動で次の金曜日が設定されます</div>
          </div>

          <div class="form-group">
            <label class="form-label">エリア（業者選択） *</label>
            <select class="form-select" id="groundSurveyVendor" onchange="updateGroundSurveyEmail()">
              <option value="">選択してください</option>
              <!-- オプションはJSで動的生成 -->
            </select>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning-color);">📎 添付必要図面</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
              <li>配置図（寸法が記載されているもの）</li>
              <li>平面図</li>
              <li>立面図</li>
              <li>依頼書</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--danger-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--danger-color);">⚠️ 調査可能条件の確認</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 11px; color: var(--text-secondary);">
              <li>建て替えで所有が親族もしくは建築主の場合 → OK</li>
              <li>分譲地や仲介物件で土地決済がまだ → 担当に確認</li>
              <li>解体前であれば解体日程の確認</li>
              <li>草刈り状況など現場が調査可能な状態か確認</li>
            </ul>
          </div>
        </div>

        <!-- 右カラム：プレビュー -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📬 生成されたメール</h3>

          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <div id="groundSurveyEmailTo" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyGroundSurveyText('groundSurveyEmailTo')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">CC</label>
            <div id="groundSurveyEmailCc" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyGroundSurveyText('groundSurveyEmailCc')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">件名</label>
            <div id="groundSurveyEmailSubject" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyGroundSurveyText('groundSurveyEmailSubject')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">本文</label>
            <div id="groundSurveyEmailBody" style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; white-space: pre-wrap; line-height: 1.7; font-size: 13px; max-height: 350px; overflow-y: auto;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyGroundSurveyText('groundSurveyEmailBody')" style="margin-top: 6px;">📋 コピー</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 12px; color: var(--text-muted);">
        💡 メールアドレス・件名・本文をコピーしてメールソフトに貼り付けてください
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closeGroundSurveyRequestModal()">閉じる</button>
        <button class="btn btn-primary" onclick="markGroundSurveyAsRequested()">依頼済みにする</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：外部給排水経路図依頼 -->
<div id="plumbingRequestModal" class="modal">
  <div class="modal-content" style="max-width: 1100px;">
    <div class="modal-header">
      <h2 class="modal-title">🚰 外部給排水経路図依頼</h2>
      <button class="close" onclick="closePlumbingRequestModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <!-- 左カラム：入力フォーム -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📝 依頼内容</h3>

          <div class="form-group">
            <label class="form-label">物件名（お客様名） *</label>
            <input type="text" class="form-input" id="plumbingCustomerName" placeholder="例：山田" oninput="updatePlumbingEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">担当者名 *</label>
            <input type="text" class="form-input" id="plumbingStaffName" placeholder="例：田中" oninput="updatePlumbingEmail()">
          </div>

          <div class="form-group">
            <label class="form-label">期日</label>
            <input type="date" class="form-input" id="plumbingDueDate" oninput="updatePlumbingEmail()">
            <div class="form-hint">自動で次の金曜日が設定されます</div>
          </div>

          <div class="form-group">
            <label class="form-label">案件タイプ *</label>
            <select class="form-select" id="plumbingProjectType" onchange="updatePlumbingVendorOptions()">
              <option value="">選択してください</option>
              <option value="fabless">ファブレス案件（現場監督が自社でない）</option>
              <option value="internal">自社監督案件</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">業者選択 *</label>
            <select class="form-select" id="plumbingVendor" onchange="updatePlumbingEmail()">
              <option value="">先に案件タイプを選択してください</option>
            </select>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--warning-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--warning-color);">📎 添付必要図面</div>
            <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary);">
              <li>配置図</li>
              <li>平面図</li>
              <li>立面図</li>
              <li>契約時の見積</li>
            </ul>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: var(--info-light); border-radius: 8px;">
            <div style="font-weight: 600; margin-bottom: 8px; color: var(--info-color);">📁 保存先</div>
            <div style="font-size: 10px; color: var(--text-secondary); word-break: break-all;">
              G:\共有ドライブ\０２-１｜お客様資料\０２｜請負契約済\○○○○様邸\06.見積・プレゼン・承認図\02 上下水道引き込み
            </div>
          </div>
        </div>

        <!-- 右カラム：プレビュー -->
        <div>
          <h3 style="margin-bottom: 16px; font-size: 15px; color: var(--text-primary); border-bottom: 2px solid var(--primary-light); padding-bottom: 8px;">📬 生成されたメール</h3>

          <div class="form-group">
            <label class="form-label">宛先（To）</label>
            <div id="plumbingEmailTo" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyPlumbingText('plumbingEmailTo')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">CC</label>
            <div id="plumbingEmailCc" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 13px;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyPlumbingText('plumbingEmailCc')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">件名</label>
            <div id="plumbingEmailSubject" style="padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-weight: 500;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyPlumbingText('plumbingEmailSubject')" style="margin-top: 6px;">📋 コピー</button>
          </div>

          <div class="form-group">
            <label class="form-label">本文</label>
            <div id="plumbingEmailBody" style="padding: 12px; background: var(--bg-secondary); border-radius: 6px; white-space: pre-wrap; line-height: 1.7; font-size: 13px; max-height: 350px; overflow-y: auto;"></div>
            <button class="btn btn-ghost btn-small" onclick="copyPlumbingText('plumbingEmailBody')" style="margin-top: 6px;">📋 コピー</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="font-size: 12px; color: var(--text-muted);">
        💡 メールアドレス・件名・本文をコピーしてメールソフトに貼り付けてください
      </div>
      <div style="display: flex; gap: 12px;">
        <button class="btn btn-ghost" onclick="closePlumbingRequestModal()">閉じる</button>
        <button class="btn btn-primary" onclick="markPlumbingAsRequested()">依頼済みにする</button>
      </div>
    </div>
  </div>
</div>

<!-- モーダル：業者追加/編集V2 -->
<div id="vendorModalV2" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2 class="modal-title" id="vendorModalTitle">業者追加</h2>
      <button class="close" onclick="closeVendorModalV2()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="vendorForm">
        <input type="hidden" id="vendorId">

        <h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">基本情報</h3>

        <div class="form-group">
          <label class="form-label">会社名 *</label>
          <input type="text" class="form-input" id="vendorCompany" placeholder="例：株式会社〇〇" required>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">担当者名</label>
            <input type="text" class="form-input" id="vendorContact" placeholder="例：田中様">
          </div>

          <div class="form-group">
            <label class="form-label">電話番号</label>
            <input type="text" class="form-input" id="vendorTel" placeholder="例：090-1234-5678">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">メールアドレス</label>
            <input type="email" class="form-input" id="vendorEmail" placeholder="例：tanaka@example.com">
          </div>

          <div class="form-group">
            <label class="form-label">カテゴリ</label>
            <select class="form-select" id="vendorCategory"></select>
          </div>
        </div>

        <h3 style="margin: 24px 0 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">メールテンプレート</h3>

        <div class="form-group">
          <label class="form-label">件名フォーマット</label>
          <input type="text" class="form-input" id="vendorSubject" placeholder="例：{customerName}様 新規〇〇作成依頼　期日{dueDate}">
          <div class="form-hint">使用可能：{customerName}, {dueDate}, {staffName}</div>
        </div>

        <div class="form-group">
          <label class="form-label">メール本文</label>
          <textarea class="form-textarea" id="vendorTemplate" rows="8" placeholder="例:&#10;{company}&#10;{contact}&#10;&#10;いつもお世話になっております。"></textarea>
          <div class="form-hint">使用可能：{company}, {contact}, {customerName}, {dueDate}, {staffName}</div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeVendorModalV2()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveVendorV2()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：担当者タスク一覧 -->
<div id="staffTasksModal" class="modal">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2 class="modal-title" id="staffTasksModalTitle">タスク一覧</h2>
      <button class="close" onclick="closeStaffTasksModal()">&times;</button>
    </div>
    <div class="modal-body task-list-modal">
      <div style="margin-bottom: 16px; display: flex; gap: 8px;">
        <button class="btn btn-small btn-ghost" id="sortByDueBtn" onclick="sortTasksBy('due')">期限順</button>
        <button class="btn btn-small btn-ghost" id="sortByProjectBtn" onclick="sortTasksBy('project')">邸名順</button>
      </div>
      <div id="staffTasksList"></div>
    </div>
  </div>
</div>

<!-- モーダル：カテゴリ追加/編集 -->
<div id="categoryModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="categoryModalTitle">カテゴリ追加</h2>
      <button class="close" onclick="closeCategoryModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="categoryForm">
        <input type="hidden" id="categoryId">

        <div class="form-group">
          <label class="form-label">カテゴリ名 *</label>
          <input type="text" class="form-input" id="categoryName" placeholder="例：設備" required>
        </div>

        <div class="form-group">
          <label class="form-label">表示順</label>
          <input type="number" class="form-input" id="categoryOrder" placeholder="1" min="1">
          <div class="form-hint">小さい数字ほど先に表示されます</div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeCategoryModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveCategory()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：タスク追加/編集 -->
<div id="taskModal" class="modal">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2 class="modal-title" id="taskModalTitle">タスク追加</h2>
      <button class="close" onclick="closeTaskModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="taskForm">
        <input type="hidden" id="taskId">
        <input type="hidden" id="taskKey">

        <div class="form-group">
          <label class="form-label">タスク名 *</label>
          <input type="text" class="form-input" id="taskName" placeholder="例：0回目打合せ" required>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">カテゴリ *</label>
            <select class="form-select" id="taskCategory" required>
              <option value="設計">設計</option>
              <option value="IC">IC</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">表示順</label>
            <input type="number" class="form-input" id="taskOrder" placeholder="1" min="1">
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="taskHasState" onchange="toggleTaskState()">
            <span>状態管理を有効にする</span>
          </label>
          <div class="form-hint">チェックすると「依頼済」「保存済」などの状態を選択可能になります</div>
        </div>

        <div id="stateOptionsGroup" style="display: none;">
          <div class="form-group">
            <label class="form-label">状態オプション</label>
            <div id="stateOptionsList" class="state-options-list">
              <!-- 動的に追加される -->
            </div>
            <button type="button" class="btn btn-ghost btn-small" onclick="addStateOption()" style="margin-top: 8px;">+ オプション追加</button>
            <div class="form-hint">各オプションを入力してください。空欄（-）は自動で先頭に追加されます</div>
            <input type="hidden" id="taskStateOptions">
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="taskHasEmailButton">
            <span>📧 メール作成ボタンを表示する</span>
          </label>
          <div class="form-hint">チェックすると案件カードのタスクに📧ボタンが表示されます</div>
        </div>

        <div class="form-group">
          <label class="form-label">紐づけ業者（複数選択可）</label>
          <div id="taskVendorSelection" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 8px; border-radius: 4px;">
            <!-- ベンダーのチェックボックスリストがここに表示される -->
          </div>
          <div class="form-hint">このタスクから直接メールを送信する業者を選択してください</div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeTaskModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveTask()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：FC追加/編集 -->
<div id="fcModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <h2 class="modal-title" id="fcModalTitle">FC追加</h2>
      <button class="close" onclick="closeFcModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="fcForm">
        <input type="hidden" id="fcId">

        <div class="form-group">
          <label class="form-label">FC名 *</label>
          <input type="text" class="form-input" id="fcName" placeholder="例：東京フランチャイズ" required>
        </div>

        <div class="form-group">
          <label class="form-label">URLスラッグ *</label>
          <input type="text" class="form-input" id="fcSlug" placeholder="例：tokyo-fc" required pattern="[a-z0-9-]+" title="半角英数字とハイフンのみ使用可能">
          <div class="form-hint">半角英数字とハイフンのみ。例: tokyo-fc → /fc/tokyo-fc/ でアクセス可能</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">連絡先メール</label>
            <input type="email" class="form-input" id="fcEmail" placeholder="contact@example.com">
          </div>
          <div class="form-group">
            <label class="form-label">連絡先電話</label>
            <input type="tel" class="form-input" id="fcTel" placeholder="03-1234-5678">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ブランドカラー</label>
          <div style="display: flex; gap: 12px; align-items: center;">
            <input type="color" id="fcColor" value="#2563EB" style="width: 50px; height: 36px; border: none; border-radius: 4px; cursor: pointer;" oninput="document.getElementById('fcColorText').value = this.value">
            <input type="text" class="form-input" id="fcColorText" value="#2563EB" style="width: 120px;" oninput="document.getElementById('fcColor').value = this.value">
          </div>
          <div class="form-hint">FC専用画面で使用されるメインカラー</div>
        </div>

        <div class="form-group">
          <label class="form-label">カスタムロゴURL</label>
          <input type="url" class="form-input" id="fcLogoUrl" placeholder="https://example.com/logo.png">
          <div class="form-hint">空白の場合はデフォルトのシステムアイコンが表示されます</div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="fcIsActive" checked>
            <span>有効</span>
          </label>
          <div class="form-hint">無効にするとFC専用URLにアクセスできなくなります</div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeFcModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveFc()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：担当認証設定 -->
<div id="designerAuthModal" class="modal">
  <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
      <h2 class="modal-title">🔑 担当認証設定</h2>
      <button class="close" onclick="closeDesignerAuthModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="designerAuthForm">
        <input type="hidden" id="authDesignerId">

        <div class="form-group">
          <label class="form-label">担当名</label>
          <input type="text" class="form-input" id="authDesignerName" disabled>
        </div>

        <div class="form-group">
          <label class="form-label">メールアドレス（ログインID） *</label>
          <input type="email" class="form-input" id="authDesignerEmail" placeholder="例：yamada@ghouse.jp" required>
          <div class="form-hint">このメールアドレスでログインできるようになります</div>
        </div>

        <div class="form-group">
          <label class="form-label">パスワード *</label>
          <input type="password" class="form-input" id="authDesignerPassword" placeholder="8文字以上" required autocomplete="new-password">
          <div class="form-hint">8文字以上で設定してください</div>
        </div>

        <div class="form-group">
          <label class="form-label">パスワード（確認） *</label>
          <input type="password" class="form-input" id="authDesignerPasswordConfirm" placeholder="もう一度入力" autocomplete="new-password">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeDesignerAuthModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="saveDesignerAuth()">保存</button>
    </div>
  </div>
</div>

<!-- モーダル：申請Go確認 -->
<div id="applicationGoModal" class="modal">
  <div class="modal-content" style="max-width: 450px;">
    <div class="modal-header">
      <h2 class="modal-title">申請GO</h2>
      <button class="close" onclick="closeApplicationGoModal()">&times;</button>
    </div>
    <div class="modal-body" style="text-align: center; padding: 30px;">
      <div style="font-size: 48px; margin-bottom: 16px;">🚀</div>
      <p id="applicationGoProjectName" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;"></p>
      <p style="color: var(--text-secondary); margin-bottom: 24px;">申請GOを実行しますか？</p>
      <div class="application-go-checklist" style="text-align: left; background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 8px;">条件確認:</div>
        <div id="applicationGoConditions"></div>
      </div>
    </div>
    <div class="modal-footer" style="justify-content: center; gap: 12px;">
      <button class="btn btn-ghost" onclick="closeApplicationGoModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="executeApplicationGo()">申請GOを実行</button>
    </div>
  </div>
</div>

<!-- モーダル：完了済み確認 -->
<div id="archiveConfirmModal" class="modal">
  <div class="modal-content" style="max-width: 400px;">
    <div class="modal-header">
      <h2 class="modal-title">完了済みに移動</h2>
      <button class="close" onclick="closeArchiveConfirmModal()">&times;</button>
    </div>
    <div class="modal-body" style="text-align: center; padding: 30px;">
      <div style="font-size: 48px; margin-bottom: 16px;">📦</div>
      <p id="archiveConfirmProjectName" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;"></p>
      <p style="color: var(--text-secondary); margin-bottom: 16px;">この案件を完了済みに移動しますか？</p>
      <p style="color: var(--text-muted); font-size: 12px;">完了済みの案件は「完了済」フィルターで確認できます。</p>
    </div>
    <div class="modal-footer" style="justify-content: center; gap: 12px;">
      <button class="btn btn-ghost" onclick="closeArchiveConfirmModal()">キャンセル</button>
      <button class="btn btn-success" onclick="executeArchive()" style="background: linear-gradient(135deg, #10b981, #059669);">完了済みにする</button>
    </div>
  </div>
</div>

<!-- トースト通知 -->
<div id="toast" class="toast"></div>
<div id="contextMenu" class="context-menu">
  <div class="context-menu-item" onclick="ContextMenu.edit()">✏️ 編集</div>
  <div class="context-menu-item" onclick="ContextMenu.toggleSelect()">☑️ 選択</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item" onclick="ContextMenu.archive()">📦 完了済みに移動</div>
  <div class="context-menu-item danger" onclick="ContextMenu.delete()">🗑️ 削除</div>
</div>

<script src="/archideck/app.js"></script>

<!-- ローディングオーバーレイ -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-card">
    <div class="loading-spinner large"></div>
    <div class="loading-text" id="loadingText">読み込み中...</div>
  </div>
</div>

<!-- フローティングアクションボタン -->
<div class="fab-container" id="fabContainer">
  <div class="fab-menu" id="fabMenu">
    <div class="fab-menu-item" onclick="FAB.action('new')">
      <span class="icon">➕</span>
      <span>新規案件作成</span>
    </div>
    <div class="fab-menu-item" onclick="FAB.action('refresh')">
      <span class="icon">🔄</span>
      <span>データ再読み込み</span>
    </div>
    <div class="fab-menu-item" onclick="FAB.action('export')">
      <span class="icon">📊</span>
      <span>CSV出力</span>
    </div>
    <div class="fab-menu-item" onclick="FAB.action('print')">
      <span class="icon">🖨️</span>
      <span>レポート印刷</span>
    </div>
    <div class="fab-menu-item" onclick="FAB.action('help')">
      <span class="icon">⌨️</span>
      <span>ショートカット</span>
    </div>
  </div>
  <button class="fab-button" id="fabButton" onclick="FAB.toggle()" title="クイックアクション">
    ➕
  </button>
</div>
</body>
</html>
