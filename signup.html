<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹ | ArchiDeck</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ </text></svg>">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@300;400;500;700;800&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary: #4A90E2;
  --primary-dark: #357ABD;
  --secondary: #50E3C2;
  --danger: #E94B3C;
  --success: #7ED321;
  --text: #2C3E50;
  --text-light: #7F8C8D;
  --bg: #FFFFFF;
  --bg-light: #F8F9FA;
  --border: #E1E8ED;
}

body {
  font-family: 'Inter', 'Noto Sans JP', -apple-system, sans-serif;
  background: linear-gradient(135deg, #F0F7FF 0%, #E8F4FD 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}

.signup-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  max-width: 1100px;
  width: 100%;
  background: white;
  border-radius: 24px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
}

.signup-left {
  padding: 60px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.signup-left h1 {
  font-size: 36px;
  font-weight: 800;
  margin-bottom: 24px;
  line-height: 1.3;
}

.signup-left p {
  font-size: 16px;
  opacity: 0.9;
  margin-bottom: 40px;
  line-height: 1.7;
}

.benefits {
  list-style: none;
}

.benefits li {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  font-size: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.15);
}

.benefits li:last-child {
  border-bottom: none;
}

.benefits .icon {
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

.signup-right {
  padding: 60px;
}

.signup-header {
  margin-bottom: 32px;
}

.signup-header h2 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text);
}

.signup-header p {
  color: var(--text-light);
  font-size: 15px;
}

.signup-header a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 600;
}

.signup-header a:hover {
  text-decoration: underline;
}

/* ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
.steps {
  display: flex;
  gap: 8px;
  margin-bottom: 32px;
}

.step {
  flex: 1;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  transition: background 0.3s;
}

.step.active {
  background: var(--primary);
}

.step.completed {
  background: var(--success);
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.form-step {
  display: none;
}

.form-step.active {
  display: block;
}

.form-group {
  margin-bottom: 24px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 15px;
  font-family: inherit;
  transition: all 0.2s;
  background: var(--bg);
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
}

.form-input.error {
  border-color: var(--danger);
}

.form-hint {
  font-size: 13px;
  color: var(--text-light);
  margin-top: 6px;
}

.form-error {
  font-size: 13px;
  color: var(--danger);
  margin-top: 6px;
  display: none;
}

.form-error.show {
  display: block;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

/* ãƒ—ãƒ©ãƒ³é¸æŠ */
.plan-options {
  display: grid;
  gap: 12px;
  margin-bottom: 24px;
}

.plan-option {
  padding: 20px;
  border: 2px solid var(--border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.plan-option:hover {
  border-color: var(--primary);
  background: var(--bg-light);
}

.plan-option.selected {
  border-color: var(--primary);
  background: rgba(74, 144, 226, 0.05);
}

.plan-option input {
  position: absolute;
  opacity: 0;
}

.plan-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.plan-name {
  font-size: 16px;
  font-weight: 700;
  color: var(--text);
}

.plan-price {
  font-size: 18px;
  font-weight: 800;
  color: var(--primary);
}

.plan-desc {
  font-size: 13px;
  color: var(--text-light);
}

.plan-badge {
  position: absolute;
  top: -10px;
  right: 16px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 4px 12px;
  border-radius: 50px;
  font-size: 11px;
  font-weight: 700;
}

/* ãƒœã‚¿ãƒ³ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  padding: 16px 24px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  border: none;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 4px 14px rgba(74, 144, 226, 0.35);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(74, 144, 226, 0.45);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background: white;
  color: var(--text);
  border: 2px solid var(--border);
}

.btn-secondary:hover {
  border-color: var(--primary);
  color: var(--primary);
}

.form-actions {
  display: flex;
  gap: 12px;
  margin-top: 32px;
}

.form-actions .btn {
  flex: 1;
}

/* å®Œäº†ç”»é¢ */
.success-screen {
  text-align: center;
  padding: 40px 0;
  display: none;
}

.success-screen.show {
  display: block;
}

.success-icon {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, var(--success), #5cb85c);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  margin: 0 auto 24px;
}

.success-screen h2 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--text);
}

.success-screen p {
  color: var(--text-light);
  font-size: 15px;
  margin-bottom: 32px;
  line-height: 1.7;
}

/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
.loading {
  display: none;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.loading.show {
  display: flex;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ */
.password-strength {
  display: flex;
  gap: 4px;
  margin-top: 8px;
}

.strength-bar {
  flex: 1;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  transition: background 0.3s;
}

.strength-bar.weak { background: var(--danger); }
.strength-bar.medium { background: var(--warning, #F5A623); }
.strength-bar.strong { background: var(--success); }

/* è¦ç´„åŒæ„ */
.terms-check {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-bottom: 24px;
}

.terms-check input {
  margin-top: 4px;
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.terms-check label {
  font-size: 14px;
  color: var(--text-light);
  line-height: 1.6;
}

.terms-check a {
  color: var(--primary);
  text-decoration: none;
}

.terms-check a:hover {
  text-decoration: underline;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 900px) {
  .signup-container {
    grid-template-columns: 1fr;
  }

  .signup-left {
    padding: 40px;
    display: none;
  }

  .signup-right {
    padding: 40px;
  }

  .form-row {
    grid-template-columns: 1fr;
  }
}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  padding: 16px 24px;
  background: var(--text);
  color: white;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.3s;
  z-index: 1000;
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

.toast.error {
  background: var(--danger);
}

.toast.success {
  background: var(--success);
}
</style>
</head>
<body>

<div class="signup-container">
  <div class="signup-left">
    <h1>ä½å®…è¨­è¨ˆæ¥­å‹™ã‚’<br>åŠ¹ç‡åŒ–ã—ã¾ã—ã‚‡ã†</h1>
    <p>ArchiDeckã¯ä½å®…ä¼šç¤¾ã®è¨­è¨ˆéƒ¨é–€ã®ãŸã‚ã«é–‹ç™ºã•ã‚ŒãŸã€ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ã®æ¥­å‹™ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚14æ—¥é–“ç„¡æ–™ã§ãŠè©¦ã—ãã ã•ã„ã€‚</p>
    <ul class="benefits">
      <li>
        <span class="icon">ğŸ“‹</span>
        <span>æ¡ˆä»¶ç®¡ç†ã¨17ç¨®é¡ã®ã‚¿ã‚¹ã‚¯é€²æ—ã‚’ä¸€å…ƒç®¡ç†</span>
      </li>
      <li>
        <span class="icon">âœ‰ï¸</span>
        <span>æ¥­è€…ã¸ã®ç™ºæ³¨ãƒ¡ãƒ¼ãƒ«ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ä½œæˆ</span>
      </li>
      <li>
        <span class="icon">ğŸ‘¥</span>
        <span>è¨­è¨ˆå£«ãƒ»ICãƒ»å¤–æ§‹æ‹…å½“ã®ãƒãƒ¼ãƒ ç®¡ç†</span>
      </li>
      <li>
        <span class="icon">ğŸ“Š</span>
        <span>æ‹…å½“è€…ã”ã¨ã®æ¥­å‹™é‡ã‚’å¯è¦–åŒ–</span>
      </li>
      <li>
        <span class="icon">ğŸ”’</span>
        <span>ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·</span>
      </li>
    </ul>
  </div>

  <div class="signup-right">
    <div class="signup-header">
      <h2>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</h2>
      <p>ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ <a href="archideck/index.html">ãƒ­ã‚°ã‚¤ãƒ³</a></p>
    </div>

    <div class="steps">
      <div class="step active" data-step="1"></div>
      <div class="step" data-step="2"></div>
      <div class="step" data-step="3"></div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ä¼šç¤¾æƒ…å ± -->
    <div class="form-step active" id="step1">
      <div class="form-group">
        <label class="form-label">ä¼šç¤¾å *</label>
        <input type="text" class="form-input" id="companyName" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«ä½å®…">
        <div class="form-error" id="companyNameError">ä¼šç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
      </div>

      <div class="form-group">
        <label class="form-label">ä¼šç¤¾URLï¼ˆã‚¹ãƒ©ãƒƒã‚°ï¼‰ *</label>
        <input type="text" class="form-input" id="companySlug" placeholder="ä¾‹ï¼šsample-jutaku">
        <div class="form-hint">https://<strong id="slugPreview">your-company</strong>.archideck.jp ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</div>
        <div class="form-error" id="companySlugError">URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
      </div>

      <div class="form-group">
        <label class="form-label">é›»è©±ç•ªå·</label>
        <input type="tel" class="form-input" id="companyPhone" placeholder="ä¾‹ï¼š06-1234-5678">
      </div>

      <div class="form-actions">
        <a href="landing.html" class="btn btn-secondary">æˆ»ã‚‹</a>
        <button type="button" class="btn btn-primary" onclick="nextStep(2)">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ç®¡ç†è€…æƒ…å ± -->
    <div class="form-step" id="step2">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ãŠåå‰ï¼ˆå§“ï¼‰ *</label>
          <input type="text" class="form-input" id="lastName" placeholder="å±±ç”°">
          <div class="form-error" id="lastNameError">å§“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>
        <div class="form-group">
          <label class="form-label">ãŠåå‰ï¼ˆåï¼‰ *</label>
          <input type="text" class="form-input" id="firstName" placeholder="å¤ªéƒ">
          <div class="form-error" id="firstNameError">åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
        <input type="email" class="form-input" id="email" placeholder="taro.yamada@example.com">
        <div class="form-error" id="emailError">æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
      </div>

      <div class="form-group">
        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ *</label>
        <input type="password" class="form-input" id="password" placeholder="8æ–‡å­—ä»¥ä¸Š">
        <div class="password-strength">
          <div class="strength-bar" id="str1"></div>
          <div class="strength-bar" id="str2"></div>
          <div class="strength-bar" id="str3"></div>
          <div class="strength-bar" id="str4"></div>
        </div>
        <div class="form-hint">8æ–‡å­—ä»¥ä¸Šã€è‹±æ•°å­—ã‚’å«ã‚ã¦ãã ã•ã„</div>
        <div class="form-error" id="passwordError">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„</div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="prevStep(1)">æˆ»ã‚‹</button>
        <button type="button" class="btn btn-primary" onclick="nextStep(3)">æ¬¡ã¸</button>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ©ãƒ³é¸æŠ -->
    <div class="form-step" id="step3">
      <div class="plan-options">
        <label class="plan-option selected">
          <input type="radio" name="plan" value="starter" checked>
          <div class="plan-header">
            <span class="plan-name">ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼</span>
            <span class="plan-price">Â¥9,800/æœˆ</span>
          </div>
          <div class="plan-desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼5åã€æ¡ˆä»¶100ä»¶ã¾ã§</div>
        </label>

        <label class="plan-option">
          <input type="radio" name="plan" value="professional">
          <span class="plan-badge">ãŠã™ã™ã‚</span>
          <div class="plan-header">
            <span class="plan-name">ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«</span>
            <span class="plan-price">Â¥19,800/æœˆ</span>
          </div>
          <div class="plan-desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼15åã€æ¡ˆä»¶500ä»¶ã€kintoneé€£æº</div>
        </label>

        <label class="plan-option">
          <input type="radio" name="plan" value="enterprise">
          <div class="plan-header">
            <span class="plan-name">ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º</span>
            <span class="plan-price">Â¥49,800/æœˆ</span>
          </div>
          <div class="plan-desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼50åã€æ¡ˆä»¶ç„¡åˆ¶é™ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒ«</div>
        </label>
      </div>

      <div class="terms-check">
        <input type="checkbox" id="termsAgree">
        <label for="termsAgree">
          <a href="#" target="_blank">åˆ©ç”¨è¦ç´„</a>ãŠã‚ˆã³<a href="#" target="_blank">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>ã«åŒæ„ã—ã¾ã™
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="prevStep(2)">æˆ»ã‚‹</button>
        <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitSignup()">
          <span class="btn-text">14æ—¥é–“ç„¡æ–™ã§å§‹ã‚ã‚‹</span>
          <span class="loading"><span class="spinner"></span>å‡¦ç†ä¸­...</span>
        </button>
      </div>
    </div>

    <!-- å®Œäº†ç”»é¢ -->
    <div class="success-screen" id="successScreen">
      <div class="success-icon">âœ“</div>
      <h2>ç™»éŒ²å®Œäº†</h2>
      <p>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚<br>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚<br>ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„ã€‚</p>
      <a href="archideck/index.html" class="btn btn-primary">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸</a>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// Supabaseè¨­å®š
const SUPABASE_URL = 'https://twzsirpfudqwboeyakta.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3enNpcnBmdWRxd2JvZXlha3RhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MzM4NjgsImV4cCI6MjA3NzAwOTg2OH0.E_8GxfsO6Scjc0dDoEoyxq3i4lfvNxYZvnSL1OlSDSM';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentStep = 1;

// ã‚¹ãƒ†ãƒƒãƒ—ç§»å‹•
function nextStep(step) {
  if (!validateStep(currentStep)) return;

  document.querySelector(`#step${currentStep}`).classList.remove('active');
  document.querySelector(`#step${step}`).classList.add('active');
  document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
  document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
  document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

  currentStep = step;
}

function prevStep(step) {
  document.querySelector(`#step${currentStep}`).classList.remove('active');
  document.querySelector(`#step${step}`).classList.add('active');
  document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
  document.querySelector(`.step[data-step="${step}"]`).classList.remove('completed');
  document.querySelector(`.step[data-step="${step}"]`).classList.add('active');

  currentStep = step;
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateStep(step) {
  let isValid = true;

  if (step === 1) {
    const companyName = document.getElementById('companyName').value.trim();
    const companySlug = document.getElementById('companySlug').value.trim();

    if (!companyName) {
      showError('companyName', 'companyNameError');
      isValid = false;
    } else {
      hideError('companyName', 'companyNameError');
    }

    if (!companySlug || !/^[a-z0-9-]+$/.test(companySlug)) {
      showError('companySlug', 'companySlugError');
      document.getElementById('companySlugError').textContent = companySlug ? 'è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨ã§ãã¾ã™' : 'URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
      isValid = false;
    } else {
      hideError('companySlug', 'companySlugError');
    }
  }

  if (step === 2) {
    const lastName = document.getElementById('lastName').value.trim();
    const firstName = document.getElementById('firstName').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    if (!lastName) {
      showError('lastName', 'lastNameError');
      isValid = false;
    } else {
      hideError('lastName', 'lastNameError');
    }

    if (!firstName) {
      showError('firstName', 'firstNameError');
      isValid = false;
    } else {
      hideError('firstName', 'firstNameError');
    }

    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showError('email', 'emailError');
      isValid = false;
    } else {
      hideError('email', 'emailError');
    }

    if (!password || password.length < 8) {
      showError('password', 'passwordError');
      isValid = false;
    } else {
      hideError('password', 'passwordError');
    }
  }

  return isValid;
}

function showError(inputId, errorId) {
  document.getElementById(inputId).classList.add('error');
  document.getElementById(errorId).classList.add('show');
}

function hideError(inputId, errorId) {
  document.getElementById(inputId).classList.remove('error');
  document.getElementById(errorId).classList.remove('show');
}

// ã‚¹ãƒ©ãƒƒã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
document.getElementById('companySlug').addEventListener('input', function() {
  const slug = this.value.toLowerCase().replace(/[^a-z0-9-]/g, '-');
  this.value = slug;
  document.getElementById('slugPreview').textContent = slug || 'your-company';
});

// ä¼šç¤¾åã‹ã‚‰ã‚¹ãƒ©ãƒƒã‚°ã‚’è‡ªå‹•ç”Ÿæˆ
document.getElementById('companyName').addEventListener('blur', function() {
  const slugInput = document.getElementById('companySlug');
  if (!slugInput.value) {
    // ç°¡æ˜“çš„ãªã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆï¼ˆå®Ÿéš›ã¯è‹±èªå¤‰æ›ãŒå¿…è¦ï¼‰
    const name = this.value.trim();
    if (name) {
      // æ—¥æœ¬èªã®å ´åˆã¯ãƒ­ãƒ¼ãƒå­—å¤‰æ›ãŒå¿…è¦ã ãŒã€ã“ã“ã§ã¯ç°¡ç•¥åŒ–
      slugInput.value = 'company-' + Date.now().toString(36);
      document.getElementById('slugPreview').textContent = slugInput.value;
    }
  }
});

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦
document.getElementById('password').addEventListener('input', function() {
  const password = this.value;
  let strength = 0;

  if (password.length >= 8) strength++;
  if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
  if (/\d/.test(password)) strength++;
  if (/[^a-zA-Z0-9]/.test(password)) strength++;

  for (let i = 1; i <= 4; i++) {
    const bar = document.getElementById(`str${i}`);
    bar.className = 'strength-bar';
    if (i <= strength) {
      if (strength <= 1) bar.classList.add('weak');
      else if (strength <= 2) bar.classList.add('medium');
      else bar.classList.add('strong');
    }
  }
});

// ãƒ—ãƒ©ãƒ³é¸æŠ
document.querySelectorAll('.plan-option').forEach(option => {
  option.addEventListener('click', function() {
    document.querySelectorAll('.plan-option').forEach(o => o.classList.remove('selected'));
    this.classList.add('selected');
  });
});

// ç™»éŒ²å‡¦ç†
async function submitSignup() {
  if (!validateStep(currentStep)) return;

  const termsAgree = document.getElementById('termsAgree').checked;
  if (!termsAgree) {
    showToast('åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„', 'error');
    return;
  }

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.querySelector('.btn-text').style.display = 'none';
  submitBtn.querySelector('.loading').classList.add('show');

  try {
    const companyName = document.getElementById('companyName').value.trim();
    const companySlug = document.getElementById('companySlug').value.trim();
    const companyPhone = document.getElementById('companyPhone').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const firstName = document.getElementById('firstName').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const plan = document.querySelector('input[name="plan"]:checked').value;

    console.log('ğŸ“ ç™»éŒ²é–‹å§‹:', { companyName, companySlug, email, plan });

    // 1. Supabase Authã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    const { data: authData, error: authError } = await supabase.auth.signUp({
      email: email,
      password: password,
      options: {
        data: {
          first_name: firstName,
          last_name: lastName,
          company_name: companyName
        }
      }
    });

    if (authError) throw authError;

    console.log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†:', authData.user.id);

    // 2. çµ„ç¹”ã‚’ä½œæˆ
    const { data: orgData, error: orgError } = await supabase
      .from('organizations')
      .insert({
        name: companyName,
        slug: companySlug,
        email: email,
        phone: companyPhone
      })
      .select()
      .single();

    if (orgError) {
      console.error('çµ„ç¹”ä½œæˆã‚¨ãƒ©ãƒ¼:', orgError);
      // çµ„ç¹”ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      if (orgError.code === '42P01') {
        console.log('âš ï¸ organizationsãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
      }
    } else {
      console.log('âœ… çµ„ç¹”ä½œæˆå®Œäº†:', orgData.id);

      // 3. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
      const { error: subError } = await supabase
        .from('subscriptions')
        .insert({
          organization_id: orgData.id,
          plan_type: plan,
          status: 'trial'
        });

      if (subError) {
        console.error('ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆã‚¨ãƒ©ãƒ¼:', subError);
      }

      // 4. çµ„ç¹”ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦ç™»éŒ²
      const { error: memberError } = await supabase
        .from('organization_members')
        .insert({
          organization_id: orgData.id,
          user_id: authData.user.id,
          email: email,
          role: 'owner',
          status: 'active',
          joined_at: new Date().toISOString()
        });

      if (memberError) {
        console.error('ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', memberError);
      }
    }

    // æˆåŠŸç”»é¢ã‚’è¡¨ç¤º
    document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
    document.querySelector('.steps').style.display = 'none';
    document.getElementById('successScreen').classList.add('show');

    console.log('âœ… ç™»éŒ²å®Œäº†');

  } catch (error) {
    console.error('âŒ ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
    showToast(error.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');

    submitBtn.disabled = false;
    submitBtn.querySelector('.btn-text').style.display = 'inline';
    submitBtn.querySelector('.loading').classList.remove('show');
  }
}

// ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
function showToast(message, type = '') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = 'toast show ' + type;
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}
</script>
</body>
</html>
